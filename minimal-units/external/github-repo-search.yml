name: "GitHub Repository Search"
description: "Search GitHub repositories"
category: "external"
estimated_time: "1-2 minutes"
tags: ["github", "search", "repository", "api", "external"]

inputs:
  query:
    description: "Search query (can include qualifiers like language:python)"
    required: true
    type: "string"
  sort:
    description: "Sort by (stars, forks, updated)"
    required: false
    type: "string"
    default: "stars"
  order:
    description: "Order (asc, desc)"
    required: false
    type: "string"
    default: "desc"
  per_page:
    description: "Results per page"
    required: false
    type: "integer"
    default: 10

outputs:
  results_json:
    description: "Path to JSON file with search results"
    type: "string"
  repository_count:
    description: "Number of repositories found"
    type: "integer"
  top_repo_url:
    description: "URL of top repository"
    type: "string"

workflow:
  - name: "Search GitHub repositories"
    run: |
      # Build search URL
      SEARCH_URL="https://api.github.com/search/repositories"
      PARAMS="q=${{ inputs.query }}&sort=${{ inputs.sort }}&order=${{ inputs.order }}&per_page=${{ inputs.per_page }}"
      
      # Add auth header if token available
      AUTH_HEADER=""
      if [ -n "${{ secrets.GITHUB_TOKEN }}" ]; then
        AUTH_HEADER="-H \"Authorization: token ${{ secrets.GITHUB_TOKEN }}\""
      fi
      
      # Search repositories
      echo "Searching GitHub repositories: ${{ inputs.query }}"
      
      RESPONSE=$(curl -s $AUTH_HEADER \
        -H "Accept: application/vnd.github.v3+json" \
        "${SEARCH_URL}?${PARAMS}")
      
      # Save results
      echo "$RESPONSE" | jq '.items' > github_repos.json
      
      # Extract metrics
      REPO_COUNT=$(jq 'length' github_repos.json)
      TOP_REPO_URL=$(jq -r '.[0].html_url // ""' github_repos.json)
      
      echo "Found ${REPO_COUNT} repositories"
      echo "results_json=github_repos.json" >> $GITHUB_OUTPUT
      echo "repository_count=${REPO_COUNT}" >> $GITHUB_OUTPUT
      echo "top_repo_url=${TOP_REPO_URL}" >> $GITHUB_OUTPUT
      
  - name: "Format results summary"
    run: |
      echo "## GitHub Repository Search Results" > github_repos_summary.md
      echo "Query: ${{ inputs.query }}" >> github_repos_summary.md
      echo "" >> github_repos_summary.md
      
      jq -r '.[] | "### \(.full_name)\n⭐ \(.stargazers_count) | 🍴 \(.forks_count) | 📝 \(.language // "N/A")\n\n\(.description // "No description")\n\n[View Repository](\(.html_url))\n\n---\n"' github_repos.json >> github_repos_summary.md

dependencies:
  - name: "GitHub Token"
    type: "secret"
    required: false
    description: "Optional GitHub token for higher rate limits"