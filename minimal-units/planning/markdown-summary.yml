name: markdown-summary
description: Markdownã‚µãƒžãƒªãƒ¼ç”Ÿæˆã®æœ€å°å˜ä½ãƒ¦ãƒ‹ãƒƒãƒˆ

on:
  workflow_call:
    inputs:
      content_paths:
        description: 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ãƒªã‚¹ãƒˆï¼ˆã‚«ãƒ³ãƒžåŒºåˆ‡ã‚Šï¼‰'
        required: true
        type: string
      output_dir:
        description: 'å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹'
        required: true
        type: string
      title:
        description: 'ã‚µãƒžãƒªãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«'
        required: false
        type: string
        default: 'Production Summary'
      include_metadata:
        description: 'ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚ã‚‹ã‹'
        required: false
        type: boolean
        default: true
    outputs:
      summary_path:
        description: 'ç”Ÿæˆã•ã‚ŒãŸã‚µãƒžãƒªãƒ¼ã®ãƒ‘ã‚¹'
        value: ${{ jobs.generate.outputs.summary_path }}

jobs:
  generate:
    runs-on: ubuntu-latest
    outputs:
      summary_path: ${{ steps.execute.outputs.summary_path }}
    
    steps:
      - name: Generate Markdown Summary
        id: execute
        run: |
          # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
          mkdir -p "${{ inputs.output_dir }}"
          
          # ã‚µãƒžãƒªãƒ¼ç”Ÿæˆé–‹å§‹
          cat > "${{ inputs.output_dir }}/summary.md" << 'EOF'
          # ${{ inputs.title }}
          
          Generated on: $(date -u +%Y-%m-%dT%H:%M:%SZ)
          
          ## ðŸ“ Generated Assets
          
          EOF
          
          # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±ã‚’è¿½åŠ 
          IFS=',' read -ra CONTENT_ARRAY <<< "${{ inputs.content_paths }}"
          for content_path in "${CONTENT_ARRAY[@]}"; do
            if [ -f "$content_path" ]; then
              FILE_NAME=$(basename "$content_path")
              FILE_SIZE=$(stat -c%s "$content_path" 2>/dev/null || stat -f%z "$content_path" 2>/dev/null || echo "unknown")
              FILE_TYPE="${FILE_NAME##*.}"
              
              echo "### $FILE_NAME" >> "${{ inputs.output_dir }}/summary.md"
              echo "- **Type**: $FILE_TYPE" >> "${{ inputs.output_dir }}/summary.md"
              echo "- **Size**: $FILE_SIZE bytes" >> "${{ inputs.output_dir }}/summary.md"
              echo "- **Path**: \`$content_path\`" >> "${{ inputs.output_dir }}/summary.md"
              echo "" >> "${{ inputs.output_dir }}/summary.md"
              
              # ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã®å ´åˆã€å†…å®¹ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¿½åŠ 
              case "$FILE_TYPE" in
                md|txt)
                  echo "**Preview**:" >> "${{ inputs.output_dir }}/summary.md"
                  echo '```' >> "${{ inputs.output_dir }}/summary.md"
                  head -10 "$content_path" >> "${{ inputs.output_dir }}/summary.md"
                  echo '```' >> "${{ inputs.output_dir }}/summary.md"
                  echo "" >> "${{ inputs.output_dir }}/summary.md"
                  ;;
                json)
                  echo "**Structure**:" >> "${{ inputs.output_dir }}/summary.md"
                  echo '```json' >> "${{ inputs.output_dir }}/summary.md"
                  jq -r 'keys' "$content_path" 2>/dev/null | head -10 >> "${{ inputs.output_dir }}/summary.md" || echo "Invalid JSON"
                  echo '```' >> "${{ inputs.output_dir }}/summary.md"
                  echo "" >> "${{ inputs.output_dir }}/summary.md"
                  ;;
              esac
            else
              echo "### âŒ Missing: $content_path" >> "${{ inputs.output_dir }}/summary.md"
              echo "" >> "${{ inputs.output_dir }}/summary.md"
            fi
          done
          
          # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³
          if [ "${{ inputs.include_metadata }}" = "true" ]; then
            cat >> "${{ inputs.output_dir }}/summary.md" << 'EOF'
          
          ## ðŸ”§ Metadata
          
          - **Workflow Run ID**: ${{ github.run_id }}
          - **Workflow Run Number**: ${{ github.run_number }}
          - **Repository**: ${{ github.repository }}
          - **Branch**: ${{ github.ref_name }}
          - **Commit SHA**: ${{ github.sha }}
          
          EOF
          fi
          
          # ãƒ•ãƒƒã‚¿ãƒ¼
          cat >> "${{ inputs.output_dir }}/summary.md" << 'EOF'
          
          ---
          
          ðŸ¤– Generated with Claude Code
          EOF
          
          # å‡ºåŠ›è¨­å®š
          echo "summary_path=${{ inputs.output_dir }}/summary.md" >> $GITHUB_OUTPUT