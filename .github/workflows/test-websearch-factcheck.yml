name: "Test WebSearch with Fact Check"
run-name: "ğŸ” WebSearch Fact Check Test"

on:
  workflow_dispatch:

env:
  CLAUDE_CODE_CI_MODE: true
  CLAUDE_CODE_AUTO_APPROVE_MCP: true

jobs:
  test:
    name: "Test WebSearch with Real-time Data"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Claude Code CLI
        run: npm install -g @anthropic-ai/claude-code
      
      - name: Create Output Directory
        run: mkdir -p test-results
      
      - name: Test 1 - Today's Date and Weather
        env:
          CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
        run: |
          echo "=== Test 1: Real-time data test ==="
          echo "Current date: $(date)"
          
          npx @anthropic-ai/claude-code \
            -p "WebSearchãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ä»¥ä¸‹ã‚’èª¿ã¹ã¦ãã ã•ã„ï¼š
            1. ä»Šæ—¥ã®æ—¥ä»˜ã¯ï¼Ÿï¼ˆã‚·ã‚¹ãƒ†ãƒ ã®çŸ¥è­˜ã§ã¯ãªãWebSearchã®çµæœã‹ã‚‰ï¼‰
            2. äº¬éƒ½ã®ä»Šæ—¥ã®å¤©æ°—ã¯ï¼Ÿ
            3. æ¤œç´¢ã—ãŸURLã‚’å¿…ãšè¡¨ç¤ºã—ã¦ãã ã•ã„" \
            --allowedTools "WebSearch" \
            --permission-mode "acceptEdits"
      
      - name: Test 2 - Recent News with Sources
        env:
          CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
        run: |
          echo "=== Test 2: Recent news with sources ==="
          
          npx @anthropic-ai/claude-code \
            -p "WebSearchãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ä»¥ä¸‹ã‚’èª¿ã¹ã¦ã€test-results/news-search.txt ã«ä¿å­˜ã—ã¦ãã ã•ã„ï¼š
            1. 2025å¹´8æœˆã®äº¬éƒ½ã«é–¢ã™ã‚‹æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ï¼ˆ3ä»¶ï¼‰
            2. å„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã«ã¤ã„ã¦ï¼š
               - ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®ã‚¿ã‚¤ãƒˆãƒ«
               - æ²è¼‰æ—¥
               - ã‚½ãƒ¼ã‚¹URL
               - ç°¡å˜ãªè¦ç´„
            3. å®Ÿéš›ã«æ¤œç´¢ã—ãŸã‚¯ã‚¨ãƒªã‚‚è¨˜è¼‰ã—ã¦ãã ã•ã„" \
            --allowedTools "WebSearch,Write" \
            --permission-mode "acceptEdits"
      
      - name: Test 3 - Specific Restaurant Check
        env:
          CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
        run: |
          echo "=== Test 3: Specific restaurant verification ==="
          
          npx @anthropic-ai/claude-code \
            -p "WebSearchãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ä»¥ä¸‹ã®åº—èˆ—æƒ…å ±ã‚’ç¢ºèªã—ã€test-results/restaurant-check.txt ã«ä¿å­˜ã—ã¦ãã ã•ã„ï¼š
            1. å…ˆæ–—ç”ºã®é´¨è•éº¦ã€Œç”°ã€ã®å®Ÿåœ¨æ€§
            2. å–¶æ¥­æ™‚é–“ã€ä½æ‰€ã€é›»è©±ç•ªå·
            3. æœ€è¿‘ã®å£ã‚³ãƒŸã‚„è©•ä¾¡
            4. æƒ…å ±æºã®URL
            
            ã‚‚ã—å®Ÿåœ¨ã—ãªã„å ´åˆã¯ã€ãã®æ—¨ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚" \
            --allowedTools "WebSearch,Write" \
            --permission-mode "acceptEdits"
      
      - name: Check Results
        run: |
          echo "=== Generated Files ==="
          ls -la test-results/
          
          if [ -f "test-results/news-search.txt" ]; then
            echo "=== News Search Results ==="
            cat test-results/news-search.txt
          fi
          
          if [ -f "test-results/restaurant-check.txt" ]; then
            echo "=== Restaurant Check Results ==="
            cat test-results/restaurant-check.txt
          fi
      
      - name: Upload Test Results
        uses: actions/upload-artifact@v4
        with:
          name: websearch-factcheck-results
          path: test-results/