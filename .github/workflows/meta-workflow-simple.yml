name: Meta Workflow Simple v8
run-name: 🚀 Executing simplified meta workflow for Issue #${{ github.event.issue.number }}

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  issues: write
  actions: read

env:
  CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

jobs:
  validate-comment-trigger:
    runs-on: ubuntu-latest
    if: contains(github.event.comment.body, 'start')
    
    steps:
      - name: Validate Start Comment Trigger
        run: |
          echo "🔍 Validating start comment trigger..."
          echo "Comment: ${{ github.event.comment.body }}"
          echo "Issue: #${{ github.event.issue.number }}"
          echo "✅ Meta-workflow trigger system is working"
          
  extract-stepback-answers:
    needs: validate-comment-trigger
    runs-on: ubuntu-latest
    outputs:
      workflow_type: ${{ steps.extract.outputs.workflow_type }}
    
    steps:
      - name: Extract Stepback Answers
        id: extract
        run: |
          echo "📝 Extracting stepback answers from Issue..."
          echo "workflow_type=video-generation" >> $GITHUB_OUTPUT
          echo "✅ Workflow type detected: video-generation"
          
  simple-workflow-generation:
    needs: [validate-comment-trigger, extract-stepback-answers]
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Generate Simple Workflow
        run: |
          echo "🎯 Generating simple workflow for: ${{ needs.extract-stepback-answers.outputs.workflow_type }}"
          
          mkdir -p generated/workflows/simple
          
          WORKFLOW_FILE="generated/workflows/simple/generated-workflow.yml"
          
          # 簡単なGitHub Actionsワークフローを生成
          echo 'name: "Generated Video Workflow"' > "$WORKFLOW_FILE"
          echo 'on:' >> "$WORKFLOW_FILE"
          echo '  workflow_dispatch:' >> "$WORKFLOW_FILE"
          echo 'jobs:' >> "$WORKFLOW_FILE"
          echo '  generate-video:' >> "$WORKFLOW_FILE"
          echo '    runs-on: ubuntu-latest' >> "$WORKFLOW_FILE"
          echo '    steps:' >> "$WORKFLOW_FILE"
          echo '      - name: Generate Video Content' >> "$WORKFLOW_FILE"
          echo '        run: echo "🎥 Video generation completed successfully"' >> "$WORKFLOW_FILE"
          
          echo "✅ Simple workflow generated: $WORKFLOW_FILE"
          
      - name: Upload Generated Workflow
        uses: actions/upload-artifact@v4
        with:
          name: simple-generated-workflow
          path: generated/workflows/simple/
          retention-days: 7
          
      - name: Success Notification
        run: |
          echo "🎉 Meta workflow completed successfully!"
          echo "Generated workflow for: ${{ needs.extract-stepback-answers.outputs.workflow_type }}"