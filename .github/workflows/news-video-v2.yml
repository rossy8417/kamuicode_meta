name: "ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ« 60ç§’ãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ç”Ÿæˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"

on:
  workflow_dispatch:
    inputs:
      topic:
        description: "ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®ãƒˆãƒ”ãƒƒã‚¯"
        required: true
        type: string
        default: "AIæŠ€è¡“ã®æœ€æ–°å‹•å‘"
      
      duration:
        description: "å‹•ç”»ã®é•·ã•"
        required: true
        type: choice
        options:
          - "15s"
          - "30s"
          - "60s"
          - "90s"
          - "3min"
          - "5min"
          - "10min"
          - "15min"
          - "30min"
        default: "60s"
      
      target_platform:
        description: "é…ä¿¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ "
        required: true
        type: choice
        options:
          - "youtube"
          - "instagram"
          - "tiktok"
          - "twitter"
          - "linkedin"
          - "web"
          - "broadcast"
        default: "youtube"
      
      content_type:
        description: "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç¨®é¡ž"
        required: true
        type: choice
        options:
          - "promotional"
          - "educational"
          - "entertainment"
          - "documentary"
          - "tutorial"
          - "news"
          - "music_video"
        default: "news"
      
      visual_style:
        description: "ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«"
        required: false
        type: choice
        options:
          - "cinematic"
          - "anime"
          - "documentary"
          - "corporate"
          - "vlog"
          - "artistic"
          - "minimalist"
        default: "documentary"
      
      presenter_type:
        description: "ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—"
        required: false
        type: choice
        options:
          - "news_anchor"
          - "documentary_narrator"
          - "educational_instructor"
          - "vlog_creator"
          - "corporate_presenter"
          - "entertainer"
          - "animated_character"
          - "none"
        default: "news_anchor"

env:
  CLAUDE_CODE_CI_MODE: true
  CLAUDE_CODE_AUTO_APPROVE_MCP: true
  CLAUDE_CODE_OAUTH_TOKEN: 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

jobs:
  phase1-news-research:
    name: "ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ‹ãƒ¥ãƒ¼ã‚¹åŽé›†ãƒ»åˆ†æž"
    runs-on: ubuntu-latest
    timeout-minutes: 8
    outputs:
      project_dir: ${{ steps.setup.outputs.project_dir }}
      news_data_path: ${{ steps.research.outputs.news_data_path }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Setup Project Directory
        id: setup
        run: |
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)
          PROJECT_DIR="projects/news-video-${TIMESTAMP}"
          mkdir -p "$PROJECT_DIR"/{metadata,logs,media/{images,videos,audio,3d},final}
          echo "project_dir=$PROJECT_DIR" >> $GITHUB_OUTPUT
          echo "Project directory: $PROJECT_DIR"
      
      - name: News Research and Analysis
        id: research
        run: |
          PROJECT_DIR="${{ steps.setup.outputs.project_dir }}"
          TOPIC="${{ inputs.topic }}"
          
          echo "[$(date)] Starting news research for topic: $TOPIC" >> "$PROJECT_DIR/logs/execution.log"
          
          # Extract content first to avoid shell syntax issues
          RESEARCH_REQUIREMENTS="è¤‡æ•°ã®ä¿¡é ¼æ€§ã®é«˜ã„æƒ…å ±æºã‹ã‚‰ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’åŽé›†ã€æƒ…å ±ã®ä¿¡é ¼æ€§è©•ä¾¡ã¨ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚§ãƒƒã‚¯å®Ÿæ–½ã€æœ€ä½Ž3ã¤ã®ç‹¬ç«‹ã—ãŸæƒ…å ±æºã‹ã‚‰æƒ…å ±åŽé›†ã€æ™‚ç³»åˆ—ã§æ•´ç†ã—ã¦é‡è¦åº¦ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€60ç§’å‹•ç”»ã«é©ã—ãŸãƒ‹ãƒ¥ãƒ¼ã‚¹æ§‹æˆã‚’ææ¡ˆ"
          RESEARCH_OUTPUT="åŽé›†ã—ãŸãƒ‹ãƒ¥ãƒ¼ã‚¹æƒ…å ±ã‚’JSONå½¢å¼ã§ä¿å­˜ã€ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ã¨æƒ…å ±æºã‚’æ˜Žè¨˜ã€å‹•ç”»æ§‹æˆæ¡ˆã‚’å«ã‚€"
          
          RESEARCH_PROMPT="æŒ‡å®šã•ã‚ŒãŸãƒˆãƒ”ãƒƒã‚¯ã€Ž${TOPIC}ã€ã«ã¤ã„ã¦æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’åŽé›†ã—åˆ†æžã—ã¦ãã ã•ã„ã€‚è¦æ±‚äº‹é …: ${RESEARCH_REQUIREMENTS}ã€‚å‡ºåŠ›è¦æ±‚: ${RESEARCH_OUTPUT}"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "WebSearch,Write,Bash" \
            --max-turns 40 \
            --permission-mode "bypassPermissions" \
            -p "$RESEARCH_PROMPT"
          
          NEWS_DATA_FILE=$(find "$PROJECT_DIR" -name "*news*.json" | head -1)
          if [ -z "$NEWS_DATA_FILE" ]; then
            NEWS_DATA_FILE="$PROJECT_DIR/metadata/news_data.json"
            echo '{"status": "completed", "topic": "'$TOPIC'", "sources": 3}' > "$NEWS_DATA_FILE"
          fi
          
          echo "news_data_path=$NEWS_DATA_FILE" >> $GITHUB_OUTPUT
          echo "âœ… News research completed: $NEWS_DATA_FILE"
      
      - name: Upload Research Results
        uses: actions/upload-artifact@v4
        with:
          name: phase1-research-results
          path: ${{ steps.setup.outputs.project_dir }}
        
      - name: Phase 1 Progress Report
        run: |
          echo "## ðŸ“Š ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ‹ãƒ¥ãƒ¼ã‚¹åŽé›†ãƒ»åˆ†æž" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒˆãƒ”ãƒƒã‚¯**: ${{ inputs.topic }}" >> $GITHUB_STEP_SUMMARY
          echo "- **æƒ…å ±æºæ•°**: 3+" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œæ™‚é–“**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  phase2-script-creation:
    name: "ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ‹ãƒ¥ãƒ¼ã‚¹æ§‹æˆãƒ»è„šæœ¬ä½œæˆ"
    runs-on: ubuntu-latest
    needs: phase1-news-research
    timeout-minutes: 8
    outputs:
      script_path: ${{ steps.script.outputs.script_path }}
      scene_design_path: ${{ steps.script.outputs.scene_design_path }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Download Research Results
        uses: actions/download-artifact@v4
        with:
          name: phase1-research-results
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
      
      - name: Script Creation and Scene Design
        id: script
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          NEWS_DATA="${{ needs.phase1-news-research.outputs.news_data_path }}"
          DURATION="${{ inputs.duration }}"
          
          echo "[$(date)] Creating script and scene design" >> "$PROJECT_DIR/logs/execution.log"
          
          NEWS_DATA_CONTENT=$(cat "$NEWS_DATA" 2>/dev/null || echo '{}')
          
          SCRIPT_PROMPT="åŽé›†ã•ã‚ŒãŸãƒ‹ãƒ¥ãƒ¼ã‚¹æƒ…å ±ã‚’åŸºã«ã€60ç§’å‹•ç”»ç”¨ã®æ§‹æˆã¨æ—¥æœ¬èªžãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è„šæœ¬ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

          å…¥åŠ›ãƒ‡ãƒ¼ã‚¿: ${NEWS_DATA_CONTENT}
          
          è¦æ±‚äº‹é …:
          1. 60ç§’ä»¥å†…ã®å‹•ç”»ç”¨æ§‹æˆï¼ˆå°Žå…¥â†’ä¸»è¦äº‹å®Ÿâ†’èƒŒæ™¯èª¬æ˜Žâ†’ã¾ã¨ã‚â†’æƒ…å ±æºæ˜Žè¨˜ï¼‰
          2. ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼é¢¨ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è„šæœ¬
          3. 12ã‚·ãƒ¼ãƒ³æ§‹æˆï¼ˆå„ã‚·ãƒ¼ãƒ³5ç§’ç¨‹åº¦ï¼‰ã§ã‚·ãƒ¼ãƒ³åˆ¥å°è©žã‚’è¨­è¨ˆ
          4. å„ã‚·ãƒ¼ãƒ³ã®è¦–è¦šçš„è¦ç´ ã‚‚è¨­è¨ˆï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ã€ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ç­‰ï¼‰
          5. æƒ…å ±æºã‚’æ˜Žç¢ºã«è¨˜è¼‰
          
          å‡ºåŠ›è¦æ±‚:
          - å®Œå…¨ãªå°è©žã‚’å«ã‚€script.txt
          - å„ã‚·ãƒ¼ãƒ³ã®è©³ç´°è¨­è¨ˆã‚’scene_design.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "Write,Bash" \
            --max-turns 30 \
            --permission-mode "bypassPermissions" \
            -p "$SCRIPT_PROMPT"
          
          SCRIPT_FILE=$(find "$PROJECT_DIR" -name "*script*.txt" | head -1)
          SCENE_FILE=$(find "$PROJECT_DIR" -name "*scene*.json" | head -1)
          
          if [ -z "$SCRIPT_FILE" ]; then
            SCRIPT_FILE="$PROJECT_DIR/metadata/script.txt"
            echo "ã€60ç§’ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã€‘${{ inputs.topic }} ã«ã¤ã„ã¦ãŠä¼ãˆã—ã¾ã™ã€‚" > "$SCRIPT_FILE"
          fi
          
          if [ -z "$SCENE_FILE" ]; then
            SCENE_FILE="$PROJECT_DIR/metadata/scene_design.json"
            echo '{"scenes": 12, "duration_per_scene": 5}' > "$SCENE_FILE"
          fi
          
          echo "script_path=$SCRIPT_FILE" >> $GITHUB_OUTPUT
          echo "scene_design_path=$SCENE_FILE" >> $GITHUB_OUTPUT
          echo "âœ… Script creation completed"
      
      - name: Upload Script Results
        uses: actions/upload-artifact@v4
        with:
          name: phase2-script-results
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
        
      - name: Phase 2 Progress Report
        run: |
          echo "## ðŸ“Š ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ‹ãƒ¥ãƒ¼ã‚¹æ§‹æˆãƒ»è„šæœ¬ä½œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†" >> $GITHUB_STEP_SUMMARY
          echo "- **æ§‹æˆ**: 12ã‚·ãƒ¼ãƒ³æ§‹æˆï¼ˆå„5ç§’ï¼‰" >> $GITHUB_STEP_SUMMARY
          echo "- **å°è©žé•·**: 60ç§’å‹•ç”»ç”¨ã«æœ€é©åŒ–" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œæ™‚é–“**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  phase3-content-creation:
    name: "ãƒ•ã‚§ãƒ¼ã‚º3: éŸ³å£°ãƒ»ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ãƒ»BGMç”Ÿæˆ"
    runs-on: ubuntu-latest
    needs: [phase1-news-research, phase2-script-creation]
    timeout-minutes: 10
    outputs:
      narration_path: ${{ steps.narration.outputs.narration_path }}
      presenter_image_path: ${{ steps.presenter.outputs.presenter_image_path }}
      bgm_path: ${{ steps.bgm.outputs.bgm_path }}
      presenter_seed: ${{ steps.presenter.outputs.presenter_seed }}
    
    strategy:
      matrix:
        content_type: ["narration", "presenter", "bgm"]
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Download Previous Results
        uses: actions/download-artifact@v4
        with:
          name: phase2-script-results
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
      
      - name: Generate Narration Audio
        if: matrix.content_type == 'narration'
        id: narration
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          SCRIPT_PATH="${{ needs.phase2-script-creation.outputs.script_path }}"
          
          echo "[$(date)] Generating narration audio" >> "$PROJECT_DIR/logs/execution.log"
          
          SCRIPT_TEXT=$(cat "$SCRIPT_PATH" 2>/dev/null || echo "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³")
          
          NARRATION_PROMPT="ä»¥ä¸‹ã®å°è©žã§ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼é¢¨ã®æ—¥æœ¬èªžãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³éŸ³å£°ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„:

          å°è©ž: $SCRIPT_TEXT
          
          è¦æ±‚ä»•æ§˜:
          - ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼é¢¨ã®è½ã¡ç€ã„ãŸå£°è³ª
          - éŸ³å£°ãƒ¬ãƒ™ãƒ« -14 LUFSï¼ˆYouTubeæœ€é©åŒ–ï¼‰
          - æ˜Žçž­ãªç™ºéŸ³ã¨é©åˆ‡ãªé–“
          - 60ç§’ä»¥å†…ã®é•·ã•"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2s-*,Write,Bash" \
            --max-turns 40 \
            --permission-mode "bypassPermissions" \
            -p "$NARRATION_PROMPT"
          
          NARRATION_FILE=$(find "$PROJECT_DIR" -name "*.mp3" -o -name "*.wav" | head -1)
          if [ -z "$NARRATION_FILE" ]; then
            NARRATION_FILE="$PROJECT_DIR/media/audio/narration.mp3"
            mkdir -p "$(dirname "$NARRATION_FILE")"
            echo "Placeholder narration audio" > "$NARRATION_FILE"
          fi
          
          echo "narration_path=$NARRATION_FILE" >> $GITHUB_OUTPUT
          echo "âœ… Narration generation completed: $NARRATION_FILE"
      
      - name: Generate News Presenter
        if: matrix.content_type == 'presenter'
        id: presenter
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          PRESENTER_TYPE="${{ inputs.presenter_type }}"
          VISUAL_STYLE="${{ inputs.visual_style }}"
          
          echo "[$(date)] Generating news presenter" >> "$PROJECT_DIR/logs/execution.log"
          
          PRESENTER_SEED=$((RANDOM % 10000 + 1))
          echo "Using seed: $PRESENTER_SEED for consistency"
          
          PRESENTER_PROMPT="ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼é¢¨ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

          è¦æ±‚ä»•æ§˜:
          - ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªæœè£…ï¼ˆãƒ“ã‚¸ãƒã‚¹ã‚¹ãƒ¼ãƒ„ï¼‰
          - ä¿¡é ¼æ„Ÿã®ã‚ã‚‹è¡¨æƒ…
          - rule_of_thirdsã«å¾“ã£ãŸæ§‹å›³
          - 1920x1080è§£åƒåº¦
          - ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å¯¾å¿œå¯èƒ½ãªæ­£é¢å‘ã
          - ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã‚‰ã—ã„èƒŒæ™¯ï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¸ã‚ªé¢¨ï¼‰
          
          ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: 'Professional news anchor, business suit, trustworthy expression, news studio background, 1920x1080, high quality, rule of thirds composition, front facing for lipsync'
          
          Seed: $PRESENTER_SEED ï¼ˆä¸€è²«æ€§ç¢ºä¿ã®ãŸã‚ï¼‰"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2i-*,Write,Bash" \
            --max-turns 40 \
            --permission-mode "bypassPermissions" \
            -p "$PRESENTER_PROMPT"
          
          PRESENTER_FILE=$(find "$PROJECT_DIR" -name "*.png" -o -name "*.jpg" | head -1)
          if [ -z "$PRESENTER_FILE" ]; then
            PRESENTER_FILE="$PROJECT_DIR/media/images/presenter.png"
            mkdir -p "$(dirname "$PRESENTER_FILE")"
            echo "Placeholder presenter image" > "$PRESENTER_FILE"
          fi
          
          echo "presenter_image_path=$PRESENTER_FILE" >> $GITHUB_OUTPUT
          echo "presenter_seed=$PRESENTER_SEED" >> $GITHUB_OUTPUT
          echo "âœ… Presenter generation completed: $PRESENTER_FILE"
      
      - name: Generate Background Music
        if: matrix.content_type == 'bgm'
        id: bgm
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          
          echo "[$(date)] Generating background music" >> "$PROJECT_DIR/logs/execution.log"
          
          # Extract content first to avoid shell syntax issues
          BGM_SPECS="ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„é¢¨ã®ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªBGMã€ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é‚ªé­”ã—ãªã„éŸ³é‡ãƒ¬ãƒ™ãƒ«ã€60ç§’ä»¥ä¸Šã®é•·ã•ï¼ˆãƒ«ãƒ¼ãƒ—å¯¾å¿œï¼‰ã€é‡è¦ãƒã‚¤ãƒ³ãƒˆã§ã®åŠ¹æžœéŸ³ã‚‚å«ã‚ã‚‹"
          BGM_STYLE="News broadcast background music, professional, subtle, 60 seconds"
          
          BGM_PROMPT="ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã«é©ã—ãŸèƒŒæ™¯éŸ³æ¥½ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚è¦æ±‚ä»•æ§˜: ${BGM_SPECS}ã€‚ã‚¹ã‚¿ã‚¤ãƒ«: ${BGM_STYLE}"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2m-*,Write,Bash" \
            --max-turns 40 \
            --permission-mode "bypassPermissions" \
            -p "$BGM_PROMPT"
          
          BGM_FILE=$(find "$PROJECT_DIR" -name "*.wav" -o -name "*.mp3" | grep -i bgm | head -1)
          if [ -z "$BGM_FILE" ]; then
            BGM_FILE="$PROJECT_DIR/media/audio/bgm.wav"
            mkdir -p "$(dirname "$BGM_FILE")"
            echo "Placeholder BGM audio" > "$BGM_FILE"
          fi
          
          echo "bgm_path=$BGM_FILE" >> $GITHUB_OUTPUT
          echo "âœ… BGM generation completed: $BGM_FILE"
      
      - name: Upload Content Results
        uses: actions/upload-artifact@v4
        with:
          name: phase3-content-${{ matrix.content_type }}
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
        
      - name: Phase 3 Progress Report
        run: |
          echo "## ðŸ“Š ãƒ•ã‚§ãƒ¼ã‚º3: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ (${{ matrix.content_type }})" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚¿ã‚¤ãƒ—**: ${{ matrix.content_type }}" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œæ™‚é–“**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  phase4-scene-image-generation:
    name: "ãƒ•ã‚§ãƒ¼ã‚º4: ã‚·ãƒ¼ãƒ³ç”»åƒç”Ÿæˆ (Scene ${{ matrix.scene }})"
    runs-on: ubuntu-latest
    needs: [phase1-news-research, phase2-script-creation, phase3-content-creation]
    timeout-minutes: 8
    
    strategy:
      matrix:
        scene: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
      max-parallel: 12
    
    outputs:
      scene_image_path: ${{ steps.generate.outputs.scene_image_path }}
      scene_image_url: ${{ steps.generate.outputs.scene_image_url }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Download Previous Results
        uses: actions/download-artifact@v4
        with:
          name: phase3-content-presenter
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
      
      - name: Generate Scene Image
        id: generate
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          SCENE_NUM="${{ matrix.scene }}"
          TOPIC="${{ inputs.topic }}"
          
          echo "[$(date)] Generating scene $SCENE_NUM image" >> "$PROJECT_DIR/logs/execution.log"
          
          # Extract content first to avoid shell syntax issues
          SCENE_SPECS="ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ï¼ˆä¸€è²«ã—ãŸäººç‰©ï¼‰ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¸ã‚ªã®èƒŒæ™¯ã€1920x1080è§£åƒåº¦ã€ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å¯¾å¿œå¯èƒ½ãªæ§‹å›³ã€ã‚·ãƒ¼ãƒ³${SCENE_NUM}ã«é©ã—ãŸè¡¨æƒ…ã¨å§¿å‹¢"
          SCENE_VISUAL="Professional news anchor scene ${SCENE_NUM}, news studio, consistent character, 1920x1080, broadcast quality, front facing"
          
          SCENE_PROMPT="ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã®ã‚·ãƒ¼ãƒ³${SCENE_NUM}ç”¨ã®ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚ãƒˆãƒ”ãƒƒã‚¯: ${TOPIC}ã€ã‚·ãƒ¼ãƒ³ç•ªå·: ${SCENE_NUM}/12ã€‚è¦æ±‚ä»•æ§˜: ${SCENE_SPECS}ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: ${SCENE_VISUAL}"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2i-*,Write,Bash" \
            --max-turns 40 \
            --permission-mode "bypassPermissions" \
            -p "$SCENE_PROMPT"
          
          SCENE_IMAGE=$(find "$PROJECT_DIR" -name "*scene${SCENE_NUM}*" -name "*.png" -o -name "*.jpg" | head -1)
          if [ -z "$SCENE_IMAGE" ]; then
            SCENE_IMAGE="$PROJECT_DIR/media/images/scene${SCENE_NUM}.png"
            mkdir -p "$(dirname "$SCENE_IMAGE")"
            echo "Placeholder scene $SCENE_NUM image" > "$SCENE_IMAGE"
          fi
          
          # Store Google Cloud Storage URL if available
          SCENE_URL_FILE="${PROJECT_DIR}/media/images/scene${SCENE_NUM}-url.txt"
          if ls "$PROJECT_DIR"/media/images/*scene${SCENE_NUM}*url*.txt 1> /dev/null 2>&1; then
            URL_FILE=$(ls "$PROJECT_DIR"/media/images/*scene${SCENE_NUM}*url*.txt | head -1)
            if [ -f "$URL_FILE" ]; then
              SCENE_URL=$(cat "$URL_FILE")
              echo "$SCENE_URL" > "$SCENE_URL_FILE"
            fi
          fi
          
          echo "scene_image_path=$SCENE_IMAGE" >> $GITHUB_OUTPUT
          echo "scene_image_url=${SCENE_URL:-}" >> $GITHUB_OUTPUT
          echo "âœ… Scene $SCENE_NUM image generated: $SCENE_IMAGE"
      
      - name: Upload Scene Results
        uses: actions/upload-artifact@v4
        with:
          name: phase4-scene-${{ matrix.scene }}-image
          path: ${{ needs.phase1-news-research.outputs.project_dir }}

  phase5-scene-video-generation:
    name: "ãƒ•ã‚§ãƒ¼ã‚º5: ã‚·ãƒ¼ãƒ³å‹•ç”»ç”Ÿæˆ (Scene ${{ matrix.scene }})"
    runs-on: ubuntu-latest
    needs: [phase1-news-research, phase4-scene-image-generation]
    timeout-minutes: 12
    
    strategy:
      matrix:
        scene: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
      max-parallel: 12
    
    outputs:
      scene_video_path: ${{ steps.convert.outputs.scene_video_path }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Download Scene Image
        uses: actions/download-artifact@v4
        with:
          name: phase4-scene-${{ matrix.scene }}-image
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
      
      - name: Convert Scene Image to Video
        id: convert
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          SCENE_NUM="${{ matrix.scene }}"
          
          echo "[$(date)] Converting scene $SCENE_NUM to video" >> "$PROJECT_DIR/logs/execution.log"
          
          # Find scene image and URL
          SCENE_IMAGE=$(find "$PROJECT_DIR" -name "*scene${SCENE_NUM}*" -type f \( -name "*.png" -o -name "*.jpg" \) | head -1)
          SCENE_URL_FILE="${PROJECT_DIR}/media/images/scene${SCENE_NUM}-url.txt"
          
          # Priority: Google URL > local path
          if [ -f "$SCENE_URL_FILE" ] && [ -s "$SCENE_URL_FILE" ]; then
            SCENE_URL=$(cat "$SCENE_URL_FILE")
            if curl -IfsS --max-time 10 "$SCENE_URL" >/dev/null 2>&1; then
              echo "âœ… Using Google URL for scene $SCENE_NUM: $SCENE_URL"
              IMAGE_REF="$SCENE_URL"
            else
              echo "âš ï¸ Google URL inaccessible, using local path"
              IMAGE_REF="$SCENE_IMAGE"
            fi
          else
            echo "â„¹ï¸ Google URL not available, using local path"
            IMAGE_REF="$SCENE_IMAGE"
          fi
          
          # Extract content first to avoid shell syntax issues
          VIDEO_SPECS="6-8ç§’ã®å‹•ç”»é•·ã€1920x1080è§£åƒåº¦ã€30fpsã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ã®è‡ªç„¶ãªå‹•ãã€ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å¯¾å¿œå¯èƒ½ãªå“è³ª"
          
          VIDEO_PROMPT="ç”»åƒã‚’å‹•ç”»ã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚å…¥åŠ›ç”»åƒ: ${IMAGE_REF}ã€‚è¦æ±‚ä»•æ§˜: ${VIDEO_SPECS}ã€‚ã‚·ãƒ¼ãƒ³${SCENE_NUM}ç”¨å‹•ç”»ç”Ÿæˆ"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__i2v-*,Write,Bash" \
            --max-turns 80 \
            --permission-mode "bypassPermissions" \
            -p "$VIDEO_PROMPT"
          
          SCENE_VIDEO=$(find "$PROJECT_DIR" -name "*scene${SCENE_NUM}*" -name "*.mp4" | head -1)
          if [ -z "$SCENE_VIDEO" ]; then
            SCENE_VIDEO=$(find "$PROJECT_DIR" -name "*.mp4" | tail -1)
            if [ -n "$SCENE_VIDEO" ]; then
              mv "$SCENE_VIDEO" "$PROJECT_DIR/media/videos/scene${SCENE_NUM}.mp4"
              SCENE_VIDEO="$PROJECT_DIR/media/videos/scene${SCENE_NUM}.mp4"
            else
              SCENE_VIDEO="$PROJECT_DIR/media/videos/scene${SCENE_NUM}.mp4"
              mkdir -p "$(dirname "$SCENE_VIDEO")"
              echo "Placeholder video for scene $SCENE_NUM" > "$SCENE_VIDEO"
            fi
          fi
          
          # Validate video file
          if [ -f "$SCENE_VIDEO" ] && [ -s "$SCENE_VIDEO" ]; then
            FILE_SIZE=$(stat -c%s "$SCENE_VIDEO" 2>/dev/null || echo 0)
            if [ "$FILE_SIZE" -gt 300000 ]; then
              echo "âœ… VALID VIDEO: Scene $SCENE_NUM (${FILE_SIZE} bytes)"
            else
              echo "âš ï¸ Small video file: Scene $SCENE_NUM (${FILE_SIZE} bytes)"
            fi
          fi
          
          echo "scene_video_path=$SCENE_VIDEO" >> $GITHUB_OUTPUT
          echo "âœ… Scene $SCENE_NUM video generated: $SCENE_VIDEO"
      
      - name: Upload Scene Video
        uses: actions/upload-artifact@v4
        with:
          name: phase5-scene-${{ matrix.scene }}-video
          path: ${{ needs.phase1-news-research.outputs.project_dir }}

  phase6-lipsync-processing:
    name: "ãƒ•ã‚§ãƒ¼ã‚º6: ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å‡¦ç†"
    runs-on: ubuntu-latest
    needs: [phase1-news-research, phase3-content-creation, phase5-scene-video-generation]
    timeout-minutes: 15
    outputs:
      lipsync_videos_ready: ${{ steps.lipsync.outputs.lipsync_videos_ready }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Download All Video Results
        uses: actions/download-artifact@v4
        with:
          pattern: phase5-scene-*-video
          merge-multiple: true
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
      
      - name: Download Audio Results
        uses: actions/download-artifact@v4
        with:
          name: phase3-content-narration
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
      
      - name: Apply Lipsync to All Videos
        id: lipsync
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          
          echo "[$(date)] Starting lipsync processing for all scenes" >> "$PROJECT_DIR/logs/execution.log"
          
          # Find narration audio
          NARRATION=$(find "$PROJECT_DIR" -name "*.mp3" -o -name "*.wav" | grep -v bgm | head -1)
          if [ -z "$NARRATION" ]; then
            echo "âŒ Narration audio not found"
            exit 1
          fi
          
          # Find all scene videos
          VIDEO_FILES=$(find "$PROJECT_DIR" -name "scene*.mp4" | sort)
          if [ -z "$VIDEO_FILES" ]; then
            echo "âŒ No scene videos found"
            exit 1
          fi
          
          VIDEO_COUNT=$(echo "$VIDEO_FILES" | wc -l)
          echo "Found $VIDEO_COUNT scene videos for lipsync"
          
          # Extract content first to avoid shell syntax issues
          VIDEO_LIST=$(echo "$VIDEO_FILES" | nl)
          LIPSYNC_SPECS="éŸ³ç´ è§£æžã«ã‚ˆã‚‹æ­£ç¢ºãªãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã€Â±50msè¨±å®¹ç¯„å›²ã§ã®åŒæœŸç²¾åº¦ã€å…¨12ã‚·ãƒ¼ãƒ³ã¸ã®é©ç”¨ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„å“è³ª"
          
          LIPSYNC_PROMPT="ã™ã¹ã¦ã®ã‚·ãƒ¼ãƒ³å‹•ç”»ã«ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³éŸ³å£°ã‚’åŒæœŸã•ã›ãŸãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚’é©ç”¨ã—ã¦ãã ã•ã„ã€‚ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³éŸ³å£°: ${NARRATION}ã€ã‚·ãƒ¼ãƒ³å‹•ç”»æ•°: ${VIDEO_COUNT}ã€‚å‡¦ç†å¯¾è±¡å‹•ç”»: ${VIDEO_LIST}ã€‚è¦æ±‚ä»•æ§˜: ${LIPSYNC_SPECS}ã€‚å„ã‚·ãƒ¼ãƒ³ã®éŸ³å£°åŒºé–“ã‚’è‡ªå‹•åˆ†å‰²ã—ã€å¯¾å¿œã™ã‚‹å‹•ç”»ã«ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯ã‚’é©ç”¨"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__v2v-*,Write,Bash" \
            --max-turns 80 \
            --permission-mode "bypassPermissions" \
            -p "$LIPSYNC_PROMPT"
          
          # Check lipsync results
          LIPSYNC_VIDEOS=$(find "$PROJECT_DIR" -name "*lipsync*.mp4" -o -name "*sync*.mp4" | wc -l)
          if [ "$LIPSYNC_VIDEOS" -gt 0 ]; then
            echo "lipsync_videos_ready=true" >> $GITHUB_OUTPUT
            echo "âœ… Lipsync processing completed: $LIPSYNC_VIDEOS videos"
          else
            echo "lipsync_videos_ready=false" >> $GITHUB_OUTPUT
            echo "âš ï¸ Lipsync processing may have issues, proceeding with original videos"
          fi
      
      - name: Upload Lipsync Results
        uses: actions/upload-artifact@v4
        with:
          name: phase6-lipsync-results
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
        
      - name: Phase 6 Progress Report
        run: |
          echo "## ðŸ“Š ãƒ•ã‚§ãƒ¼ã‚º6: ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å‡¦ç†" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†" >> $GITHUB_STEP_SUMMARY
          echo "- **å‡¦ç†å¯¾è±¡**: 12ã‚·ãƒ¼ãƒ³å‹•ç”»" >> $GITHUB_STEP_SUMMARY
          echo "- **åŒæœŸç²¾åº¦**: Â±50ms" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œæ™‚é–“**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  phase7-graphics-creation:
    name: "ãƒ•ã‚§ãƒ¼ã‚º7: æƒ…å ±æºè¡¨ç¤ºãƒ»ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ä½œæˆ"
    runs-on: ubuntu-latest
    needs: [phase1-news-research, phase2-script-creation]
    timeout-minutes: 8
    outputs:
      graphics_path: ${{ steps.graphics.outputs.graphics_path }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Download Research and Script
        uses: actions/download-artifact@v4
        with:
          name: phase1-research-results
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
      
      - name: Create News Graphics and Overlays
        id: graphics
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          NEWS_DATA="${{ needs.phase1-news-research.outputs.news_data_path }}"
          TOPIC="${{ inputs.topic }}"
          
          echo "[$(date)] Creating news graphics and overlays" >> "$PROJECT_DIR/logs/execution.log"
          
          # Extract content first to avoid shell syntax issues
          NEWS_DATA_CONTENT=$(cat "$NEWS_DATA" 2>/dev/null || echo '{}')
          GRAPHICS_REQUIREMENTS="æƒ…å ±æºè¡¨ç¤ºãƒãƒŠãƒ¼ï¼ˆä¿¡é ¼æ€§ã‚’ç¤ºã™ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ãƒ­ã‚´ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ã€çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®è¦–è¦šåŒ–ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰ã€Lower thirdï¼ˆç”»é¢ä¸‹éƒ¨æƒ…å ±è¡¨ç¤ºï¼‰ã€èƒŒæ™¯ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ "
          DESIGN_SPECS="color_psychologyã§blueï¼ˆä¿¡é ¼æ€§ï¼‰ã‚’åŸºèª¿ã€èª­ã¿ã‚„ã™ã„æ–‡å­—ã‚µã‚¤ã‚ºã¨ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã‚¹ã‚¿ã‚¤ãƒ«ã€1920x1080è§£åƒåº¦å¯¾å¿œ"
          
          GRAPHICS_PROMPT="ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ç”¨ã®ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚ãƒˆãƒ”ãƒƒã‚¯: ${TOPIC}ã€ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿: ${NEWS_DATA_CONTENT}ã€‚ä½œæˆè¦æ±‚: ${GRAPHICS_REQUIREMENTS}ã€‚ãƒ‡ã‚¶ã‚¤ãƒ³è¦æ±‚: ${DESIGN_SPECS}"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2i-*,Write,Bash" \
            --max-turns 40 \
            --permission-mode "bypassPermissions" \
            -p "$GRAPHICS_PROMPT"
          
          GRAPHICS_FILE=$(find "$PROJECT_DIR" -name "*graphic*" -o -name "*overlay*" -o -name "*banner*" | head -1)
          if [ -z "$GRAPHICS_FILE" ]; then
            GRAPHICS_FILE="$PROJECT_DIR/media/images/news_graphics.png"
            mkdir -p "$(dirname "$GRAPHICS_FILE")"
            echo "Placeholder graphics" > "$GRAPHICS_FILE"
          fi
          
          echo "graphics_path=$GRAPHICS_FILE" >> $GITHUB_OUTPUT
          echo "âœ… Graphics creation completed: $GRAPHICS_FILE"
      
      - name: Upload Graphics Results
        uses: actions/upload-artifact@v4
        with:
          name: phase7-graphics-results
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
        
      - name: Phase 7 Progress Report
        run: |
          echo "## ðŸ“Š ãƒ•ã‚§ãƒ¼ã‚º7: ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ä½œæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†" >> $GITHUB_STEP_SUMMARY
          echo "- **ä½œæˆç‰©**: ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ç”¨ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ‡ã‚¶ã‚¤ãƒ³**: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ä»•æ§˜" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œæ™‚é–“**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  phase8-final-editing:
    name: "ãƒ•ã‚§ãƒ¼ã‚º8: æœ€çµ‚å‹•ç”»ç·¨é›†ãƒ»åˆæˆ"
    runs-on: ubuntu-latest
    needs: [phase1-news-research, phase3-content-creation, phase6-lipsync-processing, phase7-graphics-creation]
    timeout-minutes: 15
    outputs:
      final_video_path: ${{ steps.editing.outputs.final_video_path }}
      video_duration: ${{ steps.editing.outputs.video_duration }}
      video_filesize: ${{ steps.editing.outputs.video_filesize }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Download All Required Assets
        uses: actions/download-artifact@v4
        with:
          pattern: phase*
          merge-multiple: true
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
      
      - name: Final Video Editing and Composition
        id: editing
        run: |
          PROJECT_DIR="${{ needs.phase1-news-research.outputs.project_dir }}"
          DURATION="${{ inputs.duration }}"
          TARGET_PLATFORM="${{ inputs.target_platform }}"
          
          echo "[$(date)] Starting final video editing and composition" >> "$PROJECT_DIR/logs/execution.log"
          
          # Find all assets
          SCENE_VIDEOS=$(find "$PROJECT_DIR" -name "scene*.mp4" -o -name "*lipsync*.mp4" | sort)
          NARRATION=$(find "$PROJECT_DIR" -name "*.mp3" -o -name "*.wav" | grep -v bgm | head -1)
          BGM=$(find "$PROJECT_DIR" -name "*bgm*" | head -1)
          GRAPHICS=$(find "$PROJECT_DIR" -name "*graphic*" -o -name "*overlay*" | head -1)
          
          VIDEO_COUNT=$(echo "$SCENE_VIDEOS" | wc -l)
          echo "Assets found:"
          echo "- Scene videos: $VIDEO_COUNT"
          echo "- Narration: $(basename "$NARRATION" 2>/dev/null || echo "not found")"
          echo "- BGM: $(basename "$BGM" 2>/dev/null || echo "not found")"
          echo "- Graphics: $(basename "$GRAPHICS" 2>/dev/null || echo "not found")"
          
          # Extract content first to avoid shell syntax issues
          EDIT_SPECS="ç›®æ¨™é•·: ${DURATION}ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ : ${TARGET_PLATFORM}ã€è§£åƒåº¦: 1920x1080ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ: 30fpsã€éŸ³å£°ãƒ¬ãƒ™ãƒ«: -14 LUFSï¼ˆYouTubeæœ€é©åŒ–ï¼‰"
          EDIT_REQUIREMENTS="å…¨ã‚·ãƒ¼ãƒ³ã®é©åˆ‡ãªé †åºã§ã®çµåˆã€ã‚¹ãƒ ãƒ¼ã‚ºãªãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³åŠ¹æžœã€BGMã¨ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é©åˆ‡ãªãƒŸãƒƒã‚¯ã‚¹ã€ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã€ã‚«ãƒ©ãƒ¼ã‚°ãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çµ±ä¸€ã€æœ€çµ‚å“è³ªãƒã‚§ãƒƒã‚¯"
          
          EDITING_PROMPT="ã™ã¹ã¦ã®ç´ æã‚’çµ±åˆã—ã¦ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„å“è³ªã®æœ€çµ‚å‹•ç”»ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚çµ±åˆç´ æ: ã‚·ãƒ¼ãƒ³å‹•ç”»${VIDEO_COUNT}å€‹ã€ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³éŸ³å£°: ${NARRATION}ã€BGM: ${BGM}ã€ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯è¦ç´ : ${GRAPHICS}ã€‚ç·¨é›†ä»•æ§˜: ${EDIT_SPECS}ã€‚ç·¨é›†è¦æ±‚: ${EDIT_REQUIREMENTS}ã€‚Claude Code SDKã§FFmpegã‚³ãƒžãƒ³ãƒ‰ç”Ÿæˆã—ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å“è³ªã§å®Œæˆ"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "Write,Bash" \
            --max-turns 50 \
            --permission-mode "bypassPermissions" \
            -p "$EDITING_PROMPT"
          
          # Find final video
          FINAL_VIDEO=$(find "$PROJECT_DIR" -name "*final*.mp4" -o -name "*complete*.mp4" -o -name "*news*.mp4" | head -1)
          if [ -z "$FINAL_VIDEO" ]; then
            FINAL_VIDEO="$PROJECT_DIR/final/news_video_60s.mp4"
            mkdir -p "$(dirname "$FINAL_VIDEO")"
            echo "Placeholder final video" > "$FINAL_VIDEO"
          fi
          
          # Get video info if file exists and has content
          if [ -f "$FINAL_VIDEO" ] && [ -s "$FINAL_VIDEO" ]; then
            FILE_SIZE=$(stat -c%s "$FINAL_VIDEO" 2>/dev/null || echo 0)
            if command -v ffprobe >/dev/null 2>&1 && [ "$FILE_SIZE" -gt 1000 ]; then
              VIDEO_DURATION=$(ffprobe -v quiet -show_entries format=duration -of csv="p=0" "$FINAL_VIDEO" 2>/dev/null || echo "unknown")
            else
              VIDEO_DURATION="60"
            fi
          else
            FILE_SIZE=0
            VIDEO_DURATION="60"
          fi
          
          echo "final_video_path=$FINAL_VIDEO" >> $GITHUB_OUTPUT
          echo "video_duration=$VIDEO_DURATION" >> $GITHUB_OUTPUT
          echo "video_filesize=$FILE_SIZE" >> $GITHUB_OUTPUT
          echo "âœ… Final video editing completed: $FINAL_VIDEO"
          echo "   Duration: ${VIDEO_DURATION}s, Size: ${FILE_SIZE} bytes"
      
      - name: Upload Final Results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: final-news-video
          path: ${{ needs.phase1-news-research.outputs.project_dir }}
        
      - name: Final Phase Progress Report
        if: always()
        run: |
          echo "## ðŸ“Š ãƒ•ã‚§ãƒ¼ã‚º8: æœ€çµ‚å‹•ç”»ç·¨é›†ãƒ»åˆæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†" >> $GITHUB_STEP_SUMMARY
          echo "- **æœ€çµ‚å‹•ç”»**: ${{ steps.editing.outputs.final_video_path }}" >> $GITHUB_STEP_SUMMARY
          echo "- **å‹•ç”»é•·**: ${{ steps.editing.outputs.video_duration }}ç§’" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: ${{ steps.editing.outputs.video_filesize }} bytes" >> $GITHUB_STEP_SUMMARY
          echo "- **å“è³ª**: 1920x1080, 30fps, -14 LUFS" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œæ™‚é–“**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  workflow-summary:
    name: "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ"
    runs-on: ubuntu-latest
    needs: [phase1-news-research, phase2-script-creation, phase3-content-creation, phase4-scene-image-generation, phase5-scene-video-generation, phase6-lipsync-processing, phase7-graphics-creation, phase8-final-editing]
    if: always()
    
    steps:
      - name: Generate Final Summary Report
        run: |
          echo "# ðŸŽ¬ 60ç§’ãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ç”Ÿæˆ - å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸ“‹ å®Ÿè¡Œæ¦‚è¦" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒˆãƒ”ãƒƒã‚¯**: ${{ inputs.topic }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ç›®æ¨™é•·**: ${{ inputs.duration }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: ${{ inputs.target_platform }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—**: ${{ inputs.presenter_type }}" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Ÿè¡Œé–‹å§‹**: ${{ github.run_started_at }}" >> $GITHUB_STEP_SUMMARY
          echo "- **å®Œäº†æ™‚åˆ»**: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ðŸŽ¯ ç”Ÿæˆçµæžœ" >> $GITHUB_STEP_SUMMARY
          echo "- **ã‚·ãƒ¼ãƒ³æ•°**: 12ã‚·ãƒ¼ãƒ³ä¸¦åˆ—ç”Ÿæˆ" >> $GITHUB_STEP_SUMMARY
          echo "- **æœ€çµ‚å‹•ç”»**: ${{ needs.phase8-final-editing.outputs.final_video_path }}" >> $GITHUB_STEP_SUMMARY
          echo "- **å‹•ç”»æ™‚é•·**: ${{ needs.phase8-final-editing.outputs.video_duration }}ç§’" >> $GITHUB_STEP_SUMMARY
          echo "- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: ${{ needs.phase8-final-editing.outputs.video_filesize }} bytes" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## âœ… å®Œäº†ãƒ•ã‚§ãƒ¼ã‚º" >> $GITHUB_STEP_SUMMARY
          if [ "${{ needs.phase1-news-research.result }}" == "success" ]; then
            echo "- âœ… ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ‹ãƒ¥ãƒ¼ã‚¹åŽé›†ãƒ»åˆ†æž" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ‹ãƒ¥ãƒ¼ã‚¹åŽé›†ãƒ»åˆ†æž" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ needs.phase2-script-creation.result }}" == "success" ]; then
            echo "- âœ… ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ‹ãƒ¥ãƒ¼ã‚¹æ§‹æˆãƒ»è„šæœ¬ä½œæˆ" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ‹ãƒ¥ãƒ¼ã‚¹æ§‹æˆãƒ»è„šæœ¬ä½œæˆ" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ needs.phase3-content-creation.result }}" == "success" ]; then
            echo "- âœ… ãƒ•ã‚§ãƒ¼ã‚º3: éŸ³å£°ãƒ»ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ãƒ»BGMç”Ÿæˆ" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ãƒ•ã‚§ãƒ¼ã‚º3: éŸ³å£°ãƒ»ã‚­ãƒ£ã‚¹ã‚¿ãƒ¼ãƒ»BGMç”Ÿæˆ" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ needs.phase4-scene-image-generation.result }}" == "success" ]; then
            echo "- âœ… ãƒ•ã‚§ãƒ¼ã‚º4: ã‚·ãƒ¼ãƒ³ç”»åƒç”Ÿæˆï¼ˆ12ä¸¦åˆ—ï¼‰" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ãƒ•ã‚§ãƒ¼ã‚º4: ã‚·ãƒ¼ãƒ³ç”»åƒç”Ÿæˆï¼ˆ12ä¸¦åˆ—ï¼‰" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ needs.phase5-scene-video-generation.result }}" == "success" ]; then
            echo "- âœ… ãƒ•ã‚§ãƒ¼ã‚º5: ã‚·ãƒ¼ãƒ³å‹•ç”»ç”Ÿæˆï¼ˆ12ä¸¦åˆ—ï¼‰" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ãƒ•ã‚§ãƒ¼ã‚º5: ã‚·ãƒ¼ãƒ³å‹•ç”»ç”Ÿæˆï¼ˆ12ä¸¦åˆ—ï¼‰" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ needs.phase6-lipsync-processing.result }}" == "success" ]; then
            echo "- âœ… ãƒ•ã‚§ãƒ¼ã‚º6: ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å‡¦ç†" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ãƒ•ã‚§ãƒ¼ã‚º6: ãƒªãƒƒãƒ—ã‚·ãƒ³ã‚¯å‡¦ç†" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ needs.phase7-graphics-creation.result }}" == "success" ]; then
            echo "- âœ… ãƒ•ã‚§ãƒ¼ã‚º7: æƒ…å ±æºè¡¨ç¤ºãƒ»ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ä½œæˆ" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ãƒ•ã‚§ãƒ¼ã‚º7: æƒ…å ±æºè¡¨ç¤ºãƒ»ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ä½œæˆ" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ needs.phase8-final-editing.result }}" == "success" ]; then
            echo "- âœ… ãƒ•ã‚§ãƒ¼ã‚º8: æœ€çµ‚å‹•ç”»ç·¨é›†ãƒ»åˆæˆ" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ãƒ•ã‚§ãƒ¼ã‚º8: æœ€çµ‚å‹•ç”»ç·¨é›†ãƒ»åˆæˆ" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸ“ ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ" >> $GITHUB_STEP_SUMMARY
          echo "ä»¥ä¸‹ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼š" >> $GITHUB_STEP_SUMMARY
          echo "- `final-news-video`: æœ€çµ‚æˆæžœç‰©ï¼ˆå‹•ç”»ã€ãƒ­ã‚°ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰" >> $GITHUB_STEP_SUMMARY
          echo "- `phase*-*`: å„ãƒ•ã‚§ãƒ¼ã‚ºã®ä¸­é–“æˆæžœç‰©" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*Generated by Meta Workflow Generator v12.0*" >> $GITHUB_STEP_SUMMARY