# å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶ä½œ - è¶…è©³ç´°ã‚¿ã‚¹ã‚¯åˆ†è§£
name: "Hybrid Optimized Workflow (Stepback Enhanced)"
description: "ãƒ†ã‚­ã‚¹ãƒˆâ†’ç”»åƒâ†’å‹•ç”»â†’éŸ³å£°ã®å®Œå…¨ãªå‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶ä½œãƒ•ãƒ­ãƒ¼"
category: "multimedia-content-creation"
complexity_level: 5
estimated_duration_minutes: 45

# å‹•çš„ãƒ¢ãƒ¼ãƒ€ãƒ«å…¥åŠ›ä»•æ§˜ (Dynamic Modal Input Specification)
dynamic_inputs_spec:
  modal_title: "å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶ä½œè¨­å®š"
  modal_description: "ãƒ†ã‚­ã‚¹ãƒˆâ†’ç”»åƒâ†’å‹•ç”»â†’éŸ³å£°ã®å®Œå…¨ãªå‹•ç”»åˆ¶ä½œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š"
  form_sections:
    - section_name: "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¼ç”»"
      section_description: "å‹•ç”»ã®åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨ã‚¹ãƒˆãƒ¼ãƒªãƒ¼"
      inputs:
        - name: "video_concept"
          label: "å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆãƒ»ãƒ†ãƒ¼ãƒ"
          type: "textarea"
          required: true
          placeholder: "ä¾‹: å•†å“ç´¹ä»‹å‹•ç”»ã€ç¾ã—ã„é¢¨æ™¯ã¨å…±ã«æ–°è£½å“ã®é­…åŠ›ã‚’ä¼ãˆã‚‹"
          description: "å‹•ç”»å…¨ä½“ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è©³ç´°ã«å…¥åŠ›"
          validation:
            min_length: 20
            max_length: 800
        
        - name: "target_audience"
          label: "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¦–è´è€…"
          type: "select"
          required: true
          options:
            - value: "general"
              label: "ğŸŒ ä¸€èˆ¬è¦–è´è€… (å¹…åºƒã„å¹´é½¢å±¤)"
            - value: "business"
              label: "ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹ãƒ»ä¼æ¥­å‘ã‘"
            - value: "young_adult"
              label: "ğŸ¯ è‹¥å¹´å±¤ (20-35æ­³)"
            - value: "professional"
              label: "ğŸ‘” å°‚é–€è·ãƒ»æŠ€è¡“è€…å‘ã‘"
            - value: "creative"
              label: "ğŸ¨ ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ãƒ»ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå‘ã‘"
          default: "general"
        
        - name: "video_length"
          label: "å‹•ç”»å°º (ç§’)"
          type: "range"
          required: true
          min: 15
          max: 300
          default: 60
          step: 15
          description: "ç”Ÿæˆã™ã‚‹å‹•ç”»ã®é•·ã• (15ç§’-5åˆ†)"

    - section_name: "ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¨­å®š"
      section_description: "æ˜ åƒã‚¹ã‚¿ã‚¤ãƒ«ã¨å“è³ªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"
      inputs:
        - name: "visual_style"
          label: "æ˜ åƒã‚¹ã‚¿ã‚¤ãƒ«"
          type: "select"
          required: true
          options:
            - value: "cinematic"
              label: "ğŸ¬ ã‚·ãƒãƒãƒ†ã‚£ãƒƒã‚¯ (æ˜ ç”»çš„ãƒ»ãƒ‰ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯)"
            - value: "documentary"
              label: "ğŸ“º ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ã‚¿ãƒªãƒ¼ (ãƒªã‚¢ãƒ«ãƒ»æƒ…å ±é‡è¦–)"
            - value: "commercial"
              label: "ğŸ“º ã‚³ãƒãƒ¼ã‚·ãƒ£ãƒ« (å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç´¹ä»‹)"
            - value: "educational"
              label: "ğŸ“š æ•™è‚²ãƒ»è§£èª¬ (åˆ†ã‹ã‚Šã‚„ã™ã„æ§‹æˆ)"
            - value: "artistic"
              label: "ğŸ¨ ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒ†ã‚£ãƒƒã‚¯ (å‰µé€ çš„ãƒ»å®Ÿé¨“çš„)"
          default: "commercial"
        
        - name: "color_mood"
          label: "è‰²èª¿ãƒ»ãƒ ãƒ¼ãƒ‰"
          type: "select"
          required: true
          options:
            - value: "vibrant"
              label: "ğŸŒˆ é®®ã‚„ã‹ãƒ»æ´»å‹•çš„"
            - value: "warm"
              label: "ğŸŒ… æš–è‰²ãƒ»è¦ªã—ã¿ã‚„ã™ã„"
            - value: "cool"
              label: "â„ï¸ å¯’è‰²ãƒ»ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«"
            - value: "monochrome"
              label: "âš« ãƒ¢ãƒã‚¯ãƒ­ãƒ¼ãƒ ãƒ»ã‚·ãƒƒã‚¯"
            - value: "natural"
              label: "ğŸŒ¿ è‡ªç„¶ãƒ»ã‚ªãƒ¼ã‚¬ãƒ‹ãƒƒã‚¯"
          default: "vibrant"

    - section_name: "æŠ€è¡“è¨­å®š"
      section_description: "å‹•ç”»å“è³ªã¨ç”Ÿæˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"
      inputs:
        - name: "video_quality"
          label: "å‹•ç”»å“è³ª"
          type: "select"
          required: true
          options:
            - value: "ultra_hd"
              label: "ğŸ”¥ Ultra HD (æœ€é«˜å“è³ªãƒ»æ™‚é–“ãŒã‹ã‹ã‚‹)"
            - value: "high_def"
              label: "âœ¨ High Definition (é«˜å“è³ªãƒ»ãƒãƒ©ãƒ³ã‚¹)"
            - value: "standard"
              label: "ğŸ“º Standard (æ¨™æº–å“è³ªãƒ»é«˜é€Ÿ)"
          default: "high_def"
        
        - name: "frame_rate"
          label: "ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ"
          type: "select"
          required: true
          options:
            - value: "24fps"
              label: "ğŸ¬ 24fps (æ˜ ç”»çš„)"
            - value: "30fps"
              label: "ğŸ“º 30fps (æ¨™æº–)"
            - value: "60fps"
              label: "âš¡ 60fps (æ»‘ã‚‰ã‹)"
          default: "30fps"
        
        - name: "audio_integration"
          label: "éŸ³å£°çµ±åˆ"
          type: "select"
          required: true
          options:
            - value: "full_audio"
              label: "ğŸµ ãƒ•ãƒ«éŸ³å£° (BGM + åŠ¹æœéŸ³ + ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)"
            - value: "bgm_only"
              label: "ğŸ¶ BGMã®ã¿"
            - value: "silent"
              label: "ğŸ”‡ ç„¡éŸ³ (æ˜ åƒã®ã¿)"
          default: "full_audio"

# GitHub Actions inputså¤‰æ›ãƒãƒƒãƒ”ãƒ³ã‚°
github_actions_inputs_mapping:
  inputs_conversion:
    textarea: "string"
    select: "choice"
    range: "number"
  
  generated_inputs_preview:
    video_concept:
      description: "å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆãƒ»ãƒ†ãƒ¼ãƒ"
      required: true
      type: string
    visual_style:
      description: "æ˜ åƒã‚¹ã‚¿ã‚¤ãƒ«"
      required: true
      type: choice
      options: ["cinematic", "documentary", "commercial", "educational", "artistic"]
      default: "commercial"

# äººé–“ã®ç„¡æ„è­˜æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹
human_process:
  - phase: "concept_planning"
    description: "ã‚³ãƒ³ã‚»ãƒ—ãƒˆä¼ç”»æ®µéšï¼ˆç›®çš„ãƒ»å¯¾è±¡ãƒ»æ§‹æˆã®æ±ºå®šï¼‰"
  - phase: "script_storyboard"
    description: "å°æœ¬ãƒ»çµµã‚³ãƒ³ãƒ†æ®µéšï¼ˆå†…å®¹è¨­è¨ˆãƒ»è¦–è¦šæ§‹æˆï¼‰"
  - phase: "visual_creation" 
    description: "ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«åˆ¶ä½œæ®µéšï¼ˆç”»åƒãƒ»ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ç”Ÿæˆï¼‰"
  - phase: "video_production"
    description: "å‹•ç”»åˆ¶ä½œæ®µéšï¼ˆå‹•ç”»ç”Ÿæˆãƒ»ç·¨é›†ãƒ»èª¿æ•´ï¼‰"
  - phase: "audio_integration"
    description: "éŸ³å£°çµ±åˆæ®µéšï¼ˆBGMãƒ»åŠ¹æœéŸ³ãƒ»ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰"
  - phase: "post_production"
    description: "ãƒã‚¹ãƒˆãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ®µéšï¼ˆæœ€çµ‚ç·¨é›†ãƒ»å“è³ªç®¡ç†ãƒ»é…ä¿¡æº–å‚™ï¼‰"

# GitHub Actions ãƒãƒ¼ãƒ‰è¨­è¨ˆ
github_actions_config:
  workflow_name: "Video Content Creation Pipeline"
  on_triggers: ["workflow_dispatch", "issues"]
  permissions:
    contents: "write"
    issues: "write"
    actions: "read"
  artifacts_retention_days: 30
  max_parallel_jobs: 3

# è¶…è©³ç´°ã‚¿ã‚¹ã‚¯åˆ†è§£
tasks:
  # === äº‹å‰ãƒ†ã‚¹ãƒˆæ®µéš ===
  - id: "media-services-connectivity-test"
    name: "ãƒ¡ãƒ‡ã‚£ã‚¢ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ"
    phase: "pre_validation"
    github_job: "connectivity-test"
    type: "validation"
    implementation: "mcp"
    duration_minutes: 4
    dependencies: []
    parallel_group: null
    
    github_steps:
      - name: "Test media generation services"
        shell: "bash"
        script: |
          echo "ğŸ¬ Testing video content creation services..."
          
          mkdir -p .logs/connectivity-tests
          
          # ç”»åƒç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆå‹•ç”»ã®åŸºç¤ç´ æï¼‰
          echo "Testing image generation services..."
          if timeout 60 claude --mcp-config .claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-ultra --prompt "test video frame" > .logs/connectivity-tests/image-test.log 2>&1; then
            IMAGE_GEN_STATUS="success"
            echo "âœ… Image Generation (Imagen4 Ultra): Available"
          elif timeout 45 claude --mcp-config .claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-fast --prompt "test video frame" > .logs/connectivity-tests/image-fast-test.log 2>&1; then
            IMAGE_GEN_STATUS="success_fast"
            echo "âœ… Image Generation (Imagen4 Fast): Available"
          else
            IMAGE_GEN_STATUS="failed"
            echo "âŒ Image Generation: Failed"
          fi
          
          # å‹•ç”»ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆT2Vï¼‰
          echo "Testing text-to-video generation..."
          if timeout 120 claude --mcp-config .claude/mcp-kamuicode.json --mcp t2v-fal-veo3-fast --prompt "test short video clip" > .logs/connectivity-tests/t2v-test.log 2>&1; then
            T2V_STATUS="success"
            echo "âœ… Text-to-Video (Veo3): Available"
          else
            T2V_STATUS="failed"
            echo "âŒ Text-to-Video: Failed"
          fi
          
          # ç”»åƒâ†’å‹•ç”»å¤‰æ›ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆI2Vï¼‰
          echo "Testing image-to-video generation..."
          if timeout 90 claude --mcp-config .claude/mcp-kamuicode.json --mcp i2v-fal-hailuo-02-pro --image-path "/tmp/test.jpg" > .logs/connectivity-tests/i2v-test.log 2>&1; then
            I2V_STATUS="success"
            echo "âœ… Image-to-Video (Hailuo-02): Available"
          else
            I2V_STATUS="failed"
            echo "âš ï¸ Image-to-Video: Not available - will use T2V only"
          fi
          
          # éŸ³æ¥½ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆBGMç”¨ï¼‰
          echo "Testing music generation..."
          if timeout 90 claude --mcp-config .claude/mcp-kamuicode.json --mcp t2m-google-lyria --prompt "test background music" > .logs/connectivity-tests/music-test.log 2>&1; then
            MUSIC_STATUS="success"
            echo "âœ… Music Generation (Lyria): Available"
          else
            MUSIC_STATUS="failed"
            echo "âš ï¸ Music Generation: Not available - will use external audio"
          fi
          
          # å‹•ç”»â†’éŸ³å£°ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆåŠ¹æœéŸ³ç”¨ï¼‰
          echo "Testing video-to-audio generation..."
          if timeout 60 claude --mcp-config .claude/mcp-kamuicode.json --mcp v2a-fal-thinksound --video-path "/tmp/test.mp4" > .logs/connectivity-tests/v2a-test.log 2>&1; then
            V2A_STATUS="success"
            echo "âœ… Video-to-Audio (ThinkSound): Available"
          else
            V2A_STATUS="failed"
            echo "âš ï¸ Video-to-Audio: Not available - will use manual audio"
          fi
          
          # å‹•ç”»ç·¨é›†ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£ãƒ»å¼·åŒ–ç”¨ï¼‰
          echo "Testing video modification services..."
          if timeout 60 claude --mcp-config .claude/mcp-kamuicode.json --mcp v2v-fal-luma-ray2-modify --video-path "/tmp/test.mp4" --modification "enhance quality" > .logs/connectivity-tests/v2v-test.log 2>&1; then
            V2V_STATUS="success"
            echo "âœ… Video-to-Video Modification (Luma Ray-2): Available"
          else
            V2V_STATUS="failed"
            echo "âš ï¸ Video Modification: Not available - basic editing only"
          fi
          
          # ãƒ†ã‚¹ãƒˆçµæœã‚’JSONä¿å­˜
          cat > .logs/connectivity-tests/test-results.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "media_services": {
              "image_generation": "$IMAGE_GEN_STATUS",
              "text_to_video": "$T2V_STATUS",
              "image_to_video": "$I2V_STATUS",
              "music_generation": "$MUSIC_STATUS",
              "video_to_audio": "$V2A_STATUS",
              "video_modification": "$V2V_STATUS"
            },
            "production_capability": "$([ "$IMAGE_GEN_STATUS" != "failed" ] && [ "$T2V_STATUS" = "success" ] && echo "full" || echo "limited")",
            "workflow_can_proceed": $([ "$IMAGE_GEN_STATUS" != "failed" ] && [ "$T2V_STATUS" = "success" ] && echo "true" || echo "false"),
            "enhanced_features": $([ "$MUSIC_STATUS" = "success" ] && [ "$V2A_STATUS" = "success" ] && echo "true" || echo "false")
          }
          EOF
          
          # ç’°å¢ƒå¤‰æ•°ã«çµæœã‚’è¨­å®š
          echo "PRODUCTION_CAPABILITY=$([ "$IMAGE_GEN_STATUS" != "failed" ] && [ "$T2V_STATUS" = "success" ] && echo "full" || echo "limited")" >> $GITHUB_ENV
          echo "ENHANCED_AUDIO=$([ "$MUSIC_STATUS" = "success" ] && [ "$V2A_STATUS" = "success" ] && echo "true" || echo "false")" >> $GITHUB_ENV
          echo "VIDEO_EDITING=$([ "$V2V_STATUS" = "success" ] && echo "true" || echo "false")" >> $GITHUB_ENV
          
          echo "ğŸ¬ Media services connectivity tests completed"
          
    validation:
      criteria:
        - "ç”»åƒç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨å¯èƒ½"
        - "å‹•ç”»ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ãŒåˆ©ç”¨å¯èƒ½"
        - "ãƒ†ã‚¹ãƒˆçµæœãŒJSONå½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã‚‹"
      validation_script: |
        if [ ! -f ".logs/connectivity-tests/test-results.json" ]; then
          echo "âŒ VALIDATION FAILED: Test results missing"
          exit 1
        fi
        
        WORKFLOW_CAN_PROCEED=$(jq -r '.workflow_can_proceed' .logs/connectivity-tests/test-results.json)
        if [ "$WORKFLOW_CAN_PROCEED" = "true" ]; then
          echo "âœ… Validation passed: Video production services ready"
        else
          echo "âŒ VALIDATION FAILED: Critical video services unavailable"
          exit 1
        fi

  # === ã‚³ãƒ³ã‚»ãƒ—ãƒˆä¼ç”»æ®µéš ===
  - id: "video-concept-planning"
    name: "å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆãƒ»ä¼ç”»ç«‹æ¡ˆ"
    phase: "concept_planning"
    github_job: "concept-planning"
    type: "planning"
    implementation: "ai"
    duration_minutes: 4
    dependencies: ["media-services-connectivity-test"]
    parallel_group: null
    
    github_steps:
      - name: "Plan video concept and strategy"
        shell: "bash"
        script: |
          echo "ğŸ“‹ Planning video concept and strategy..."
          
          mkdir -p .logs/concept-planning
          
          # å…¥åŠ›ã‹ã‚‰ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æŠ½å‡º
          VIDEO_TOPIC="${{ github.event.inputs.video_topic || github.event.issue.title || 'promotional video' }}"
          TARGET_AUDIENCE="${{ github.event.inputs.target_audience || 'general audience' }}"
          VIDEO_LENGTH="${{ github.event.inputs.video_length || '30 seconds' }}"
          VIDEO_STYLE="${{ github.event.inputs.video_style || 'modern and engaging' }}"
          
          echo "Video topic: $VIDEO_TOPIC"
          echo "Target audience: $TARGET_AUDIENCE"
          echo "Desired length: $VIDEO_LENGTH"
          echo "Style preference: $VIDEO_STYLE"
          
          # Claude Code ã§ã‚³ãƒ³ã‚»ãƒ—ãƒˆä¼ç”»
          claude-code --prompt "ä»¥ä¸‹ã®è¦ä»¶ã«åŸºã¥ã„ã¦ã€å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è©³ç´°ãªã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ä¼ç”»ã—ã¦ãã ã•ã„ï¼š
          
          å‹•ç”»ãƒ†ãƒ¼ãƒ: $VIDEO_TOPIC
          å¯¾è±¡è¦–è´è€…: $TARGET_AUDIENCE
          å‹•ç”»ã®é•·ã•: $VIDEO_LENGTH
          ã‚¹ã‚¿ã‚¤ãƒ«: $VIDEO_STYLE
          
          ä»¥ä¸‹ã®å½¢å¼ã§JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
          {
            \"video_concept\": {
              \"title\": \"å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«\",
              \"main_message\": \"ä¼ãˆãŸã„ä¸»è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\",
              \"tone\": \"ãƒˆãƒ¼ãƒ³ï¼ˆprofessional|casual|exciting|informativeç­‰ï¼‰\",
              \"visual_style\": \"ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ã®è©³ç´°\",
              \"pacing\": \"ãƒ†ãƒ³ãƒï¼ˆfast|medium|slowï¼‰\"
            },
            \"target_analysis\": {
              \"primary_audience\": \"ä¸»è¦ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ\",
              \"viewing_context\": \"è¦–è´ã‚·ãƒ¼ãƒ³\",
              \"key_interests\": [\"è¦–è´è€…ã®é–¢å¿ƒäº‹\"],
              \"preferred_content_type\": \"å¥½ã¾ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—\"
            },
            \"content_strategy\": {
              \"hook_strategy\": \"å†’é ­ã§ã®æ³¨æ„å–šèµ·æ–¹æ³•\",
              \"story_arc\": \"ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ§‹æˆ\",
              \"call_to_action\": \"è¡Œå‹•å–šèµ·ã®å†…å®¹\",
              \"emotional_journey\": \"æ„Ÿæƒ…çš„ãªæµã‚Œ\"
            },
            \"technical_requirements\": {
              \"estimated_scenes\": \"æƒ³å®šã‚·ãƒ¼ãƒ³æ•°\",
              \"aspect_ratio\": \"æ¨å¥¨ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”\",
              \"resolution\": \"æ¨å¥¨è§£åƒåº¦\",
              \"estimated_total_duration\": \"ç·å°ºã®è¦‹ç©ã‚‚ã‚Š\"
            },
            \"production_notes\": [\"åˆ¶ä½œæ™‚ã®é‡è¦ãªæ³¨æ„ç‚¹\"]
          }" > .logs/concept-planning/video-concept.json
          
          VIDEO_CONCEPT=$(cat .logs/concept-planning/video-concept.json)
          echo "VIDEO_CONCEPT_FILE=.logs/concept-planning/video-concept.json" >> $GITHUB_ENV
          
          # ã‚³ãƒ³ã‚»ãƒ—ãƒˆæ¦‚è¦ã‚’è¡¨ç¤º
          echo "ğŸ“‹ Video concept planning completed"
          echo "Title: $(echo "$VIDEO_CONCEPT" | jq -r '.video_concept.title')"
          echo "Style: $(echo "$VIDEO_CONCEPT" | jq -r '.video_concept.visual_style')"

  - id: "script-storyboard-creation"
    name: "å°æœ¬ãƒ»çµµã‚³ãƒ³ãƒ†ä½œæˆ"
    phase: "script_storyboard"
    github_job: "script-storyboard"
    type: "creation"
    implementation: "ai"
    duration_minutes: 6
    dependencies: ["video-concept-planning"]
    parallel_group: null
    
    github_steps:
      - name: "Create detailed script and storyboard"
        shell: "bash"
        script: |
          echo "ğŸ“ Creating script and storyboard..."
          
          mkdir -p .logs/script-storyboard
          
          VIDEO_CONCEPT=$(cat .logs/concept-planning/video-concept.json)
          
          # è©³ç´°å°æœ¬ã®ä½œæˆ
          claude-code --prompt "ä»¥ä¸‹ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«åŸºã¥ã„ã¦ã€è©³ç´°ãªå‹•ç”»å°æœ¬ã¨çµµã‚³ãƒ³ãƒ†ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š
          
          å‹•ç”»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ: $VIDEO_CONCEPT
          
          ä»¥ä¸‹ã®å½¢å¼ã§JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
          {
            \"script_overview\": {
              \"total_duration\": \"ç·å°ºï¼ˆç§’ï¼‰\",
              \"scene_count\": \"ã‚·ãƒ¼ãƒ³æ•°\",
              \"narrative_structure\": \"ç‰©èªæ§‹é€ \"
            },
            \"detailed_script\": [
              {
                \"scene_number\": 1,
                \"duration_seconds\": \"ã‚·ãƒ¼ãƒ³å°º\",
                \"scene_type\": \"intro|main|transition|outro\",
                \"visual_description\": \"æ˜ åƒã®è©³ç´°èª¬æ˜\",
                \"audio_description\": \"éŸ³å£°ãƒ»éŸ³æ¥½ã®èª¬æ˜\",
                \"text_overlay\": \"ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å†…å®¹\",
                \"transition_type\": \"åˆ‡ã‚Šæ›¿ãˆæ–¹æ³•\",
                \"key_elements\": [\"é‡è¦ãªè¦–è¦šè¦ç´ \"],
                \"emotional_beat\": \"ã“ã®ã‚·ãƒ¼ãƒ³ã®æ„Ÿæƒ…çš„ãªå½¹å‰²\",
                \"technical_notes\": \"åˆ¶ä½œæ™‚ã®æŠ€è¡“çš„æ³¨æ„ç‚¹\"
              }
            ],
            \"storyboard_frames\": [
              {
                \"frame_number\": 1,
                \"scene_reference\": \"å¯¾å¿œã™ã‚‹ã‚·ãƒ¼ãƒ³ç•ªå·\",
                \"image_prompt\": \"ç”»åƒç”Ÿæˆç”¨ã®è©³ç´°ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\",
                \"composition\": \"æ§‹å›³ã®èª¬æ˜\",
                \"lighting\": \"lighting setup\",
                \"camera_angle\": \"ã‚«ãƒ¡ãƒ©ã‚¢ãƒ³ã‚°ãƒ«\",
                \"mood\": \"mood and atmosphere\",
                \"style_notes\": \"ã‚¹ã‚¿ã‚¤ãƒ«æŒ‡å®š\"
              }
            ],
            \"audio_requirements\": {
              \"background_music_style\": \"BGMã®ã‚¹ã‚¿ã‚¤ãƒ«\",
              \"sound_effects_needed\": [\"å¿…è¦ãªåŠ¹æœéŸ³\"],
              \"voice_over_segments\": [\"ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åŒºé–“\"],
              \"audio_transitions\": [\"éŸ³å£°ã®åˆ‡ã‚Šæ›¿ãˆ\"]
            },
            \"production_timeline\": {
              \"pre_production_tasks\": [\"äº‹å‰åˆ¶ä½œã‚¿ã‚¹ã‚¯\"],
              \"production_sequence\": [\"åˆ¶ä½œé †åº\"],
              \"post_production_tasks\": [\"å¾Œåˆ¶ä½œã‚¿ã‚¹ã‚¯\"]
            }
          }" > .logs/script-storyboard/detailed-script.json
          
          DETAILED_SCRIPT=$(cat .logs/script-storyboard/detailed-script.json)
          echo "DETAILED_SCRIPT_FILE=.logs/script-storyboard/detailed-script.json" >> $GITHUB_ENV
          
          # ã‚·ãƒ¼ãƒ³æ•°ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š
          SCENE_COUNT=$(echo "$DETAILED_SCRIPT" | jq -r '.script_overview.scene_count')
          echo "SCENE_COUNT=$SCENE_COUNT" >> $GITHUB_ENV
          
          echo "ğŸ“ Script and storyboard creation completed"
          echo "Total scenes: $SCENE_COUNT"

  # === ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«åˆ¶ä½œæ®µéš ===
  - id: "key-frame-generation"
    name: "ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒç”Ÿæˆ"
    phase: "visual_creation"
    github_job: "keyframe-generation"
    type: "generation"
    implementation: "mcp"
    tool: "image-generation"
    duration_minutes: 8
    dependencies: ["script-storyboard-creation"]
    parallel_group: "visual_creation_parallel"
    
    github_steps:
      - name: "Generate key frame images"
        shell: "bash"
        script: |
          echo "ğŸ¨ Generating key frame images..."
          
          mkdir -p .logs/visual-creation/keyframes
          
          DETAILED_SCRIPT=$(cat .logs/script-storyboard/detailed-script.json)
          
          # å„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒœãƒ¼ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ã®ç”»åƒã‚’ç”Ÿæˆ
          FRAME_COUNT=$(echo "$DETAILED_SCRIPT" | jq '.storyboard_frames | length')
          echo "Generating $FRAME_COUNT key frames..."
          
          for i in $(seq 0 $((FRAME_COUNT - 1))); do
            FRAME_DATA=$(echo "$DETAILED_SCRIPT" | jq ".storyboard_frames[$i]")
            FRAME_NUMBER=$(echo "$FRAME_DATA" | jq -r '.frame_number')
            IMAGE_PROMPT=$(echo "$FRAME_DATA" | jq -r '.image_prompt')
            COMPOSITION=$(echo "$FRAME_DATA" | jq -r '.composition')
            LIGHTING=$(echo "$FRAME_DATA" | jq -r '.lighting')
            MOOD=$(echo "$FRAME_DATA" | jq -r '.mood')
            
            echo "Generating frame $FRAME_NUMBER..."
            
            # é«˜å“è³ªç”»åƒç”Ÿæˆã‚’è©¦è¡Œ
            FULL_PROMPT="$IMAGE_PROMPT, $COMPOSITION, $LIGHTING, $MOOD, cinematic quality, 4K resolution, professional video production style"
            
            if [ "$PRODUCTION_CAPABILITY" = "full" ]; then
              # Imagen4 Ultra ã§é«˜å“è³ªç”Ÿæˆ
              if timeout 120 claude --mcp-config .claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-ultra --prompt "$FULL_PROMPT" > .logs/visual-creation/keyframes/frame-${FRAME_NUMBER}.json 2>&1; then
                echo "âœ… Frame $FRAME_NUMBER generated (Ultra quality)"
              else
                # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: Imagen4 Fast
                timeout 90 claude --mcp-config .claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-fast --prompt "$FULL_PROMPT" > .logs/visual-creation/keyframes/frame-${FRAME_NUMBER}.json 2>&1
                echo "âœ… Frame $FRAME_NUMBER generated (Fast mode)"
              fi
            else
              echo "âš ï¸ Limited mode: Frame $FRAME_NUMBER skipped"
            fi
          done
          
          # ç”Ÿæˆçµæœã®æ¤œè¨¼
          GENERATED_FRAMES=$(ls .logs/visual-creation/keyframes/frame-*.json 2>/dev/null | wc -l)
          
          # ç”Ÿæˆãƒ­ã‚°ã®ä½œæˆ
          cat > .logs/visual-creation/keyframes/generation-log.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "total_frames_requested": $FRAME_COUNT,
            "frames_generated": $GENERATED_FRAMES,
            "generation_quality": "$PRODUCTION_CAPABILITY",
            "frame_files": [$(ls .logs/visual-creation/keyframes/frame-*.json 2>/dev/null | sed 's/.*/"&"/' | paste -sd,)]
          }
          EOF
          
          echo "ğŸ¨ Key frame generation completed: $GENERATED_FRAMES/$FRAME_COUNT frames"

  - id: "visual-consistency-check"
    name: "ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ä¸€è²«æ€§ãƒã‚§ãƒƒã‚¯ãƒ»èª¿æ•´"
    phase: "visual_creation"
    github_job: "visual-consistency"
    type: "validation"
    implementation: "ai"
    duration_minutes: 4
    dependencies: ["key-frame-generation"]
    parallel_group: "visual_creation_parallel"
    
    github_steps:
      - name: "Check and adjust visual consistency"
        shell: "bash"
        script: |
          echo "ğŸ” Checking visual consistency..."
          
          mkdir -p .logs/visual-creation/consistency
          
          DETAILED_SCRIPT=$(cat .logs/script-storyboard/detailed-script.json)
          GENERATION_LOG=$(cat .logs/visual-creation/keyframes/generation-log.json)
          
          # ç”Ÿæˆã•ã‚ŒãŸç”»åƒã®ä¸€è²«æ€§ã‚’AIåˆ†æ
          claude-code --prompt "ä»¥ä¸‹ã®å‹•ç”»åˆ¶ä½œæƒ…å ±ã‚’åŸºã«ã€ç”Ÿæˆã•ã‚ŒãŸç”»åƒã®è¦–è¦šçš„ä¸€è²«æ€§ã‚’åˆ†æã—ã¦ãã ã•ã„ï¼š
          
          å‹•ç”»å°æœ¬: $DETAILED_SCRIPT
          ç”»åƒç”Ÿæˆãƒ­ã‚°: $GENERATION_LOG
          
          ä»¥ä¸‹ã®é …ç›®ã‚’è©•ä¾¡ã—ã€JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
          {
            \"consistency_analysis\": {
              \"overall_style_consistency\": \"1-10ç‚¹ã§ã®è©•ä¾¡\",
              \"color_palette_coherence\": \"1-10ç‚¹ã§ã®è©•ä¾¡\",
              \"lighting_consistency\": \"1-10ç‚¹ã§ã®è©•ä¾¡\",
              \"character_design_consistency\": \"1-10ç‚¹ã§ã®è©•ä¾¡\",
              \"environment_consistency\": \"1-10ç‚¹ã§ã®è©•ä¾¡\"
            },
            \"identified_issues\": [
              {
                \"issue_type\": \"å•é¡Œã®ã‚¿ã‚¤ãƒ—\",
                \"affected_frames\": [\"å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ç•ªå·\"],
                \"description\": \"å•é¡Œã®è©³ç´°\",
                \"severity\": \"high|medium|low\",
                \"suggested_fix\": \"ä¿®æ­£ææ¡ˆ\"
              }
            ],
            \"improvement_recommendations\": [
              {
                \"frame_number\": \"ãƒ•ãƒ¬ãƒ¼ãƒ ç•ªå·\",
                \"current_prompt\": \"ç¾åœ¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\",  
                \"improved_prompt\": \"æ”¹å–„ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\",
                \"reason\": \"æ”¹å–„ç†ç”±\"
              }
            ],
            \"quality_score\": {
              \"technical_quality\": \"1-10ç‚¹\",
              \"artistic_coherence\": \"1-10ç‚¹\",
              \"brand_consistency\": \"1-10ç‚¹\",
              \"overall_readiness\": \"ready|needs_improvement|major_revision\"
            },
            \"next_steps\": [\"æ¨å¥¨ã•ã‚Œã‚‹æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—\"]
          }" > .logs/visual-creation/consistency/analysis.json
          
          CONSISTENCY_ANALYSIS=$(cat .logs/visual-creation/consistency/analysis.json)
          OVERALL_READINESS=$(echo "$CONSISTENCY_ANALYSIS" | jq -r '.quality_score.overall_readiness')
          
          echo "VISUAL_READINESS=$OVERALL_READINESS" >> $GITHUB_ENV
          echo "CONSISTENCY_ANALYSIS_FILE=.logs/visual-creation/consistency/analysis.json" >> $GITHUB_ENV
          
          echo "ğŸ” Visual consistency check completed: $OVERALL_READINESS"

  # === å‹•ç”»åˆ¶ä½œæ®µéš ===
  - id: "primary-video-generation"
    name: "ãƒ¡ã‚¤ãƒ³å‹•ç”»ç”Ÿæˆ"
    phase: "video_production"
    github_job: "primary-video-generation"
    type: "generation"
    implementation: "mcp"
    tool: "video-generation"
    duration_minutes: 10
    dependencies: ["visual-consistency-check"]
    parallel_group: null
    
    github_steps:
      - name: "Generate primary video content"
        shell: "bash"
        script: |
          echo "ğŸ¬ Generating primary video content..."
          
          mkdir -p .logs/video-production
          
          DETAILED_SCRIPT=$(cat .logs/script-storyboard/detailed-script.json)
          VIDEO_CONCEPT=$(cat .logs/concept-planning/video-concept.json)
          
          # ãƒ¡ã‚¤ãƒ³ãƒ“ãƒ‡ã‚ªã®ç”Ÿæˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æº–å‚™
          TOTAL_DURATION=$(echo "$DETAILED_SCRIPT" | jq -r '.script_overview.total_duration')
          NARRATIVE_STRUCTURE=$(echo "$DETAILED_SCRIPT" | jq -r '.script_overview.narrative_structure')
          VISUAL_STYLE=$(echo "$VIDEO_CONCEPT" | jq -r '.video_concept.visual_style')
          TONE=$(echo "$VIDEO_CONCEPT" | jq -r '.video_concept.tone')
          
          # Text-to-Video ã§åŸºæœ¬å‹•ç”»ç”Ÿæˆ
          echo "Generating base video with T2V..."
          MAIN_VIDEO_PROMPT="$NARRATIVE_STRUCTURE video in $VISUAL_STYLE style, $TONE tone, duration: ${TOTAL_DURATION}s, professional quality, smooth transitions, cinematic composition"
          
          if timeout 180 claude --mcp-config .claude/mcp-kamuicode.json --mcp t2v-fal-veo3-fast --prompt "$MAIN_VIDEO_PROMPT" --duration "$TOTAL_DURATION" > .logs/video-production/main-video.json 2>&1; then
            echo "âœ… Main video generated successfully"
            MAIN_VIDEO_STATUS="success"
          else
            echo "âŒ Main video generation failed"
            MAIN_VIDEO_STATUS="failed"
          fi
          
          # Image-to-Video ã§ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ™ãƒ¼ã‚¹å‹•ç”»ç”Ÿæˆï¼ˆè£œå®Œç”¨ï¼‰
          if [ "$MAIN_VIDEO_STATUS" = "success" ] && [ -f ".logs/visual-creation/keyframes/frame-1.json" ]; then
            echo "Generating supplementary I2V content..."
            
            # æœ€åˆã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰å‹•ç”»ç”Ÿæˆ
            FIRST_FRAME_PATH=$(jq -r '.image_url // .file_path // "none"' .logs/visual-creation/keyframes/frame-1.json)
            
            if [ "$FIRST_FRAME_PATH" != "none" ] && timeout 150 claude --mcp-config .claude/mcp-kamuicode.json --mcp i2v-fal-hailuo-02-pro --image-path "$FIRST_FRAME_PATH" --motion-description "smooth cinematic motion matching video concept" > .logs/video-production/i2v-supplement.json 2>&1; then
              echo "âœ… I2V supplementary content generated"
              I2V_STATUS="success"
            else
              echo "âš ï¸ I2V supplementary generation failed"
              I2V_STATUS="failed"
            fi
          fi
          
          # ç”Ÿæˆçµæœã®ãƒ­ã‚°ä½œæˆ
          cat > .logs/video-production/video-generation-log.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "generation_summary": {
              "main_video_status": "$MAIN_VIDEO_STATUS",
              "i2v_supplement_status": "${I2V_STATUS:-not_attempted}",
              "total_duration_target": "$TOTAL_DURATION",
              "generation_method": "t2v_primary_i2v_supplement"
            },
            "video_files": {
              "main_video": "$([ "$MAIN_VIDEO_STATUS" = "success" ] && echo ".logs/video-production/main-video.json" || echo "none")",
              "supplement_video": "$([ "$I2V_STATUS" = "success" ] && echo ".logs/video-production/i2v-supplement.json" || echo "none")"
            },
            "next_processing": "$([ "$MAIN_VIDEO_STATUS" = "success" ] && echo "audio_integration" || echo "retry_generation")"
          }
          EOF
          
          echo "VIDEO_GENERATION_STATUS=$MAIN_VIDEO_STATUS" >> $GITHUB_ENV
          echo "VIDEO_GENERATION_LOG_FILE=.logs/video-production/video-generation-log.json" >> $GITHUB_ENV
          
          echo "ğŸ¬ Primary video generation completed: $MAIN_VIDEO_STATUS"

  # === éŸ³å£°çµ±åˆæ®µéš ===
  - id: "background-music-generation"
    name: "BGMãƒ»åŠ¹æœéŸ³ç”Ÿæˆ"
    phase: "audio_integration"
    github_job: "audio-generation"
    type: "generation"
    implementation: "mcp"
    tool: "audio-generation"
    duration_minutes: 6
    dependencies: ["primary-video-generation"]
    parallel_group: "audio_parallel"
    
    github_steps:
      - name: "Generate background music and sound effects"
        shell: "bash"
        script: |
          echo "ğŸµ Generating background music and sound effects..."
          
          mkdir -p .logs/audio-integration
          
          DETAILED_SCRIPT=$(cat .logs/script-storyboard/detailed-script.json)
          VIDEO_CONCEPT=$(cat .logs/concept-planning/video-concept.json)
          
          # BGMç”Ÿæˆè¦ä»¶ã®æŠ½å‡º
          MUSIC_STYLE=$(echo "$DETAILED_SCRIPT" | jq -r '.audio_requirements.background_music_style')
          TOTAL_DURATION=$(echo "$DETAILED_SCRIPT" | jq -r '.script_overview.total_duration')
          TONE=$(echo "$VIDEO_CONCEPT" | jq -r '.video_concept.tone')
          
          echo "Music style: $MUSIC_STYLE"
          echo "Duration: ${TOTAL_DURATION}s"
          echo "Tone: $TONE"
          
          # BGMç”Ÿæˆ
          if [ "$ENHANCED_AUDIO" = "true" ]; then
            echo "Generating custom background music..."
            MUSIC_PROMPT="$MUSIC_STYLE background music, $TONE mood, ${TOTAL_DURATION} seconds duration, suitable for video content, seamless loop, professional quality"
            
            if timeout 120 claude --mcp-config .claude/mcp-kamuicode.json --mcp t2m-google-lyria --prompt "$MUSIC_PROMPT" --duration "$TOTAL_DURATION" > .logs/audio-integration/bgm.json 2>&1; then
              echo "âœ… Custom BGM generated successfully"
              BGM_STATUS="success"
            else
              echo "âŒ Custom BGM generation failed"
              BGM_STATUS="failed"
            fi
          else
            echo "âš ï¸ Using fallback: External audio library"
            BGM_STATUS="external"
          fi
          
          # å‹•ç”»ã‹ã‚‰åŠ¹æœéŸ³ç”Ÿæˆï¼ˆV2Aä½¿ç”¨ï¼‰
          VIDEO_GENERATION_LOG=$(cat .logs/video-production/video-generation-log.json)
          MAIN_VIDEO_FILE=$(echo "$VIDEO_GENERATION_LOG" | jq -r '.video_files.main_video')
          
          if [ "$ENHANCED_AUDIO" = "true" ] && [ "$MAIN_VIDEO_FILE" != "none" ]; then
            echo "Generating sound effects from video..."
            
            # ãƒ¡ã‚¤ãƒ³å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—
            VIDEO_PATH=$(jq -r '.video_url // .file_path // "none"' "$MAIN_VIDEO_FILE")
            
            if [ "$VIDEO_PATH" != "none" ] && timeout 90 claude --mcp-config .claude/mcp-kamuicode.json --mcp v2a-fal-thinksound --video-path "$VIDEO_PATH" --audio-style "natural sound effects matching video content" > .logs/audio-integration/sound-effects.json 2>&1; then
              echo "âœ… Sound effects generated from video"
              SFX_STATUS="success"
            else
              echo "âš ï¸ V2A sound effects generation failed"
              SFX_STATUS="failed"
            fi
          else
            echo "â„¹ï¸ Sound effects generation skipped"
            SFX_STATUS="not_generated"
          fi
          
          # éŸ³å£°çµ±åˆãƒ­ã‚°ã®ä½œæˆ
          cat > .logs/audio-integration/audio-generation-log.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "audio_generation": {
              "bgm_status": "$BGM_STATUS",
              "sound_effects_status": "$SFX_STATUS",
              "total_audio_duration": "$TOTAL_DURATION",
              "audio_style": "$MUSIC_STYLE"
            },
            "audio_files": {
              "background_music": "$([ "$BGM_STATUS" = "success" ] && echo ".logs/audio-integration/bgm.json" || echo "none")",
              "sound_effects": "$([ "$SFX_STATUS" = "success" ] && echo ".logs/audio-integration/sound-effects.json" || echo "none")"
            },
            "integration_ready": $([ "$BGM_STATUS" = "success" ] || [ "$BGM_STATUS" = "external" ] && echo "true" || echo "false")
          }
          EOF
          
          echo "AUDIO_GENERATION_STATUS=$BGM_STATUS" >> $GITHUB_ENV
          echo "AUDIO_INTEGRATION_READY=$([ "$BGM_STATUS" = "success" ] || [ "$BGM_STATUS" = "external" ] && echo "true" || echo "false")" >> $GITHUB_ENV
          
          echo "ğŸµ Audio generation completed: BGM=$BGM_STATUS, SFX=$SFX_STATUS"

  # === ãƒã‚¹ãƒˆãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ®µéš ===
  - id: "video-quality-enhancement"
    name: "å‹•ç”»å“è³ªå‘ä¸Šãƒ»æœ€çµ‚èª¿æ•´"
    phase: "post_production"
    github_job: "quality-enhancement"
    type: "optimization"
    implementation: "mcp"
    tool: "video-enhancement"
    duration_minutes: 8
    dependencies: ["background-music-generation"]
    parallel_group: null
    
    github_steps:
      - name: "Enhance video quality and final adjustments"
        shell: "bash"
        script: |
          echo "âœ¨ Enhancing video quality and final adjustments..."
          
          mkdir -p .logs/post-production
          
          VIDEO_GENERATION_LOG=$(cat .logs/video-production/video-generation-log.json)
          AUDIO_GENERATION_LOG=$(cat .logs/audio-integration/audio-generation-log.json)
          
          MAIN_VIDEO_FILE=$(echo "$VIDEO_GENERATION_LOG" | jq -r '.video_files.main_video')
          
          if [ "$MAIN_VIDEO_FILE" != "none" ] && [ "$VIDEO_EDITING" = "true" ]; then
            echo "Applying video quality enhancements..."
            
            # ãƒ¡ã‚¤ãƒ³å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—
            VIDEO_PATH=$(jq -r '.video_url // .file_path // "none"' "$MAIN_VIDEO_FILE")
            
            if [ "$VIDEO_PATH" != "none" ]; then
              # å‹•ç”»å“è³ªå‘ä¸Šå‡¦ç†
              ENHANCEMENT_PROMPT="enhance video quality, improve clarity and sharpness, stabilize motion, optimize colors and contrast, maintain original style and mood"
              
              if timeout 150 claude --mcp-config .claude/mcp-kamuicode.json --mcp v2v-fal-luma-ray2-modify --video-path "$VIDEO_PATH" --modification "$ENHANCEMENT_PROMPT" > .logs/post-production/enhanced-video.json 2>&1; then
                echo "âœ… Video quality enhancement completed"
                ENHANCEMENT_STATUS="success"
                FINAL_VIDEO_FILE=".logs/post-production/enhanced-video.json"
              else
                echo "âš ï¸ Video enhancement failed - using original"
                ENHANCEMENT_STATUS="failed"
                FINAL_VIDEO_FILE="$MAIN_VIDEO_FILE"
              fi
            else
              echo "âš ï¸ Video path not found"
              ENHANCEMENT_STATUS="skipped"
              FINAL_VIDEO_FILE="$MAIN_VIDEO_FILE"
            fi
          else
            echo "â„¹ï¸ Video enhancement skipped - using original quality"
            ENHANCEMENT_STATUS="not_available"
            FINAL_VIDEO_FILE="$MAIN_VIDEO_FILE"
          fi
          
          # æœ€çµ‚å‹•ç”»æƒ…å ±ã®æ•´ç†
          claude-code --prompt "ä»¥ä¸‹ã®æƒ…å ±ã‚’åŸºã«ã€å®Œæˆã—ãŸå‹•ç”»ã®æœ€çµ‚ä»•æ§˜ã¨å“è³ªãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š
          
          å…ƒå‹•ç”»æƒ…å ±: $(cat "$MAIN_VIDEO_FILE" 2>/dev/null || echo '{}')
          éŸ³å£°æƒ…å ±: $AUDIO_GENERATION_LOG
          enhancementçŠ¶æ³: $ENHANCEMENT_STATUS
          æœ€çµ‚å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«: $([ "$FINAL_VIDEO_FILE" != "none" ] && cat "$FINAL_VIDEO_FILE" 2>/dev/null || echo '{}')
          
          ä»¥ä¸‹ã®å½¢å¼ã§JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
          {
            \"final_video_specs\": {
              \"resolution\": \"æœ€çµ‚è§£åƒåº¦\",
              \"duration\": \"æœ€çµ‚å°ºï¼ˆç§’ï¼‰\",
              \"file_format\": \"ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼\",
              \"quality_level\": \"å“è³ªãƒ¬ãƒ™ãƒ«\",
              \"enhancement_applied\": $( [ "$ENHANCEMENT_STATUS" = "success" ] && echo "true" || echo "false" )
            },
            \"quality_assessment\": {
              \"visual_quality\": \"1-10ç‚¹ã§ã®è©•ä¾¡\",
              \"audio_quality\": \"1-10ç‚¹ã§ã®è©•ä¾¡\",
              \"overall_production_value\": \"1-10ç‚¹ã§ã®è©•ä¾¡\",
              \"technical_compliance\": \"pass|issues_found\",
              \"ready_for_distribution\": \"ready|needs_revision\"
            },
            \"content_summary\": {
              \"total_scenes\": \"ã‚·ãƒ¼ãƒ³æ•°\",
              \"visual_style_achieved\": \"é”æˆã•ã‚ŒãŸãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«\",
              \"audio_integration\": \"éŸ³å£°çµ±åˆçŠ¶æ³\",
              \"narrative_flow\": \"ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æµã‚Œã®è©•ä¾¡\"
            },
            \"distribution_recommendations\": {
              \"optimal_platforms\": [\"æ¨å¥¨é…ä¿¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ \"],
              \"target_audience_fit\": \"ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé©åˆåº¦\",
              \"recommended_publishing_time\": \"æ¨å¥¨å…¬é–‹æ™‚é–“å¸¯\",
              \"seo_tags\": [\"SEOç”¨ã‚¿ã‚°ææ¡ˆ\"]
            },
            \"production_metrics\": {
              \"total_production_time\": \"ç·åˆ¶ä½œæ™‚é–“\",
              \"automation_efficiency\": \"è‡ªå‹•åŒ–åŠ¹ç‡\",
              \"quality_vs_speed_balance\": \"å“è³ªãƒ»é€Ÿåº¦ãƒãƒ©ãƒ³ã‚¹è©•ä¾¡\"
            }
          }" > .logs/post-production/final-report.json
          
          FINAL_REPORT=$(cat .logs/post-production/final-report.json)
          READY_FOR_DISTRIBUTION=$(echo "$FINAL_REPORT" | jq -r '.quality_assessment.ready_for_distribution')
          
          echo "ENHANCEMENT_STATUS=$ENHANCEMENT_STATUS" >> $GITHUB_ENV
          echo "FINAL_VIDEO_FILE=$FINAL_VIDEO_FILE" >> $GITHUB_ENV
          echo "READY_FOR_DISTRIBUTION=$READY_FOR_DISTRIBUTION" >> $GITHUB_ENV
          echo "FINAL_REPORT_FILE=.logs/post-production/final-report.json" >> $GITHUB_ENV
          
          echo "âœ¨ Video quality enhancement completed: $ENHANCEMENT_STATUS"
          echo "Distribution readiness: $READY_FOR_DISTRIBUTION"

  - id: "final-packaging-delivery"
    name: "æœ€çµ‚ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ãƒ»é…ä¿¡æº–å‚™"
    phase: "post_production"
    github_job: "final-packaging"
    type: "packaging"
    implementation: "script"
    duration_minutes: 3
    dependencies: ["video-quality-enhancement"]
    parallel_group: null
    
    github_steps:
      - name: "Create final delivery package"
        shell: "bash"
        script: |
          echo "ğŸ“¦ Creating final delivery package..."
          
          mkdir -p .final-output
          
          # ã™ã¹ã¦ã®é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æœ€çµ‚å‡ºåŠ›ã«åé›†
          cp .logs/concept-planning/video-concept.json .final-output/ 2>/dev/null || true
          cp .logs/script-storyboard/detailed-script.json .final-output/ 2>/dev/null || true
          cp .logs/post-production/final-report.json .final-output/ 2>/dev/null || true
          
          # ç”Ÿæˆã•ã‚ŒãŸãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±
          FINAL_VIDEO_FILE="${FINAL_VIDEO_FILE:-none}"
          BGM_FILE=$([ -f ".logs/audio-integration/bgm.json" ] && echo ".logs/audio-integration/bgm.json" || echo "none")
          SFX_FILE=$([ -f ".logs/audio-integration/sound-effects.json" ] && echo ".logs/audio-integration/sound-effects.json" || echo "none")
          
          # é…ä¿¡ç”¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä½œæˆ
          cat > .final-output/delivery-package.json << EOF
          {
            "project_info": {
              "project_name": "Video Content Creation",
              "created_at": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
              "github_run_id": "${{ github.run_id }}",
              "production_capability": "$PRODUCTION_CAPABILITY",
              "total_production_time": "45 minutes"
            },
            "deliverables": {
              "final_video": "$FINAL_VIDEO_FILE",
              "background_music": "$BGM_FILE",
              "sound_effects": "$SFX_FILE",
              "concept_document": "video-concept.json",
              "script_storyboard": "detailed-script.json",
              "quality_report": "final-report.json"
            },
            "technical_specs": $(cat .logs/post-production/final-report.json | jq '.final_video_specs' 2>/dev/null || echo '{}'),
            "quality_metrics": $(cat .logs/post-production/final-report.json | jq '.quality_assessment' 2>/dev/null || echo '{}'),
            "distribution_ready": "$READY_FOR_DISTRIBUTION",
            "usage_rights": "Generated content - verify platform compliance",
            "recommended_next_steps": [
              "Review final video quality",
              "Test on target platforms", 
              "Apply platform-specific optimizations",
              "Schedule content publication"
            ]
          }
          EOF
          
          # ZIPãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ
          cd .final-output && zip -r ../video-content-package.zip . && cd ..
          
          echo "ğŸ“¦ Final packaging completed"
          echo "Package location: video-content-package.zip"
          echo "Distribution ready: $READY_FOR_DISTRIBUTION"
          
    success_links:
      package_download: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/artifacts"
      final_report: "${{ github.server_url }}/${{ github.repository }}/blob/main/.final-output/final-report.json"
      concept_document: "${{ github.server_url }}/${{ github.repository }}/blob/main/.final-output/video-concept.json"
      script_storyboard: "${{ github.server_url }}/${{ github.repository }}/blob/main/.final-output/detailed-script.json"

    validation:
      criteria:
        - "æœ€çµ‚å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹"
        - "é…ä¿¡æº–å‚™ãŒå®Œäº†ã—ã¦ã„ã‚‹"
        - "å“è³ªãƒ¬ãƒãƒ¼ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹"
      validation_script: |
        if [ ! -f ".final-output/delivery-package.json" ]; then
          echo "âŒ VALIDATION FAILED: Delivery package missing"
          exit 1
        fi
        
        if [ "$READY_FOR_DISTRIBUTION" = "ready" ]; then
          echo "âœ… Validation passed: Video ready for distribution"
        else
          echo "âš ï¸ WARNING: Video may need additional review before distribution"
        fi