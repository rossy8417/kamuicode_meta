name: Comment-Triggered Workflow Generator
run-name: üöÄ Processing stepback answers and generating workflow for Issue #${{ github.event.issue.number }}

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  issues: write
  actions: read
  pull-requests: write

env:
  CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

jobs:
  # Issue „Ç≥„É°„É≥„ÉàÊ§úÁü•„Å®„Çπ„ÉÜ„ÉÉ„Éó„Éê„ÉÉ„ÇØÂõûÁ≠î„ÅÆËß£Êûê
  detect-execution-command:
    runs-on: ubuntu-latest
    # Workflow Request Issues „Åß„Åã„Å§„Äåstart„Äç„Ç≥„É°„É≥„Éà„ÅÆÂ†¥Âêà„ÅÆ„ÅøÂÆüË°å
    if: contains(github.event.issue.title, 'Workflow Request') && startsWith(github.event.comment.body, 'start')
    outputs:
      should_execute: ${{ steps.analyze.outputs.should_execute }}
      stepback_answers: ${{ steps.analyze.outputs.stepback_answers }}
      original_request: ${{ steps.analyze.outputs.original_request }}
      workflow_type: ${{ steps.analyze.outputs.workflow_type }}
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Install GitHub CLI
        run: |
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
          sudo apt update
          sudo apt install gh -y
        env:
          GITHUB_TOKEN: ${{ github.token }}
        
      - name: Analyze Issue Content and Comment
        id: analyze
        run: |
          echo "üîç Analyzing Issue #${{ github.event.issue.number }} for stepback answers..."
          
          mkdir -p .meta/comment-analysis
          
          # IssueÊÉÖÂ†±„ÇíÂÆâÂÖ®„Å´ÂèñÂæó
          COMMENT_USER="${{ github.event.comment.user.login }}"
          ISSUE_AUTHOR="${{ github.event.issue.user.login }}"
          
          # Issue title „Å® body „Çí„Éï„Ç°„Ç§„É´„Å´ÂÆâÂÖ®„Å´‰øùÂ≠ò
          cat > .meta/comment-analysis/issue-title.txt << 'EOF'
          ${{ github.event.issue.title }}
          EOF
          
          cat > .meta/comment-analysis/issue-body.txt << 'EOF'
          ${{ github.event.issue.body }}
          EOF
          
          cat > .meta/comment-analysis/comment-body.txt << 'EOF'
          ${{ github.event.comment.body }}
          EOF
          
          # „Éï„Ç°„Ç§„É´„Åã„ÇâÂÆâÂÖ®„Å´Ë™≠„ÅøËæº„Åø
          ISSUE_TITLE=$(cat .meta/comment-analysis/issue-title.txt)
          ISSUE_BODY=$(cat .meta/comment-analysis/issue-body.txt)
          COMMENT_BODY=$(cat .meta/comment-analysis/comment-body.txt)
          
          echo "üìã Issue Analysis:"
          echo "   - Title: $ISSUE_TITLE"
          echo "   - Comment by: $COMMENT_USER"
          echo "   - Issue author: $ISSUE_AUTHOR"
          # Check if comment contains execution trigger
          if echo "$COMMENT_BODY" | grep -q 'start'; then
            CONTAINS_TRIGGER="YES"
          else
            CONTAINS_TRIGGER="NO"
          fi
          echo "   - Comment contains 'start': $CONTAINS_TRIGGER"
          
          # Issue‰ΩúÊàêËÄÖÊú¨‰∫∫„ÅÆ„Ç≥„É°„É≥„Éà„Åã„ÉÅ„Çß„ÉÉ„ÇØ
          if [ "$COMMENT_USER" != "$ISSUE_AUTHOR" ]; then
            echo "‚ö†Ô∏è Comment is not from Issue author - skipping execution"
            echo "should_execute=false" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # IssueÊú¨Êñá„Åã„Çâ„Çπ„ÉÜ„ÉÉ„Éó„Éê„ÉÉ„ÇØÂõûÁ≠î„ÇíÊäΩÂá∫
          echo "üìù Extracting stepback answers from Issue body..."
          
          # Q1-Q5„ÅÆÂõûÁ≠î„ÇíÊ§úÁ¥¢„ÉªÊäΩÂá∫
          STEPBACK_ANSWERS=""
          
          # Q1„ÅÆÂõûÁ≠î„ÇíÊäΩÂá∫
          Q1_ANSWER=$(echo "$ISSUE_BODY" | sed -n '/\*\*Q1:.*\*\*/,/\*\*Q2:/p' | sed -n '/\*\*ÂõûÁ≠îÔºö\*\*/,/\*\*Q2:/p' | sed '1d;$d' | head -10)
          if [ -n "$Q1_ANSWER" ] && ! echo "$Q1_ANSWER" | grep -q "Ôºà„Åì„Åì„Å´Ë©≥Á¥∞„Çí„ÅäÊõ∏„Åç„Åè„Å†„Åï„ÅÑÔºâ"; then
            STEPBACK_ANSWERS="${STEPBACK_ANSWERS}**Q1ÂõûÁ≠î:** $Q1_ANSWER\n\n"
          fi
          
          # Q2„ÅÆÂõûÁ≠î„ÇíÊäΩÂá∫
          Q2_ANSWER=$(echo "$ISSUE_BODY" | sed -n '/\*\*Q2:.*\*\*/,/\*\*Q3:/p' | sed -n '/\*\*ÂõûÁ≠îÔºö\*\*/,/\*\*Q3:/p' | sed '1d;$d' | head -10)
          if [ -n "$Q2_ANSWER" ] && ! echo "$Q2_ANSWER" | grep -q "Ôºà„Åì„Åì„Å´Ë©≥Á¥∞„Çí„ÅäÊõ∏„Åç„Åè„Å†„Åï„ÅÑÔºâ"; then
            STEPBACK_ANSWERS="${STEPBACK_ANSWERS}**Q2ÂõûÁ≠î:** $Q2_ANSWER\n\n"
          fi
          
          # Q3„ÅÆÂõûÁ≠î„ÇíÊäΩÂá∫
          Q3_ANSWER=$(echo "$ISSUE_BODY" | sed -n '/\*\*Q3:.*\*\*/,/\*\*Q4:/p' | sed -n '/\*\*ÂõûÁ≠îÔºö\*\*/,/\*\*Q4:/p' | sed '1d;$d' | head -10)
          if [ -n "$Q3_ANSWER" ] && ! echo "$Q3_ANSWER" | grep -q "Ôºà„Åì„Åì„Å´Ë©≥Á¥∞„Çí„ÅäÊõ∏„Åç„Åè„Å†„Åï„ÅÑÔºâ"; then
            STEPBACK_ANSWERS="${STEPBACK_ANSWERS}**Q3ÂõûÁ≠î:** $Q3_ANSWER\n\n"
          fi
          
          # Q4„ÅÆÂõûÁ≠î„ÇíÊäΩÂá∫
          Q4_ANSWER=$(echo "$ISSUE_BODY" | sed -n '/\*\*Q4:.*\*\*/,/\*\*Q5:/p' | sed -n '/\*\*ÂõûÁ≠îÔºö\*\*/,/\*\*Q5:/p' | sed '1d;$d' | head -10)
          if [ -n "$Q4_ANSWER" ] && ! echo "$Q4_ANSWER" | grep -q "Ôºà„Åì„Åì„Å´Ë©≥Á¥∞„Çí„ÅäÊõ∏„Åç„Åè„Å†„Åï„ÅÑÔºâ"; then
            STEPBACK_ANSWERS="${STEPBACK_ANSWERS}**Q4ÂõûÁ≠î:** $Q4_ANSWER\n\n"
          fi
          
          # Q5„ÅÆÂõûÁ≠î„ÇíÊäΩÂá∫
          Q5_ANSWER=$(echo "$ISSUE_BODY" | sed -n '/\*\*Q5:.*\*\*/,$p' | sed -n '/\*\*ÂõûÁ≠îÔºö\*\*/,/---/p' | sed '1d;$d' | head -10)
          if [ -n "$Q5_ANSWER" ] && ! echo "$Q5_ANSWER" | grep -q "Ôºà„Åì„Åì„Å´Ë©≥Á¥∞„Çí„ÅäÊõ∏„Åç„Åè„Å†„Åï„ÅÑÔºâ"; then
            STEPBACK_ANSWERS="${STEPBACK_ANSWERS}**Q5ÂõûÁ≠î:** $Q5_ANSWER\n\n"
          fi
          
          # ÂÖÉ„ÅÆ„É™„ÇØ„Ç®„Çπ„ÉàÈÉ®ÂàÜ„ÇíÊäΩÂá∫Ôºà„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅÆÁõÆÁöÑ„ÉªËÉåÊôØ„Å™„Å©Ôºâ
          ORIGINAL_REQUEST=$(echo "$ISSUE_BODY" | sed -n '1,/## üìã „ÉØ„Éº„ÇØ„Éï„É≠„ÉºË©≥Á¥∞Âåñ„ÅÆ„Åü„ÇÅ„ÅÆË≥™Âïè/p' | head -20)
          
          # „ÉØ„Éº„ÇØ„Éï„É≠„Éº„Çø„Ç§„Éó„ÇíÊé®Ê∏¨
          if echo "$ISSUE_TITLE $ISSUE_BODY" | grep -qi "video\|ÂãïÁîª"; then
            WORKFLOW_TYPE="video-generation"
          elif echo "$ISSUE_TITLE $ISSUE_BODY" | grep -qi "image\|ÁîªÂÉè"; then
            WORKFLOW_TYPE="image-generation"
          elif echo "$ISSUE_TITLE $ISSUE_BODY" | grep -qi "audio\|music\|Èü≥Ê•Ω\|Èü≥Â£∞"; then
            WORKFLOW_TYPE="audio-generation"
          else
            WORKFLOW_TYPE="custom"
          fi
          
          echo "üìä Analysis Results:"
          echo "   - Workflow Type: $WORKFLOW_TYPE"
          echo "   - Stepback Answers Length: ${#STEPBACK_ANSWERS}"
          echo "   - Original Request Length: ${#ORIGINAL_REQUEST}"
          
          # ÂõûÁ≠î„ÅåÂçÅÂàÜ„Å´„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
          if [ ${#STEPBACK_ANSWERS} -gt 50 ]; then
            echo "‚úÖ Sufficient stepback answers found - proceeding with workflow generation"
            
            # ÂàÜÊûêÁµêÊûú„Çí‰øùÂ≠ò
            cat > .meta/comment-analysis/analysis-result.md << EOF
          # Comment-Triggered Analysis Result
          
          ## Original Request
          $ORIGINAL_REQUEST
          
          ## Stepback Answers
          $STEPBACK_ANSWERS
          
          ## Metadata
          - Workflow Type: $WORKFLOW_TYPE
          - Issue Number: ${{ github.event.issue.number }}
          - Timestamp: $(date -u +%Y-%m-%dT%H:%M:%SZ)
          - Triggered by: $COMMENT_USER
          EOF
            
            echo "should_execute=true" >> $GITHUB_OUTPUT
            echo "stepback_answers<<EOF" >> $GITHUB_OUTPUT
            echo -e "$STEPBACK_ANSWERS" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
            echo "original_request<<EOF" >> $GITHUB_OUTPUT
            echo "$ORIGINAL_REQUEST" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
            echo "workflow_type=$WORKFLOW_TYPE" >> $GITHUB_OUTPUT
            
          else
            echo "‚ö†Ô∏è Insufficient stepback answers - requesting more details"
            echo "should_execute=false" >> $GITHUB_OUTPUT
            
            # ‰∏çÂçÅÂàÜ„Å™ÂõûÁ≠î„ÅÆÂ†¥Âêà„ÄÅ„Ç≥„É°„É≥„Éà„ÅßË©≥Á¥∞Ë¶ÅÊ±Ç
            if command -v gh &> /dev/null; then
              gh issue comment ${{ github.event.issue.number }} \
                --body "‚ö†Ô∏è **Ë©≥Á¥∞ÊÉÖÂ†±„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô**
          
          „ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÁîüÊàê„Åô„Çã„Å´„ÅØ„ÄÅIssueÊú¨Êñá„ÅÆüìãË©≥Á¥∞Á¢∫Ë™çË≥™Âïè„Å´„Çà„ÇäÂ§ö„Åè„ÅÆÂõûÁ≠î„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
          
          **ÁèæÂú®„ÅÆÁä∂Ê≥Å:**
          - Ê§úÂá∫„Åï„Çå„ÅüÂõûÁ≠î: ${#STEPBACK_ANSWERS} ÊñáÂ≠ó
          - ÂøÖË¶Å„Å™ÂõûÁ≠î: ÊúÄ‰Ωé50ÊñáÂ≠ó‰ª•‰∏ä
          
          **üìù Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó:**
          1. IssueÊú¨Êñá„ÇíÁ∑®ÈõÜÔºàEdit„Éú„Çø„É≥Ôºâ
          2. Q1-Q5„ÅÆ„Äå**ÂõûÁ≠îÔºö**„ÄçÈÉ®ÂàÜ„Å´„Çà„ÇäË©≥Á¥∞„Å™ÊÉÖÂ†±„ÇíË®òÂÖ•
          3. Issue‰øùÂ≠òÂæå„ÄÅÂÜçÂ∫¶„ÄåÂÆüË°åÈñãÂßã„Äç„Å®„Ç≥„É°„É≥„Éà
          
          „Çà„ÇäË©≥Á¥∞„Å™ÂõûÁ≠î„Çí„ÅÑ„Åü„Å†„Åè„Åì„Å®„Åß„ÄÅÊúÄÈÅ©Âåñ„Åï„Çå„Åü„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÁîüÊàê„Åß„Åç„Åæ„Åô„ÄÇ
          
          ü§ñ *Comment-Triggered Workflow Generator*" \
                2>/dev/null || echo "‚ö†Ô∏è Failed to post insufficient answers comment"
            fi
          fi
          
      - name: Upload Analysis Result
        if: steps.analyze.outputs.should_execute == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: comment-analysis-${{ github.run_number }}
          path: .meta/comment-analysis/
          retention-days: 7

  # „Çπ„ÉÜ„ÉÉ„Éó„Éê„ÉÉ„ÇØÂõûÁ≠î„Å´Âü∫„Å•„Åè„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁîüÊàê
  generate-enhanced-workflow:
    needs: detect-execution-command
    runs-on: ubuntu-latest
    if: needs.detect-execution-command.outputs.should_execute == 'true'
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Download Analysis Result
        uses: actions/download-artifact@v4
        with:
          name: comment-analysis-${{ github.run_number }}
          path: .meta/comment-analysis/
          
      - name: Install GitHub CLI
        run: |
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
          sudo apt update
          sudo apt install gh -y
        env:
          GITHUB_TOKEN: ${{ github.token }}
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install Claude Code
        run: npm install -g @anthropic-ai/claude-code
        
      - name: Generate Enhanced Workflow with Stepback Answers
        id: generate
        run: |
          echo "ü§ñ Generating enhanced workflow based on stepback answers..."
          
          mkdir -p .meta/enhanced-generation
          
          # ÂàÜÊûêÁµêÊûú„ÇíË™≠„ÅøËæº„Åø
          if [ ! -f ".meta/comment-analysis/analysis-result.md" ]; then
            echo "‚ùå Analysis result not found"
            exit 1
          fi
          
          WORKFLOW_TYPE="${{ needs.detect-execution-command.outputs.workflow_type }}"
          
          # Êã°Âºµ„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁîüÊàê„Éó„É≠„É≥„Éó„Éà„Çí‰ΩúÊàê
          cat > .meta/enhanced-generation/generation-prompt.md << 'EOF'
          # Enhanced Workflow Generation with Stepback Answers
          
          „É¶„Éº„Ç∂„Éº„Åå„Çπ„ÉÜ„ÉÉ„Éó„Éê„ÉÉ„ÇØË≥™Âïè„Å´ÂõûÁ≠î„Åó„ÅüÂÜÖÂÆπ„ÇíÂü∫„Å´„ÄÅÊúÄÈÅ©Âåñ„Åï„Çå„Åü„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          
          ## ÂàÜÊûêÂØæË±°„Éá„Éº„Çø
          EOF
          
          cat .meta/comment-analysis/analysis-result.md >> .meta/enhanced-generation/generation-prompt.md
          
          cat >> .meta/enhanced-generation/generation-prompt.md << 'EOF'
          
          ## ÁîüÊàêÊåáÁ§∫
          
          ‰∏äË®ò„ÅÆ„É¶„Éº„Ç∂„ÉºÂõûÁ≠î„ÇíÂàÜÊûê„Åó„ÄÅ‰ª•‰∏ã„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
          
          1. **ÂõûÁ≠îÂÜÖÂÆπ„ÅÆËß£Èáà**: ÂêÑË≥™Âïè„Å∏„ÅÆÂõûÁ≠î„Åã„ÇâÂÖ∑‰ΩìÁöÑË¶ÅÊ±Ç„ÇíÊäΩÂá∫
          2. **ÊäÄË°ì‰ªïÊßò„ÅÆÊ±∫ÂÆö**: ÂìÅË≥™Ë®≠ÂÆö„ÄÅÂá¶ÁêÜÈ†ÜÂ∫è„ÄÅÊôÇÈñìÂà∂Á¥Ñ„ÇíÊòéÁ¢∫Âåñ
          3. **ÊúÄÈÅ©„Å™„ÉÜ„É≥„Éó„É¨„Éº„ÉàÈÅ∏Êäû**: Ë¶ÅÊ±Ç„Å´ÊúÄ„ÇÇÈÅ©„Åó„Åü„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÈÅ∏Êäû
          4. **„Ç´„Çπ„Çø„Éû„Ç§„Ç∫ÂÆüË£Ö**: ÂõûÁ≠îÂÜÖÂÆπ„Å´Âü∫„Å•„ÅèÂÖ∑‰ΩìÁöÑ„Å™„Ç´„Çπ„Çø„Éû„Ç§„Ç∫
          
          ## ÂøÖÈ†àÂá∫Âäõ
          
          ‰ª•‰∏ã„ÅÆ„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Éï„Ç°„Ç§„É´„ÇíÁîüÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö
          
          ```bash
          mkdir -p generated/workflows/enhanced
          cat > generated/workflows/enhanced/stepback-enhanced-workflow.yml << 'EOFYML'
          name: "Enhanced Workflow (Stepback Optimized)"
          run-name: "üéØ ${{ github.actor }} executes stepback-optimized workflow"
          
          on:
            workflow_dispatch:
              inputs:
                # „É¶„Éº„Ç∂„ÉºÂõûÁ≠î„Å´Âü∫„Å•„ÅèÂãïÁöÑinputs
          
          permissions:
            contents: write
            actions: read
          
          env:
            CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          
          jobs:
            # „É¶„Éº„Ç∂„ÉºÂõûÁ≠î„Å´Âü∫„Å•„ÅèÊúÄÈÅ©Âåñ„Åï„Çå„Åü„Ç∏„Éß„ÉñÊßãÊàê
          
          EOFYML
          ```
          
          ÈáçË¶ÅÔºöÁîüÊàê„Åó„Åü„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅØÂøÖ„Åö `generated/workflows/enhanced/stepback-enhanced-workflow.yml` „Å´‰øùÂ≠ò„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          EOF
          
          # Claude Code „Åß„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁîüÊàêÂÆüË°å
          echo "üß† Executing Claude Code enhanced workflow generation..."
          
          if claude --continue "$(cat .meta/enhanced-generation/generation-prompt.md)" --output-format text; then
            echo "‚úÖ Enhanced workflow generation completed"
            
            if [ -f "generated/workflows/enhanced/stepback-enhanced-workflow.yml" ]; then
              echo "‚úÖ Enhanced workflow file created successfully"
              
              # ÁîüÊàê„Åï„Çå„Åü„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅÆÂü∫Êú¨Ê§úË®º
              if python3 -c "import yaml; yaml.safe_load(open('generated/workflows/enhanced/stepback-enhanced-workflow.yml'))" 2>/dev/null; then
                echo "‚úÖ Generated workflow has valid YAML syntax"
                echo "workflow_generated=true" >> $GITHUB_OUTPUT
                echo "workflow_path=generated/workflows/enhanced/stepback-enhanced-workflow.yml" >> $GITHUB_OUTPUT
              else
                echo "‚ùå Generated workflow has invalid YAML syntax"
                echo "workflow_generated=false" >> $GITHUB_OUTPUT
              fi
            else
              echo "‚ùå Enhanced workflow file not found"
              echo "workflow_generated=false" >> $GITHUB_OUTPUT
            fi
          else
            echo "‚ùå Claude Code enhanced generation failed"
            echo "workflow_generated=false" >> $GITHUB_OUTPUT
          fi
          
      - name: Deploy Enhanced Workflow
        if: steps.generate.outputs.workflow_generated == 'true'
        run: |
          echo "üöÄ Deploying enhanced workflow to production..."
          
          WORKFLOW_FILE="${{ steps.generate.outputs.workflow_path }}"
          WORKFLOW_TYPE="${{ needs.detect-execution-command.outputs.workflow_type }}"
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)
          
          # Êú¨Áï™Áí∞Â¢É„Å´„Éá„Éó„É≠„Ç§
          DEPLOYED_FILE=".github/workflows/enhanced-${WORKFLOW_TYPE}-${TIMESTAMP}.yml"
          
          mkdir -p .github/workflows
          cp "$WORKFLOW_FILE" "$DEPLOYED_FILE"
          
          # Git „Ç≥„Éü„ÉÉ„Éà
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add "$DEPLOYED_FILE" "generated/workflows/enhanced/"
          git commit -m "feat: Deploy stepback-enhanced workflow ($WORKFLOW_TYPE)" || echo "No changes to commit"
          
          echo "‚úÖ Enhanced workflow deployed: $DEPLOYED_FILE"
          
      - name: Post Success Notification
        if: steps.generate.outputs.workflow_generated == 'true'
        run: |
          echo "üí¨ Posting success notification to Issue #${{ github.event.issue.number }}..."
          
          WORKFLOW_FILE="${{ steps.generate.outputs.workflow_path }}"
          DEPLOYED_FILE=".github/workflows/enhanced-${{ needs.detect-execution-command.outputs.workflow_type }}-$(date +%Y%m%d-%H%M%S).yml"
          
          if command -v gh &> /dev/null; then
            gh issue comment ${{ github.event.issue.number }} \
              --body "üéâ **„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁîüÊàêÂÆå‰∫ÜÔºÅ**
          
          „ÅÇ„Å™„Åü„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„Éê„ÉÉ„ÇØË≥™Âïè„Å∏„ÅÆÂõûÁ≠î„ÇíÂàÜÊûê„Åó„ÄÅÊúÄÈÅ©Âåñ„Åï„Çå„Åü„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÁîüÊàê„ÉªÈÖçÁΩÆ„Åó„Åæ„Åó„Åü„ÄÇ
          
          **üìä ÁîüÊàêÁµêÊûú:**
          - **„ÉØ„Éº„ÇØ„Éï„É≠„Éº„Çø„Ç§„Éó**: ${{ needs.detect-execution-command.outputs.workflow_type }}
          - **ÁîüÊàêÊñπÂºè**: „Çπ„ÉÜ„ÉÉ„Éó„Éê„ÉÉ„ÇØÂõûÁ≠îÊúÄÈÅ©Âåñ
          - **ÈÖçÁΩÆÂÖà**: \`.github/workflows/\` (Êú¨Áï™Áí∞Â¢É)
          - **„Éï„Ç°„Ç§„É´Âêç**: \`$(basename "$DEPLOYED_FILE")\`
          
          **üéØ „Ç´„Çπ„Çø„Éû„Ç§„Ç∫ÂÜÖÂÆπ:**
          „ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î„Å´Âü∫„Å•„Åç‰ª•‰∏ã„ÅåÊúÄÈÅ©Âåñ„Åï„Çå„Åæ„Åó„ÅüÔºö
          - Q1-Q5„ÅÆË©≥Á¥∞Ë¶ÅÊ±Ç„ÇíÂèçÊò†
          - ÂìÅË≥™„ÉªÂá¶ÁêÜ„Éï„É≠„Éº„ÉªÊäÄË°ì‰ªïÊßò„ÅÆÂÄãÂà•Ë™øÊï¥
          - Áµ±Âêà„ÉªÈÄ£Êê∫ÊñπÈáù„ÅÆÂÆüË£Ö
          
          **üöÄ ÂÆüË°åÊñπÊ≥ï:**
          1. **Actions „Çø„Éñ**„Å´ÁßªÂãï
          2. ÁîüÊàê„Åï„Çå„Åü„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÈÅ∏Êäû
          3. **Run workflow** „ÅßÂÆüË°åÈñãÂßã
          
          **‚è±Ô∏è ‰∫àÊÉ≥ÂÆüË°åÊôÇÈñì:** ÂõûÁ≠îÂÜÖÂÆπ„Å´Âü∫„Å•„ÅçÊúÄÈÅ©ÂåñÊ∏à„Åø
          
          ---
          
          ü§ñ **Comment-Triggered Workflow Generator v5** „ÅßÁîüÊàê
          üìù „Çπ„ÉÜ„ÉÉ„Éó„Éê„ÉÉ„ÇØÂõûÁ≠îËß£Êûê„Å´„Çà„ÇäÈ´òÁ≤æÂ∫¶„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„ÇíÂÆüÁèæ" \
              2>/dev/null || echo "‚ö†Ô∏è Failed to post success notification"
          fi
          
          echo "‚úÖ Comment-triggered workflow generation completed successfully"
          
      - name: Upload Enhanced Workflow
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: enhanced-workflow-${{ github.run_number }}
          path: generated/workflows/enhanced/
          retention-days: 30