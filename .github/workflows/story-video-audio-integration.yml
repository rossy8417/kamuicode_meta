---
name: Story Video Audio Integration Workflow
run-name: ${{ github.actor }} creates story-video-audio content ğŸ¬ğŸµ

on:
  workflow_dispatch:
    inputs:
      story_prompt:
        description: 'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
        required: true
        type: string
      visual_style:
        description: 'æ˜ åƒã‚¹ã‚¿ã‚¤ãƒ«'
        required: false
        type: choice
        options:
          - realistic
          - anime
          - artistic
        default: realistic
      music_mood:
        description: 'BGMã®é›°å›²æ°—'
        required: false
        type: choice
        options:
          - calm
          - dramatic
          - uplifting
        default: calm
      voice_type:
        description: 'ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³éŸ³å£°ã‚¿ã‚¤ãƒ—'
        required: false
        type: choice
        options:
          - male
          - female
          - neutral
        default: neutral

jobs:
  # Step 1: ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ™ãƒ¼ã‚¹ç”»åƒç”Ÿæˆ
  generate-story-image:
    runs-on: ubuntu-latest
    outputs:
      image_path: ${{ steps.t2i.outputs.image_path }}
    steps:
      - uses: actions/checkout@v4
      
      - name: Generate Story Image (T2I)
        id: t2i
        run: |
          echo "ğŸ¨ Generating story image..."
          echo "Story: ${{ github.event.inputs.story_prompt }}"
          echo "Style: ${{ github.event.inputs.visual_style }}"
          
          # T2I generation using MCP
          mkdir -p outputs/images
          IMAGE_OUTPUT="outputs/images/story-$(date +%Y%m%d-%H%M%S).png"
          
          # Simulate T2I generation (replace with actual MCP call)
          echo "ğŸ“¸ Story image generated: $IMAGE_OUTPUT"
          echo "image_path=$IMAGE_OUTPUT" >> $GITHUB_OUTPUT

  # Step 2: ç”»åƒã‹ã‚‰å‹•ç”»ç”Ÿæˆ
  generate-video:
    needs: generate-story-image
    runs-on: ubuntu-latest
    outputs:
      video_path: ${{ steps.i2v.outputs.video_path }}
    steps:
      - uses: actions/checkout@v4
      
      - name: Generate Video from Image (I2V)
        id: i2v
        run: |
          echo "ğŸ¬ Generating video from story image..."
          echo "Input image: ${{ needs.generate-story-image.outputs.image_path }}"
          
          # I2V generation using MCP
          mkdir -p outputs/videos
          VIDEO_OUTPUT="outputs/videos/story-$(date +%Y%m%d-%H%M%S).mp4"
          
          # Simulate I2V generation (replace with actual MCP call)
          echo "ğŸ¥ Story video generated: $VIDEO_OUTPUT"
          echo "video_path=$VIDEO_OUTPUT" >> $GITHUB_OUTPUT

  # Step 3: BGMç”Ÿæˆ
  generate-bgm:
    runs-on: ubuntu-latest
    outputs:
      bgm_path: ${{ steps.t2m.outputs.bgm_path }}
    steps:
      - uses: actions/checkout@v4
      
      - name: Generate Background Music (T2M)
        id: t2m
        run: |
          echo "ğŸµ Generating background music..."
          echo "Story: ${{ github.event.inputs.story_prompt }}"
          echo "Mood: ${{ github.event.inputs.music_mood }}"
          
          # T2M generation using MCP
          mkdir -p outputs/audio
          BGM_OUTPUT="outputs/audio/bgm-$(date +%Y%m%d-%H%M%S).mp3"
          
          # Simulate T2M generation (replace with actual MCP call)
          echo "ğŸ¶ Background music generated: $BGM_OUTPUT"
          echo "bgm_path=$BGM_OUTPUT" >> $GITHUB_OUTPUT

  # Step 4: ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
  generate-narration:
    runs-on: ubuntu-latest
    outputs:
      narration_path: ${{ steps.t2a.outputs.narration_path }}
    steps:
      - uses: actions/checkout@v4
      
      - name: Generate Narration (T2A)
        id: t2a
        run: |
          echo "ğŸ™ï¸ Generating narration..."
          echo "Story: ${{ github.event.inputs.story_prompt }}"
          echo "Voice: ${{ github.event.inputs.voice_type }}"
          
          # T2A generation using MCP
          mkdir -p outputs/audio
          NARRATION_OUTPUT="outputs/audio/narration-$(date +%Y%m%d-%H%M%S).mp3"
          
          # Simulate T2A generation (replace with actual MCP call)
          echo "ğŸ—£ï¸ Narration generated: $NARRATION_OUTPUT"
          echo "narration_path=$NARRATION_OUTPUT" >> $GITHUB_OUTPUT

  # Step 5: æœ€çµ‚çµ±åˆ
  integrate-final-content:
    needs: [generate-video, generate-bgm, generate-narration]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Integrate All Components
        run: |
          echo "ğŸ­ Integrating all story components..."
          echo "Video: ${{ needs.generate-video.outputs.video_path }}"
          echo "BGM: ${{ needs.generate-bgm.outputs.bgm_path }}"
          echo "Narration: ${{ needs.generate-narration.outputs.narration_path }}"
          
          # Final integration process
          mkdir -p outputs/final
          FINAL_OUTPUT="outputs/final/story-complete-$(date +%Y%m%d-%H%M%S).mp4"
          
          echo "ğŸ¬ Final story video with audio: $FINAL_OUTPUT"
          echo "âœ… Story-Video-Audio integration completed!"
      
      - name: Upload Final Content
        uses: actions/upload-artifact@v4
        with:
          name: story-video-audio-${{ github.run_number }}
          path: outputs/
          retention-days: 30
