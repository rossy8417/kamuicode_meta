name: Comment-Triggered Workflow Generator
run-name: ğŸš€ Processing stepback answers and generating workflow for Issue #${{ github.event.issue.number }}

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  issues: write
  actions: read
  pull-requests: write

env:
  CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

jobs:
  # Issue ã‚³ãƒ¡ãƒ³ãƒˆæ¤œçŸ¥ã¨ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒƒã‚¯å›ç­”ã®è§£æ
  detect-execution-command:
    runs-on: ubuntu-latest
    # Workflow Request Issues ã§ã‹ã¤ã€Œstartã€ã‚³ãƒ¡ãƒ³ãƒˆã®å ´åˆã®ã¿å®Ÿè¡Œ
    if: contains(github.event.issue.title, 'Workflow Request') && startsWith(github.event.comment.body, 'start')
    outputs:
      should_execute: ${{ steps.analyze.outputs.should_execute }}
      stepback_answers: ${{ steps.analyze.outputs.stepback_answers }}
      original_request: ${{ steps.analyze.outputs.original_request }}
      workflow_type: ${{ steps.analyze.outputs.workflow_type }}
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Install GitHub CLI
        run: |
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
          sudo apt update
          sudo apt install gh -y
        env:
          GITHUB_TOKEN: ${{ github.token }}
        
      - name: Analyze Issue Content and Comment
        id: analyze
        run: |
          echo "ğŸ” Analyzing Issue #${{ github.event.issue.number }} for stepback answers..."
          
          mkdir -p .meta/comment-analysis
          
          # Issueæƒ…å ±ã‚’å®‰å…¨ã«å–å¾—
          COMMENT_USER="${{ github.event.comment.user.login }}"
          ISSUE_AUTHOR="${{ github.event.issue.user.login }}"
          
          # Issue title ã¨ body ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å®‰å…¨ã«ä¿å­˜
          cat > .meta/comment-analysis/issue-title.txt << 'EOF'
          ${{ github.event.issue.title }}
          EOF
          
          cat > .meta/comment-analysis/issue-body.txt << 'EOF'
          ${{ github.event.issue.body }}
          EOF
          
          cat > .meta/comment-analysis/comment-body.txt << 'EOF'
          ${{ github.event.comment.body }}
          EOF
          
          # ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å®‰å…¨ã«èª­ã¿è¾¼ã¿
          ISSUE_TITLE=$(cat .meta/comment-analysis/issue-title.txt)
          ISSUE_BODY=$(cat .meta/comment-analysis/issue-body.txt)
          COMMENT_BODY=$(cat .meta/comment-analysis/comment-body.txt)
          
          echo "ğŸ“‹ Issue Analysis:"
          echo "   - Title: $ISSUE_TITLE"
          echo "   - Comment by: $COMMENT_USER"
          echo "   - Issue author: $ISSUE_AUTHOR"
          # Check if comment contains execution trigger
          if echo "$COMMENT_BODY" | grep -q 'start'; then
            CONTAINS_TRIGGER="YES"
          else
            CONTAINS_TRIGGER="NO"
          fi
          echo "   - Comment contains 'start': $CONTAINS_TRIGGER"
          
          # Issueä½œæˆè€…æœ¬äººã®ã‚³ãƒ¡ãƒ³ãƒˆã‹ãƒã‚§ãƒƒã‚¯
          if [ "$COMMENT_USER" != "$ISSUE_AUTHOR" ]; then
            echo "âš ï¸ Comment is not from Issue author - skipping execution"
            echo "should_execute=false" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # Issueæœ¬æ–‡ã‹ã‚‰ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒƒã‚¯å›ç­”ã‚’æŠ½å‡º
          echo "ğŸ“ Extracting stepback answers from Issue body..."
          
          # å…¨ã¦ã®å›ç­”ã‚’é †æ¬¡æŠ½å‡º - ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
          STEPBACK_ANSWERS=""
          
          # å›ç­”ï¼šã§å§‹ã¾ã‚‹è¡Œã‚’å…¨ã¦æŠ½å‡ºã—ã¦Q1-Q5ã¨ã—ã¦åˆ†é¡
          ANSWER_LINES=$(echo "$ISSUE_BODY" | grep "å›ç­”ï¼š" | sed 's/\*\*å›ç­”ï¼š\*\*//g' | sed 's/ï¼ˆ//g' | sed 's/ï¼‰//g')
          
          # å›ç­”è¡Œã‚’é…åˆ—ã«å¤‰æ›
          ANSWER_COUNT=0
          while IFS= read -r line; do
            if [ -n "$line" ] && ! echo "$line" | grep -q "ã“ã“ã«è©³ç´°ã‚’ãŠæ›¸ããã ã•ã„"; then
              ANSWER_COUNT=$((ANSWER_COUNT + 1))
              STEPBACK_ANSWERS="${STEPBACK_ANSWERS}**Q${ANSWER_COUNT}å›ç­”:** $line\n\n"
            fi
          done <<< "$ANSWER_LINES"
          
          # å…ƒã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆéƒ¨åˆ†ã‚’æŠ½å‡ºï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç›®çš„ãƒ»èƒŒæ™¯ãªã©ï¼‰
          ORIGINAL_REQUEST=$(echo "$ISSUE_BODY" | sed -n '1,/## ğŸ“‹ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è©³ç´°åŒ–ã®ãŸã‚ã®è³ªå•/p' | head -20)
          
          # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¿ã‚¤ãƒ—ã‚’æ¨æ¸¬
          if echo "$ISSUE_TITLE $ISSUE_BODY" | grep -qi "video\|å‹•ç”»"; then
            WORKFLOW_TYPE="video-generation"
          elif echo "$ISSUE_TITLE $ISSUE_BODY" | grep -qi "image\|ç”»åƒ"; then
            WORKFLOW_TYPE="image-generation"
          elif echo "$ISSUE_TITLE $ISSUE_BODY" | grep -qi "audio\|music\|éŸ³æ¥½\|éŸ³å£°"; then
            WORKFLOW_TYPE="audio-generation"
          else
            WORKFLOW_TYPE="custom"
          fi
          
          echo "ğŸ“Š Analysis Results:"
          echo "   - Workflow Type: $WORKFLOW_TYPE"
          echo "   - Stepback Answers Length: ${#STEPBACK_ANSWERS}"
          echo "   - Original Request Length: ${#ORIGINAL_REQUEST}"
          
          # å›ç­”ãŒååˆ†ã«ã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
          if [ ${#STEPBACK_ANSWERS} -gt 50 ]; then
            echo "âœ… Sufficient stepback answers found - proceeding with workflow generation"
            
            # åˆ†æçµæœã‚’ä¿å­˜
            cat > .meta/comment-analysis/analysis-result.md << EOF
          # Comment-Triggered Analysis Result
          
          ## Original Request
          $ORIGINAL_REQUEST
          
          ## Stepback Answers
          $STEPBACK_ANSWERS
          
          ## Metadata
          - Workflow Type: $WORKFLOW_TYPE
          - Issue Number: ${{ github.event.issue.number }}
          - Timestamp: $(date -u +%Y-%m-%dT%H:%M:%SZ)
          - Triggered by: $COMMENT_USER
          EOF
            
            echo "should_execute=true" >> $GITHUB_OUTPUT
            echo "stepback_answers<<EOF" >> $GITHUB_OUTPUT
            echo -e "$STEPBACK_ANSWERS" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
            echo "original_request<<EOF" >> $GITHUB_OUTPUT
            echo "$ORIGINAL_REQUEST" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
            echo "workflow_type=$WORKFLOW_TYPE" >> $GITHUB_OUTPUT
            
          else
            echo "âš ï¸ Insufficient stepback answers - requesting more details"
            echo "should_execute=false" >> $GITHUB_OUTPUT
            
            # ä¸ååˆ†ãªå›ç­”ã®å ´åˆã€ã‚³ãƒ¡ãƒ³ãƒˆã§è©³ç´°è¦æ±‚
            if command -v gh &> /dev/null; then
              gh issue comment ${{ github.event.issue.number }} \
                --body "âš ï¸ **è©³ç´°æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã¾ã™**
          
          ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€Issueæœ¬æ–‡ã®ğŸ“‹è©³ç´°ç¢ºèªè³ªå•ã«ã‚ˆã‚Šå¤šãã®å›ç­”ãŒå¿…è¦ã§ã™ã€‚
          
          **ç¾åœ¨ã®çŠ¶æ³:**
          - æ¤œå‡ºã•ã‚ŒãŸå›ç­”: ${#STEPBACK_ANSWERS} æ–‡å­—
          - å¿…è¦ãªå›ç­”: æœ€ä½50æ–‡å­—ä»¥ä¸Š
          
          **ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:**
          1. Issueæœ¬æ–‡ã‚’ç·¨é›†ï¼ˆEditãƒœã‚¿ãƒ³ï¼‰
          2. Q1-Q5ã®ã€Œ**å›ç­”ï¼š**ã€éƒ¨åˆ†ã«ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±ã‚’è¨˜å…¥
          3. Issueä¿å­˜å¾Œã€å†åº¦ã€Œå®Ÿè¡Œé–‹å§‹ã€ã¨ã‚³ãƒ¡ãƒ³ãƒˆ
          
          ã‚ˆã‚Šè©³ç´°ãªå›ç­”ã‚’ã„ãŸã ãã“ã¨ã§ã€æœ€é©åŒ–ã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚
          
          ğŸ¤– *Comment-Triggered Workflow Generator*" \
                2>/dev/null || echo "âš ï¸ Failed to post insufficient answers comment"
            fi
          fi
          
      - name: Upload Analysis Result
        if: steps.analyze.outputs.should_execute == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: comment-analysis-${{ github.run_number }}
          path: .meta/comment-analysis/
          retention-days: 7

  # ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒƒã‚¯å›ç­”ã«åŸºã¥ããƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç”Ÿæˆ
  generate-enhanced-workflow:
    needs: detect-execution-command
    runs-on: ubuntu-latest
    if: needs.detect-execution-command.outputs.should_execute == 'true'
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Download Analysis Result
        uses: actions/download-artifact@v4
        with:
          name: comment-analysis-${{ github.run_number }}
          path: .meta/comment-analysis/
          
      - name: Install GitHub CLI
        run: |
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
          sudo apt update
          sudo apt install gh -y
        env:
          GITHUB_TOKEN: ${{ github.token }}
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install Claude Code
        run: npm install -g @anthropic-ai/claude-code
        
      - name: Generate Enhanced Workflow with Stepback Answers
        id: generate
        run: |
          echo "ğŸ¤– Generating enhanced workflow based on stepback answers..."
          
          mkdir -p .meta/enhanced-generation
          
          # åˆ†æçµæœã‚’èª­ã¿è¾¼ã¿
          if [ ! -f ".meta/comment-analysis/analysis-result.md" ]; then
            echo "âŒ Analysis result not found"
            exit 1
          fi
          
          WORKFLOW_TYPE="${{ needs.detect-execution-command.outputs.workflow_type }}"
          
          # æ‹¡å¼µãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆ
          cat > .meta/enhanced-generation/generation-prompt.md << 'EOF'
          # Enhanced Workflow Generation with Stepback Answers
          
          ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ãƒ†ãƒƒãƒ—ãƒãƒƒã‚¯è³ªå•ã«å›ç­”ã—ãŸå†…å®¹ã‚’åŸºã«ã€æœ€é©åŒ–ã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
          
          ## åˆ†æå¯¾è±¡ãƒ‡ãƒ¼ã‚¿
          EOF
          
          cat .meta/comment-analysis/analysis-result.md >> .meta/enhanced-generation/generation-prompt.md
          
          cat >> .meta/enhanced-generation/generation-prompt.md << 'EOF'
          
          ## ç”ŸæˆæŒ‡ç¤º
          
          ä¸Šè¨˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­”ã‚’åˆ†æã—ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
          
          1. **å›ç­”å†…å®¹ã®è§£é‡ˆ**: å„è³ªå•ã¸ã®å›ç­”ã‹ã‚‰å…·ä½“çš„è¦æ±‚ã‚’æŠ½å‡º
          2. **æŠ€è¡“ä»•æ§˜ã®æ±ºå®š**: å“è³ªè¨­å®šã€å‡¦ç†é †åºã€æ™‚é–“åˆ¶ç´„ã‚’æ˜ç¢ºåŒ–
          3. **æœ€é©ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ**: è¦æ±‚ã«æœ€ã‚‚é©ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ
          4. **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå®Ÿè£…**: å›ç­”å†…å®¹ã«åŸºã¥ãå…·ä½“çš„ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
          
          ## å¿…é ˆå‡ºåŠ›
          
          ä»¥ä¸‹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
          
          ```bash
          mkdir -p generated/workflows/enhanced
          cat > generated/workflows/enhanced/stepback-enhanced-workflow.yml << 'EOFYML'
          name: "Enhanced Workflow (Stepback Optimized)"
          run-name: "ğŸ¯ ${{ github.actor }} executes stepback-optimized workflow"
          
          on:
            workflow_dispatch:
              inputs:
                # ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­”ã«åŸºã¥ãå‹•çš„inputs
          
          permissions:
            contents: write
            actions: read
          
          env:
            CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          
          jobs:
            # ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­”ã«åŸºã¥ãæœ€é©åŒ–ã•ã‚ŒãŸã‚¸ãƒ§ãƒ–æ§‹æˆ
          
          EOFYML
          ```
          
          é‡è¦ï¼šç”Ÿæˆã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯å¿…ãš `generated/workflows/enhanced/stepback-enhanced-workflow.yml` ã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚
          EOF
          
          # Claude Code ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç”Ÿæˆå®Ÿè¡Œ
          echo "ğŸ§  Executing Claude Code enhanced workflow generation..."
          
          if claude --continue "$(cat .meta/enhanced-generation/generation-prompt.md)" --output-format text; then
            echo "âœ… Enhanced workflow generation completed"
            
            if [ -f "generated/workflows/enhanced/stepback-enhanced-workflow.yml" ]; then
              echo "âœ… Enhanced workflow file created successfully"
              
              # ç”Ÿæˆã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åŸºæœ¬æ¤œè¨¼
              if python3 -c "import yaml; yaml.safe_load(open('generated/workflows/enhanced/stepback-enhanced-workflow.yml'))" 2>/dev/null; then
                echo "âœ… Generated workflow has valid YAML syntax"
                echo "workflow_generated=true" >> $GITHUB_OUTPUT
                echo "workflow_path=generated/workflows/enhanced/stepback-enhanced-workflow.yml" >> $GITHUB_OUTPUT
              else
                echo "âŒ Generated workflow has invalid YAML syntax"
                echo "workflow_generated=false" >> $GITHUB_OUTPUT
              fi
            else
              echo "âŒ Enhanced workflow file not found"
              echo "workflow_generated=false" >> $GITHUB_OUTPUT
            fi
          else
            echo "âŒ Claude Code enhanced generation failed"
            echo "workflow_generated=false" >> $GITHUB_OUTPUT
          fi
          
      - name: Deploy Enhanced Workflow
        if: steps.generate.outputs.workflow_generated == 'true'
        run: |
          echo "ğŸš€ Deploying enhanced workflow to production..."
          
          WORKFLOW_FILE="${{ steps.generate.outputs.workflow_path }}"
          WORKFLOW_TYPE="${{ needs.detect-execution-command.outputs.workflow_type }}"
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)
          
          # æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
          DEPLOYED_FILE=".github/workflows/enhanced-${WORKFLOW_TYPE}-${TIMESTAMP}.yml"
          
          mkdir -p .github/workflows
          cp "$WORKFLOW_FILE" "$DEPLOYED_FILE"
          
          # Git ã‚³ãƒŸãƒƒãƒˆ
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add "$DEPLOYED_FILE" "generated/workflows/enhanced/"
          git commit -m "feat: Deploy stepback-enhanced workflow ($WORKFLOW_TYPE)" || echo "No changes to commit"
          
          echo "âœ… Enhanced workflow deployed: $DEPLOYED_FILE"
          
      - name: Post Success Notification
        if: steps.generate.outputs.workflow_generated == 'true'
        run: |
          echo "ğŸ’¬ Posting success notification to Issue #${{ github.event.issue.number }}..."
          
          WORKFLOW_FILE="${{ steps.generate.outputs.workflow_path }}"
          DEPLOYED_FILE=".github/workflows/enhanced-${{ needs.detect-execution-command.outputs.workflow_type }}-$(date +%Y%m%d-%H%M%S).yml"
          
          if command -v gh &> /dev/null; then
            gh issue comment ${{ github.event.issue.number }} \
              --body "ğŸ‰ **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç”Ÿæˆå®Œäº†ï¼**
          
          ã‚ãªãŸã®ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒƒã‚¯è³ªå•ã¸ã®å›ç­”ã‚’åˆ†æã—ã€æœ€é©åŒ–ã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç”Ÿæˆãƒ»é…ç½®ã—ã¾ã—ãŸã€‚
          
          **ğŸ“Š ç”Ÿæˆçµæœ:**
          - **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¿ã‚¤ãƒ—**: ${{ needs.detect-execution-command.outputs.workflow_type }}
          - **ç”Ÿæˆæ–¹å¼**: ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒƒã‚¯å›ç­”æœ€é©åŒ–
          - **é…ç½®å…ˆ**: \`.github/workflows/\` (æœ¬ç•ªç’°å¢ƒ)
          - **ãƒ•ã‚¡ã‚¤ãƒ«å**: \`$(basename "$DEPLOYED_FILE")\`
          
          **ğŸ¯ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå†…å®¹:**
          ã‚ãªãŸã®å›ç­”ã«åŸºã¥ãä»¥ä¸‹ãŒæœ€é©åŒ–ã•ã‚Œã¾ã—ãŸï¼š
          - Q1-Q5ã®è©³ç´°è¦æ±‚ã‚’åæ˜ 
          - å“è³ªãƒ»å‡¦ç†ãƒ•ãƒ­ãƒ¼ãƒ»æŠ€è¡“ä»•æ§˜ã®å€‹åˆ¥èª¿æ•´
          - çµ±åˆãƒ»é€£æºæ–¹é‡ã®å®Ÿè£…
          
          **ğŸš€ å®Ÿè¡Œæ–¹æ³•:**
          1. **Actions ã‚¿ãƒ–**ã«ç§»å‹•
          2. ç”Ÿæˆã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠ
          3. **Run workflow** ã§å®Ÿè¡Œé–‹å§‹
          
          **â±ï¸ äºˆæƒ³å®Ÿè¡Œæ™‚é–“:** å›ç­”å†…å®¹ã«åŸºã¥ãæœ€é©åŒ–æ¸ˆã¿
          
          ---
          
          ğŸ¤– **Comment-Triggered Workflow Generator v5** ã§ç”Ÿæˆ
          ğŸ“ ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒƒã‚¯å›ç­”è§£æã«ã‚ˆã‚Šé«˜ç²¾åº¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’å®Ÿç¾" \
              2>/dev/null || echo "âš ï¸ Failed to post success notification"
          fi
          
          echo "âœ… Comment-triggered workflow generation completed successfully"
          
      - name: Upload Enhanced Workflow
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: enhanced-workflow-${{ github.run_number }}
          path: generated/workflows/enhanced/
          retention-days: 30