name: "Earthquake News Video Generation - Fallback"
run-name: "ðŸš€ åœ°éœ‡ãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ç”Ÿæˆ (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆ) | ${{ github.actor }} | Run #${{ github.run_number }}"

on:
  workflow_dispatch:
    inputs:
      concept:
        description: 'åœ°éœ‡ãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆ'
        type: string
        default: 'æœ€æ–°åœ°éœ‡æƒ…å ±ã®æ—¥æœ¬èªžãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ï¼ˆ1åˆ†ã€å­—å¹•ä»˜ãï¼‰'
      earthquake_region:
        description: 'åœ°éœ‡ç™ºç”Ÿåœ°åŸŸï¼ˆæ¤œç´¢å¯¾è±¡åœ°åŸŸï¼‰'
        type: string
        default: 'æ—¥æœ¬å…¨å›½'

env:
  CLAUDE_CODE_CI_MODE: true
  CLAUDE_CODE_AUTO_APPROVE_MCP: true

jobs:
  fallback-workflow:
    runs-on: ubuntu-latest
    outputs:
      workflow_status: ${{ steps.execute.outputs.status }}
      
    steps:
      - name: Execute Fallback Workflow
        id: execute
        run: |
          echo "ðŸš€ åœ°éœ‡ãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ç”Ÿæˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆã‚’å®Ÿè¡Œä¸­..."
          echo "ðŸ’¡ ã‚³ãƒ³ã‚»ãƒ—ãƒˆ: ${{ inputs.concept }}"
          echo "ðŸ“ å¯¾è±¡åœ°åŸŸ: ${{ inputs.earthquake_region }}"
          
          # Create project directories
          mkdir -p projects/earthquake-news-video/final
          mkdir -p projects/earthquake-news-video/temp
          
          # Basic earthquake news script (placeholder)
          cat > projects/earthquake-news-video/temp/news-script.txt << 'EOF'
          æœ€æ–°ã®åœ°éœ‡æƒ…å ±ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚
          
          æœ¬æ—¥ã€æ—¥æœ¬å›½å†…ã§åœ°éœ‡ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
          éœ‡æºåœ°ã¯è©³ç´°ãªèª¿æŸ»ã«ã‚ˆã‚Šç¢ºèªã•ã‚Œã€
          éœ‡åº¦ã‚„è¦æ¨¡ã«ã¤ã„ã¦æ°—è±¡åºãŒç™ºè¡¨ã—ã¦ã„ã¾ã™ã€‚
          
          ç¾åœ¨ã®ã¨ã“ã‚ã€å¤§ããªè¢«å®³ã®å ±å‘Šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
          å¼•ãç¶šãæœ€æ–°æƒ…å ±ã«ã”æ³¨æ„ãã ã•ã„ã€‚
          
          ä»¥ä¸Šã€åœ°éœ‡æƒ…å ±ã‚’ãŠä¼ãˆã—ã¾ã—ãŸã€‚
          EOF
          
          echo "âœ… åŸºæœ¬ãƒ‹ãƒ¥ãƒ¼ã‚¹åŽŸç¨¿ã‚’ä½œæˆã—ã¾ã—ãŸ"
          
          # Create simple metadata
          cat > projects/earthquake-news-video/final/workflow-summary.json << EOF
          {
            "workflow": "earthquake-news-video-fallback",
            "status": "completed",
            "concept": "${{ inputs.concept }}",
            "region": "${{ inputs.earthquake_region }}",
            "generated_at": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "deliverables": {
              "script": "projects/earthquake-news-video/temp/news-script.txt",
              "status": "basic template created"
            },
            "next_steps": [
              "Use full Meta Workflow for complete video generation",
              "Add specific earthquake data from reliable sources",
              "Implement image and video generation steps",
              "Add Japanese narration and subtitles"
            ]
          }
          EOF
          
          echo "âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ"
          echo "status=completed" >> $GITHUB_OUTPUT
          
          echo ""
          echo "ðŸ“‹ Summary:"
          echo "âœ… Basic news script template created"
          echo "âœ… Project structure initialized"
          echo "âœ… Metadata generated"
          echo ""
          echo "ðŸ”„ Next steps:"
          echo "1. Fix YAML syntax issues in full Meta Workflow"
          echo "2. Re-run with corrected workflow for complete video generation"
          
  upload-deliverables:
    runs-on: ubuntu-latest
    needs: fallback-workflow
    if: needs.fallback-workflow.outputs.workflow_status == 'completed'
    
    steps:
      - name: Upload Fallback Results
        uses: actions/upload-artifact@v4
        with:
          name: earthquake-news-fallback-results
          path: projects/earthquake-news-video/
          retention-days: 7