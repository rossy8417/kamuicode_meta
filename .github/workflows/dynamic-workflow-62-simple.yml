name: "🎯 Simple Test - Issue #62"
run-name: "📊 Simple Test | ${{ github.actor }}"

on:
  workflow_dispatch:

permissions:
  contents: write
  actions: write
  issues: write

env:
  CLAUDE_CODE_CI_MODE: true
  CLAUDE_CODE_AUTO_APPROVE_MCP: true
  PROJECT_DIR: projects/issue-62-test

jobs:
  main:
    name: "🎬 Create AI Education Video"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Project Structure
        run: |
          mkdir -p $PROJECT_DIR/{metadata,media/images,media/audio,media/videos,final}
          echo "✅ Created project structure: $PROJECT_DIR"

      - name: Generate Educational Content
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          # Get issue details
          ISSUE_TITLE=$(gh issue view 62 --json title -q .title || echo "教育用AI解説動画の作成 - 機械学習の基礎を説明")
          
          # Create educational plan
          cat > $PROJECT_DIR/metadata/education-plan.md << 'EOF'
          # AI Education Video Plan
          
          ## Title: 機械学習の基礎
          
          ### Structure:
          1. Introduction (30s)
          2. Core Concepts (2min)
          3. Examples (1min)
          4. Summary (30s)
          
          ### Total Duration: 4 minutes
          EOF
          
          echo "✅ Created education plan"

      - name: Generate Visual Assets
        run: |
          # Simulate image generation
          for i in 1 2 3 4; do
            touch $PROJECT_DIR/media/images/scene-$i.png
            echo "✅ Generated scene-$i.png"
          done

      - name: Generate Audio Narration
        run: |
          # Simulate audio generation
          touch $PROJECT_DIR/media/audio/narration.mp3
          echo "✅ Generated narration.mp3"

      - name: Create Video
        run: |
          # Simulate video generation
          touch $PROJECT_DIR/media/videos/base-video.mp4
          echo "✅ Generated base-video.mp4"

      - name: Final Assembly
        run: |
          # Create final video
          touch $PROJECT_DIR/final/ai-education-video.mp4
          
          # Create summary
          cat > $PROJECT_DIR/final/summary.md << 'EOF'
          # AI Education Video - Summary
          
          ## Generated Assets:
          - 4 educational images
          - 1 narration audio (Japanese)
          - 1 final video (4 minutes)
          
          ## Status: ✅ Complete
          EOF
          
          echo "✅ Created final video"

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ai-education-video-test
          path: ${{ env.PROJECT_DIR }}/

      - name: Generate Summary
        run: |
          echo "# 🎯 AI Education Video Test Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Generated Files:" >> $GITHUB_STEP_SUMMARY
          echo "- Education plan: ✅" >> $GITHUB_STEP_SUMMARY
          echo "- Images: 4 files ✅" >> $GITHUB_STEP_SUMMARY
          echo "- Audio: 1 file ✅" >> $GITHUB_STEP_SUMMARY
          echo "- Video: 1 file ✅" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Project: $PROJECT_DIR" >> $GITHUB_STEP_SUMMARY