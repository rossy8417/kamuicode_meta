name: "Professional News Video Creation Workflow"

on:
  workflow_dispatch:
    inputs:
      news_topic:
        description: "ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®ãƒˆãƒ”ãƒƒã‚¯ï¼ˆä¾‹ï¼šæŠ€è¡“é©æ–°ã€æ”¿æ²»ã€çµŒæ¸ˆï¼‰"
        required: true
        default: "æœ€æ–°ã®æŠ€è¡“é©æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹"
      time_period:
        description: "å¯¾è±¡æœŸé–“ï¼ˆä¾‹ï¼š24æ™‚é–“ä»¥å†…ã€1é€±é–“ä»¥å†…ï¼‰"
        required: true
        default: "24æ™‚é–“ä»¥å†…"
      project_name:
        description: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆå‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½¿ç”¨ï¼‰"
        required: true
        default: "news-video-production"

env:
  CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
  CLAUDE_CODE_CI_MODE: true
  CLAUDE_CODE_AUTO_APPROVE_MCP: true

jobs:
  # Phase 1: Foundation - Information Gathering
  phase1-foundation:
    runs-on: ubuntu-latest
    outputs:
      project_dir: ${{ steps.setup.outputs.project_dir }}
      research_data: ${{ steps.research.outputs.research_data }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup project structure
        id: setup
        run: |
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)
          PROJECT_DIR="${GITHUB_WORKSPACE}/projects/${{ inputs.project_name }}-${TIMESTAMP}"
          mkdir -p "${PROJECT_DIR}"/{metadata,logs,media/{images,videos,audio,3d},final,temp}
          echo "project_dir=${PROJECT_DIR}" >> $GITHUB_OUTPUT
          echo "[$(date)] Phase 1: Foundation started" >> "${PROJECT_DIR}/logs/execution.log"
          echo "Project directory: ${PROJECT_DIR}"

      - name: News Research and Information Gathering
        id: research
        run: |
          PROJECT_DIR="${{ steps.setup.outputs.project_dir }}"
          echo "[$(date)] Starting news research for topic: ${{ inputs.news_topic }}" >> "${PROJECT_DIR}/logs/execution.log"
          
          RESEARCH_PROMPT="ãƒ‹ãƒ¥ãƒ¼ã‚¹æƒ…å ±åŽé›†ãƒ»ãƒªã‚µãƒ¼ãƒã‚¿ã‚¹ã‚¯ï¼š
          ãƒˆãƒ”ãƒƒã‚¯: ${{ inputs.news_topic }}
          æœŸé–“: ${{ inputs.time_period }}
          
          ä»¥ä¸‹ã®è¦ä»¶ã§æƒ…å ±åŽé›†ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
          1. æŒ‡å®šã•ã‚ŒãŸãƒˆãƒ”ãƒƒã‚¯ã®æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¤‡æ•°ã®ä¿¡é ¼æ€§ã®é«˜ã„æƒ…å ±æºã‹ã‚‰åŽé›†
          2. äº‹å®Ÿç¢ºèªã¨æƒ…å ±ã®ä¿¡é ¼æ€§æ¤œè¨¼
          3. 60ç§’ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ã«é©ã—ãŸè¦ç‚¹ã®æ•´ç†
          4. JSONå½¢å¼ã§structured dataã¨ã—ã¦ä¿å­˜: ${PROJECT_DIR}/metadata/research_data.json
          
          å‡ºåŠ›å½¢å¼:
          {
            \"topic\": \"ãƒˆãƒ”ãƒƒã‚¯å\",
            \"sources\": [\"æƒ…å ±æº1\", \"æƒ…å ±æº2\", \"æƒ…å ±æº3\"],
            \"key_facts\": [\"é‡è¦äº‹å®Ÿ1\", \"é‡è¦äº‹å®Ÿ2\"],
            \"timeline\": \"æ™‚ç³»åˆ—æƒ…å ±\",
            \"reliability_score\": 0.95
          }"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "WebSearch,Write,Read" \
            --max-turns 20 \
            --permission-mode "acceptEdits" \
            -p "$RESEARCH_PROMPT"
          
          if [ -f "${PROJECT_DIR}/metadata/research_data.json" ]; then
            echo "research_data=${PROJECT_DIR}/metadata/research_data.json" >> $GITHUB_OUTPUT
            echo "[$(date)] Research completed successfully" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Research data not generated" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Upload Phase 1 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: phase1-foundation
          path: ${{ steps.setup.outputs.project_dir }}/

  # Phase 2: Content Creation - Script and Structure
  phase2-content-creation:
    runs-on: ubuntu-latest
    needs: phase1-foundation
    outputs:
      script_data: ${{ steps.script.outputs.script_data }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download Phase 1 artifacts
        uses: actions/download-artifact@v4
        with:
          name: phase1-foundation
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

      - name: Create News Script and Structure
        id: script
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          RESEARCH_DATA="${{ needs.phase1-foundation.outputs.research_data }}"
          echo "[$(date)] Phase 2: Content creation started" >> "${PROJECT_DIR}/logs/execution.log"
          
          SCRIPT_PROMPT="ãƒ‹ãƒ¥ãƒ¼ã‚¹åŽŸç¨¿ãƒ»æ§‹æˆä½œæˆã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›ãƒ‡ãƒ¼ã‚¿: ${RESEARCH_DATA}
          ç›®æ¨™: 60ç§’ã®ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ç”¨ã®æ§‹æˆã¨åŽŸç¨¿ä½œæˆ
          
          ä»¥ä¸‹ã®è¦ä»¶ã§åŽŸç¨¿ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š
          1. ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã®é»„é‡‘æ¯”ï¼šãƒ•ãƒƒã‚¯(20%) â†’ æœ¬ç·¨(60%) â†’ ã¾ã¨ã‚(20%)
          2. æœ€åˆã®3ç§’ã§è¦–è´è€…ã‚’å¼•ãã¤ã‘ã‚‹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®ã‚ã‚‹ãƒ•ãƒƒã‚¯
          3. æ˜Žç¢ºã§èžãå–ã‚Šã‚„ã™ã„æ—¥æœ¬èªžãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åŽŸç¨¿
          4. 10-12ã‚·ãƒ¼ãƒ³ã®è¦–è¦šçš„æ§‹æˆï¼ˆå„5-6ç§’ï¼‰
          5. ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¢ãƒŠã‚¦ãƒ³ã‚µãƒ¼é¢¨ã®ãƒˆãƒ¼ãƒ³
          
          å‡ºåŠ›: ${PROJECT_DIR}/metadata/script_data.json
          å½¢å¼:
          {
            \"total_duration\": 60,
            \"structure\": {
              \"hook\": \"æœ€åˆã®3ç§’ã®ãƒ•ãƒƒã‚¯æ–‡\",
              \"main_content\": \"æœ¬ç·¨ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³\",
              \"conclusion\": \"ã¾ã¨ã‚æ–‡\"
            },
            \"narration_script\": \"å®Œå…¨ãªãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åŽŸç¨¿\",
            \"visual_scenes\": [
              {\"scene_id\": 1, \"duration\": 6, \"description\": \"ã‚·ãƒ¼ãƒ³èª¬æ˜Ž\", \"image_prompt\": \"ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\"},
              {\"scene_id\": 2, \"duration\": 6, \"description\": \"ã‚·ãƒ¼ãƒ³èª¬æ˜Ž\", \"image_prompt\": \"ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\"}
            ]
          }"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "Read,Write,Edit" \
            --max-turns 20 \
            --permission-mode "acceptEdits" \
            -p "$SCRIPT_PROMPT"
          
          if [ -f "${PROJECT_DIR}/metadata/script_data.json" ]; then
            echo "script_data=${PROJECT_DIR}/metadata/script_data.json" >> $GITHUB_OUTPUT
            echo "[$(date)] Script creation completed successfully" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Script data not generated" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Upload Phase 2 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: phase2-content-creation
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

  # Phase 3: Parallel Content Generation - Audio & Images Batch 1
  phase3-parallel-generation:
    runs-on: ubuntu-latest
    needs: [phase1-foundation, phase2-content-creation]
    strategy:
      matrix:
        task: [audio-generation, images-batch1]
      max-parallel: 2
    outputs:
      audio_file: ${{ steps.audio-task.outputs.audio_file }}
      images_batch1: ${{ steps.images-task.outputs.images_batch1 }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download previous artifacts
        uses: actions/download-artifact@v4
        with:
          name: phase2-content-creation
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

      - name: Audio Generation Task
        if: matrix.task == 'audio-generation'
        id: audio-task
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          SCRIPT_DATA="${{ needs.phase2-content-creation.outputs.script_data }}"
          echo "[$(date)] Phase 3: Audio generation started" >> "${PROJECT_DIR}/logs/execution.log"
          
          AUDIO_PROMPT="æ—¥æœ¬èªžãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³éŸ³å£°ç”Ÿæˆã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›: ${SCRIPT_DATA}
          ç›®æ¨™: ãƒ—ãƒ­ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¢ãƒŠã‚¦ãƒ³ã‚µãƒ¼é¢¨ã®é«˜å“è³ªéŸ³å£°ç”Ÿæˆ
          
          è¦ä»¶:
          1. æ˜Žçž­ã§èžãå–ã‚Šã‚„ã™ã„ç™ºéŸ³
          2. ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¢ãƒŠã‚¦ãƒ³ã‚µãƒ¼ã¨ã—ã¦ã®ä¿¡é ¼æ„Ÿã®ã‚ã‚‹å£°è³ª
          3. é©åˆ‡ãªé–“ã®å–ã‚Šæ–¹ã¨ãƒšãƒ¼ã‚¹
          4. -14LUFSåŸºæº–ã®éŸ³å£°ãƒ¬ãƒ™ãƒ«
          5. æ—¥æœ¬èªžéŸ³å£°ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨
          
          å‡ºåŠ›: ${PROJECT_DIR}/media/audio/narration.mp3
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/audio_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2s-fal-minimax-speech-02-turbo__minimax_speech_02_turbo_submit,mcp__t2s-fal-minimax-speech-02-turbo__minimax_speech_02_turbo_status,mcp__t2s-fal-minimax-speech-02-turbo__minimax_speech_02_turbo_result,Write,Read" \
            --max-turns 15 \
            --permission-mode "acceptEdits" \
            -p "$AUDIO_PROMPT"
          
          # Check for generated audio
          AUDIO_FILE=$(find "${PROJECT_DIR}/media/audio" -name "*.mp3" -o -name "*.wav" | head -1)
          if [ -n "$AUDIO_FILE" ]; then
            echo "audio_file=${AUDIO_FILE}" >> $GITHUB_OUTPUT
            echo "[$(date)] Audio generation completed: ${AUDIO_FILE}" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Audio file not generated" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Images Batch 1 Generation Task
        if: matrix.task == 'images-batch1'
        id: images-task
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          SCRIPT_DATA="${{ needs.phase2-content-creation.outputs.script_data }}"
          echo "[$(date)] Phase 3: Images batch 1 generation started" >> "${PROJECT_DIR}/logs/execution.log"
          
          IMAGES_PROMPT="ãƒ‹ãƒ¥ãƒ¼ã‚¹ç”»åƒç´ æç”Ÿæˆï¼ˆãƒãƒƒãƒ1ï¼‰ã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›: ${SCRIPT_DATA}
          ç›®æ¨™: æœ€åˆã®5ã‚·ãƒ¼ãƒ³ç”¨ã®é«˜å“è³ªãƒ‹ãƒ¥ãƒ¼ã‚¹ç”»åƒç”Ÿæˆ
          
          è¦ä»¶:
          1. ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã‚¹ã‚¿ã‚¤ãƒ«
          2. ä¿¡é ¼æ€§ã‚’è¡¨ç¾ã™ã‚‹é’ç³»ã¨ç·Šæ€¥æ€§ã®èµ¤ç³»ã‚’åŠ¹æžœçš„ã«æ´»ç”¨
          3. Rule of thirdsã«å¾“ã£ãŸæ§‹å›³
          4. 16:9ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã€1920x1080è§£åƒåº¦
          5. ãƒ‹ãƒ¥ãƒ¼ã‚¹å†…å®¹ã¨ä¸€è‡´ã™ã‚‹è¦–è¦šçš„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ
          
          å‡¦ç†: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æœ€åˆã®5ã‚·ãƒ¼ãƒ³ã®ç”»åƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨
          å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: ${PROJECT_DIR}/media/images/batch1/
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/images_batch1_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2i-google-imagen3__imagen_t2i,Write,Read" \
            --max-turns 15 \
            --permission-mode "acceptEdits" \
            -p "$IMAGES_PROMPT"
          
          # Check for generated images
          IMAGE_COUNT=$(find "${PROJECT_DIR}/media/images/batch1" -name "*.png" -o -name "*.jpg" | wc -l)
          if [ "$IMAGE_COUNT" -ge 5 ]; then
            echo "images_batch1=${PROJECT_DIR}/media/images/batch1" >> $GITHUB_OUTPUT
            echo "[$(date)] Images batch 1 completed: ${IMAGE_COUNT} images" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Insufficient images generated (${IMAGE_COUNT}/5)" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Upload Phase 3 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: phase3-${{ matrix.task }}
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

  # Phase 4: Parallel Processing - Batch 2 Images & Video Conversion Batch 1
  phase4-parallel-processing:
    runs-on: ubuntu-latest
    needs: [phase1-foundation, phase2-content-creation, phase3-parallel-generation]
    strategy:
      matrix:
        task: [images-batch2, video-conversion-batch1]
      max-parallel: 2
    outputs:
      images_batch2: ${{ steps.images-batch2-task.outputs.images_batch2 }}
      videos_batch1: ${{ steps.video-batch1-task.outputs.videos_batch1 }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download all previous artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: phase*
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/
          merge-multiple: true

      - name: Images Batch 2 Generation Task
        if: matrix.task == 'images-batch2'
        id: images-batch2-task
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          SCRIPT_DATA="${{ needs.phase2-content-creation.outputs.script_data }}"
          echo "[$(date)] Phase 4: Images batch 2 generation started" >> "${PROJECT_DIR}/logs/execution.log"
          
          IMAGES_PROMPT="ãƒ‹ãƒ¥ãƒ¼ã‚¹ç”»åƒç´ æç”Ÿæˆï¼ˆãƒãƒƒãƒ2ï¼‰ã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›: ${SCRIPT_DATA}
          ç›®æ¨™: å¾ŒåŠ5ã‚·ãƒ¼ãƒ³ç”¨ã®é«˜å“è³ªãƒ‹ãƒ¥ãƒ¼ã‚¹ç”»åƒç”Ÿæˆ
          
          è¦ä»¶:
          1. ç¬¬1ãƒãƒƒãƒã¨ã®ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€
          2. ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®å¾ŒåŠéƒ¨åˆ†ã«å¯¾å¿œ
          3. ã‚¯ãƒ©ã‚¤ãƒžãƒƒã‚¯ã‚¹éƒ¨åˆ†ã«é©ã—ãŸè¦–è¦šçš„è¡¨ç¾
          4. åŒä¸€ã®å“è³ªåŸºæº–ã¨ã‚¹ã‚¿ã‚¤ãƒ«ç¶­æŒ
          5. 16:9ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å“è³ª
          
          å‡¦ç†: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å¾ŒåŠ5ã‚·ãƒ¼ãƒ³ã®ç”»åƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨
          å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: ${PROJECT_DIR}/media/images/batch2/
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/images_batch2_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2i-google-imagen3__imagen_t2i,Write,Read" \
            --max-turns 15 \
            --permission-mode "acceptEdits" \
            -p "$IMAGES_PROMPT"
          
          # Check for generated images
          IMAGE_COUNT=$(find "${PROJECT_DIR}/media/images/batch2" -name "*.png" -o -name "*.jpg" | wc -l)
          if [ "$IMAGE_COUNT" -ge 5 ]; then
            echo "images_batch2=${PROJECT_DIR}/media/images/batch2" >> $GITHUB_OUTPUT
            echo "[$(date)] Images batch 2 completed: ${IMAGE_COUNT} images" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Insufficient images generated (${IMAGE_COUNT}/5)" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Video Conversion Batch 1 Task
        if: matrix.task == 'video-conversion-batch1'
        id: video-batch1-task
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          echo "[$(date)] Phase 4: Video conversion batch 1 started" >> "${PROJECT_DIR}/logs/execution.log"
          
          VIDEO_PROMPT="ç”»åƒã‹ã‚‰å‹•ç”»å¤‰æ›ï¼ˆãƒãƒƒãƒ1ï¼‰ã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›: ${PROJECT_DIR}/media/images/batch1/
          ç›®æ¨™: æœ€åˆã®5æžšã®ç”»åƒã‚’å‹•ç”»ã‚¯ãƒªãƒƒãƒ—ã«å¤‰æ›
          
          è¦ä»¶:
          1. å„ã‚¯ãƒªãƒƒãƒ—6-8ç§’ã®é©åˆ‡ãªé•·ã•
          2. ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã‚‰ã—ã„è‡ªç„¶ãªå‹•ã
          3. éŽåº¦ãªãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¿ã‘ãŸä¸Šå“ãªå‹•ã
          4. static, pan, zoomã®åŠ¹æžœçš„æ´»ç”¨
          5. ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªå“è³ªåŸºæº–
          
          å‡¦ç†: batch1ãƒ•ã‚©ãƒ«ãƒ€å†…ã®å…¨ç”»åƒã‚’å‹•ç”»å¤‰æ›
          å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: ${PROJECT_DIR}/media/videos/batch1/
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/videos_batch1_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_submit,mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_status,mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_result,Write,Read" \
            --max-turns 20 \
            --permission-mode "acceptEdits" \
            -p "$VIDEO_PROMPT"
          
          # Check for generated videos
          VIDEO_COUNT=$(find "${PROJECT_DIR}/media/videos/batch1" -name "*.mp4" | wc -l)
          if [ "$VIDEO_COUNT" -ge 5 ]; then
            echo "videos_batch1=${PROJECT_DIR}/media/videos/batch1" >> $GITHUB_OUTPUT
            echo "[$(date)] Video conversion batch 1 completed: ${VIDEO_COUNT} videos" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Insufficient videos generated (${VIDEO_COUNT}/5)" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Upload Phase 4 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: phase4-${{ matrix.task }}
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

  # Phase 5: Parallel Audio & Visual Production
  phase5-parallel-production:
    runs-on: ubuntu-latest
    needs: [phase1-foundation, phase2-content-creation, phase3-parallel-generation, phase4-parallel-processing]
    strategy:
      matrix:
        task: [video-conversion-batch2, bgm-generation, opening-creation]
      max-parallel: 3
    outputs:
      videos_batch2: ${{ steps.video-batch2-task.outputs.videos_batch2 }}
      bgm_file: ${{ steps.bgm-task.outputs.bgm_file }}
      opening_video: ${{ steps.opening-task.outputs.opening_video }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download all previous artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: phase*
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/
          merge-multiple: true

      - name: Video Conversion Batch 2 Task
        if: matrix.task == 'video-conversion-batch2'
        id: video-batch2-task
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          echo "[$(date)] Phase 5: Video conversion batch 2 started" >> "${PROJECT_DIR}/logs/execution.log"
          
          VIDEO_PROMPT="ç”»åƒã‹ã‚‰å‹•ç”»å¤‰æ›ï¼ˆãƒãƒƒãƒ2ï¼‰ã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›: ${PROJECT_DIR}/media/images/batch2/
          ç›®æ¨™: å¾ŒåŠ5æžšã®ç”»åƒã‚’å‹•ç”»ã‚¯ãƒªãƒƒãƒ—ã«å¤‰æ›
          
          è¦ä»¶:
          1. ç¬¬1ãƒãƒƒãƒã¨ã®å“è³ªçµ±ä¸€
          2. ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®å¾ŒåŠå±•é–‹ã«é©ã—ãŸå‹•ã
          3. ã‚¯ãƒ©ã‚¤ãƒžãƒƒã‚¯ã‚¹éƒ¨åˆ†ã®å‹•çš„è¡¨ç¾
          4. 6-8ç§’ã®é©åˆ‡ãªé•·ã•ç¶­æŒ
          5. ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªå“è³ªåŸºæº–
          
          å‡¦ç†: batch2ãƒ•ã‚©ãƒ«ãƒ€å†…ã®å…¨ç”»åƒã‚’å‹•ç”»å¤‰æ›
          å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: ${PROJECT_DIR}/media/videos/batch2/
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/videos_batch2_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_submit,mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_status,mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_result,Write,Read" \
            --max-turns 20 \
            --permission-mode "acceptEdits" \
            -p "$VIDEO_PROMPT"
          
          # Check for generated videos
          VIDEO_COUNT=$(find "${PROJECT_DIR}/media/videos/batch2" -name "*.mp4" | wc -l)
          if [ "$VIDEO_COUNT" -ge 5 ]; then
            echo "videos_batch2=${PROJECT_DIR}/media/videos/batch2" >> $GITHUB_OUTPUT
            echo "[$(date)] Video conversion batch 2 completed: ${VIDEO_COUNT} videos" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Insufficient videos generated (${VIDEO_COUNT}/5)" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: BGM Generation Task
        if: matrix.task == 'bgm-generation'
        id: bgm-task
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          echo "[$(date)] Phase 5: BGM generation started" >> "${PROJECT_DIR}/logs/execution.log"
          
          BGM_PROMPT="BGMãƒ»åŠ¹æžœéŸ³ç”Ÿæˆãƒ»é¸æŠžã‚¿ã‚¹ã‚¯ï¼š
          
          ç›®æ¨™: ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã‚‰ã—ã„ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªBGMç”Ÿæˆ
          
          è¦ä»¶:
          1. æƒ…å ±ä¼é”ã‚’é‚ªé­”ã—ãªã„æŽ§ãˆã‚ãªéŸ³æ¥½
          2. ä¿¡é ¼æ„Ÿã¨ç·Šæ€¥æ„Ÿã®ãƒãƒ©ãƒ³ã‚¹
          3. ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚ˆã‚Š20-25dBä½Žã„ãƒ¬ãƒ™ãƒ«
          4. 60ç§’ã®å‹•ç”»ã«é©ã—ãŸé•·ã•
          5. ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã®é›°å›²æ°—æ¼”å‡º
          
          ã‚¹ã‚¿ã‚¤ãƒ«: ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ç”¨BGMã€instrumentalã€professional
          å‡ºåŠ›: ${PROJECT_DIR}/media/audio/bgm.mp3
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/bgm_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2m-google-lyria__lyria_generate,Write,Read" \
            --max-turns 20 \
            --permission-mode "acceptEdits" \
            -p "$BGM_PROMPT"
          
          # Check for generated BGM
          BGM_FILE=$(find "${PROJECT_DIR}/media/audio" -name "*bgm*" -o -name "*background*" | head -1)
          if [ -n "$BGM_FILE" ]; then
            echo "bgm_file=${BGM_FILE}" >> $GITHUB_OUTPUT
            echo "[$(date)] BGM generation completed: ${BGM_FILE}" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: BGM file not generated" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Opening Creation Task
        if: matrix.task == 'opening-creation'
        id: opening-task
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          SCRIPT_DATA="${{ needs.phase2-content-creation.outputs.script_data }}"
          echo "[$(date)] Phase 5: Opening creation started" >> "${PROJECT_DIR}/logs/execution.log"
          
          OPENING_PROMPT="ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ä½œæˆã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›: ${SCRIPT_DATA}
          ç›®æ¨™: æœ€åˆã®3ç§’ã§è¦–è´ç¶™ç¶šã®50%ã‚’æ±ºã‚ã‚‹ ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®ã‚ã‚‹ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°
          
          è¦ä»¶:
          1. çž¬æ™‚ã«æ³¨æ„ã‚’å¼•ãè¦–è¦šçš„ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ
          2. ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã¨ã—ã¦ã®ä¿¡é ¼æ€§è¡¨ç¾
          3. ä¿¡é ¼æ€§ï¼ˆé’ç³»ï¼‰ã¨ç·Šæ€¥æ€§ï¼ˆèµ¤ç³»ï¼‰ã®è‰²å½©æ´»ç”¨
          4. 3ç§’ä»¥å†…ã«ãƒˆãƒ”ãƒƒã‚¯ã‚’æ˜Žç¤º
          5. ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã‚¹ã‚¿ã‚¤ãƒ«
          
          å‡¦ç†æ‰‹é †:
          1. ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®ã‚ã‚‹ã‚¿ã‚¤ãƒˆãƒ«ç”»åƒã‚’ç”Ÿæˆ
          2. ç”»åƒã‚’å‹•ç”»ã«å¤‰æ›ï¼ˆ3-5ç§’ï¼‰
          
          å‡ºåŠ›: ${PROJECT_DIR}/media/videos/opening.mp4
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/opening_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "mcp__t2i-google-imagen3__imagen_t2i,mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_submit,mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_status,mcp__i2v-fal-hailuo-02-fast__hailuo_02_fast_result,Write,Read" \
            --max-turns 15 \
            --permission-mode "acceptEdits" \
            -p "$OPENING_PROMPT"
          
          # Check for generated opening video
          OPENING_FILE=$(find "${PROJECT_DIR}/media/videos" -name "*opening*" | head -1)
          if [ -n "$OPENING_FILE" ]; then
            echo "opening_video=${OPENING_FILE}" >> $GITHUB_OUTPUT
            echo "[$(date)] Opening creation completed: ${OPENING_FILE}" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Opening video not generated" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Upload Phase 5 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: phase5-${{ matrix.task }}
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

  # Phase 6: Integration - Video Concatenation
  phase6-integration:
    runs-on: ubuntu-latest
    needs: [phase1-foundation, phase2-content-creation, phase4-parallel-processing, phase5-parallel-production]
    outputs:
      concatenated_video: ${{ steps.concat.outputs.concatenated_video }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download all previous artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: phase*
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/
          merge-multiple: true

      - name: Video Concatenation
        id: concat
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          echo "[$(date)] Phase 6: Video concatenation started" >> "${PROJECT_DIR}/logs/execution.log"
          
          CONCAT_PROMPT="å…¨å‹•ç”»ã‚¯ãƒªãƒƒãƒ—çµåˆã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«:
          - ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°: ${PROJECT_DIR}/media/videos/opening.mp4
          - ãƒãƒƒãƒ1å‹•ç”»: ${PROJECT_DIR}/media/videos/batch1/
          - ãƒãƒƒãƒ2å‹•ç”»: ${PROJECT_DIR}/media/videos/batch2/
          
          ç›®æ¨™: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ã¨ã—ã¦çµ±åˆ
          
          è¦ä»¶:
          1. é©åˆ‡ãªé †åºã§ã®ã‚¯ãƒªãƒƒãƒ—çµåˆ
          2. ã‚¹ãƒ ãƒ¼ã‚ºãªãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ï¼ˆfade, cutï¼‰
          3. 60ç§’ä»¥å†…ã®ç·æ™‚é–“
          4. ãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ã®ã‚«ãƒƒãƒˆé–“éš”ï¼ˆ3-8ç§’ï¼‰
          5. æƒ…å ±ã®æµã‚Œã«æ²¿ã£ãŸè‡ªç„¶ãªæ§‹æˆ
          
          å‡¦ç†é †åº:
          1. ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚° â†’ ãƒãƒƒãƒ1å‹•ç”»ç¾¤ â†’ ãƒãƒƒãƒ2å‹•ç”»ç¾¤
          2. å„ã‚¯ãƒªãƒƒãƒ—é–“ã«fadeãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³è¿½åŠ 
          3. ç·æ™‚é–“ã®èª¿æ•´ï¼ˆ60ç§’ä»¥å†…ï¼‰
          
          å‡ºåŠ›: ${PROJECT_DIR}/media/videos/concatenated.mp4
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/concatenation_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "Bash,Write,Read" \
            --max-turns 20 \
            --permission-mode "acceptEdits" \
            -p "$CONCAT_PROMPT"
          
          # Check for concatenated video
          CONCAT_FILE=$(find "${PROJECT_DIR}/media/videos" -name "*concatenated*" -o -name "*final*" | head -1)
          if [ -n "$CONCAT_FILE" ]; then
            echo "concatenated_video=${CONCAT_FILE}" >> $GITHUB_OUTPUT
            echo "[$(date)] Video concatenation completed: ${CONCAT_FILE}" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Concatenated video not generated" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Upload Phase 6 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: phase6-integration
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

  # Phase 7: Final Audio Mix
  phase7-audio-mix:
    runs-on: ubuntu-latest
    needs: [phase1-foundation, phase3-parallel-generation, phase5-parallel-production, phase6-integration]
    outputs:
      final_video: ${{ steps.mix.outputs.final_video }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download all previous artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: phase*
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/
          merge-multiple: true

      - name: Audio and BGM Mixing
        id: mix
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          CONCATENATED_VIDEO="${{ needs.phase6-integration.outputs.concatenated_video }}"
          echo "[$(date)] Phase 7: Audio mixing started" >> "${PROJECT_DIR}/logs/execution.log"
          
          # Find audio files
          NARRATION_FILE=$(find "${PROJECT_DIR}/media/audio" -name "*narration*" -o -name "*speech*" | head -1)
          BGM_FILE=$(find "${PROJECT_DIR}/media/audio" -name "*bgm*" -o -name "*background*" | head -1)
          
          MIX_PROMPT="éŸ³å£°ãƒ»BGMãƒŸãƒƒã‚¯ã‚¹ã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«:
          - å‹•ç”»: ${CONCATENATED_VIDEO}
          - ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ${NARIATION_FILE}
          - BGM: ${BGM_FILE}
          
          ç›®æ¨™: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„ã®éŸ³éŸ¿å“è³ªå®Ÿç¾
          
          è¦ä»¶:
          1. ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³éŸ³å£°ãƒ¬ãƒ™ãƒ«: -14LUFS
          2. BGMãƒ¬ãƒ™ãƒ«: ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚ˆã‚Š20-25dBä½Žã
          3. éŸ³å£°ã®æ˜Žçž­æ€§æœ€å„ªå…ˆ
          4. é©åˆ‡ãªéŸ³éŸ¿ãƒãƒ©ãƒ³ã‚¹
          5. ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªå“è³ªåŸºæº–
          
          å‡¦ç†:
          1. ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•ç”»ã«åŒæœŸ
          2. BGMã‚’é©åˆ‡ãªãƒ¬ãƒ™ãƒ«ã§ãƒŸãƒƒã‚¯ã‚¹
          3. éŸ³å£°ãƒ¬ãƒ™ãƒ«ã®èª¿æ•´ã¨æœ€é©åŒ–
          
          å‡ºåŠ›: ${PROJECT_DIR}/final/professional_news_video.mp4
          ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: ${PROJECT_DIR}/metadata/final_mix_metadata.json"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "Bash,Write,Read" \
            --max-turns 20 \
            --permission-mode "acceptEdits" \
            -p "$MIX_PROMPT"
          
          # Check for final video
          FINAL_FILE=$(find "${PROJECT_DIR}/final" -name "*.mp4" | head -1)
          if [ -n "$FINAL_FILE" ]; then
            echo "final_video=${FINAL_FILE}" >> $GITHUB_OUTPUT
            echo "[$(date)] Audio mixing completed: ${FINAL_FILE}" >> "${PROJECT_DIR}/logs/execution.log"
          else
            echo "[$(date)] ERROR: Final video not generated" >> "${PROJECT_DIR}/logs/execution.log"
            exit 1
          fi

      - name: Upload Phase 7 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: phase7-audio-mix
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

  # Phase 8: Quality Assurance and Final Output
  phase8-quality-assurance:
    runs-on: ubuntu-latest
    needs: [phase1-foundation, phase7-audio-mix]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: phase*
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/
          merge-multiple: true

      - name: Final Quality Check and Export
        id: quality-check
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          FINAL_VIDEO="${{ needs.phase7-audio-mix.outputs.final_video }}"
          echo "[$(date)] Phase 8: Quality assurance started" >> "${PROJECT_DIR}/logs/execution.log"
          
          QC_PROMPT="æœ€çµ‚å“è³ªãƒã‚§ãƒƒã‚¯ãƒ»æ›¸ãå‡ºã—ã‚¿ã‚¹ã‚¯ï¼š
          
          å…¥åŠ›: ${FINAL_VIDEO}
          ç›®æ¨™: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹å‹•ç”»ã¨ã—ã¦å…¬é–‹æº–å‚™å®Œäº†
          
          ãƒã‚§ãƒƒã‚¯é …ç›®:
          1. éŸ³å£°ãƒ¬ãƒ™ãƒ«ç¢ºèªï¼ˆ-14LUFSåŸºæº–ï¼‰
          2. ç”»è³ªãƒ»è§£åƒåº¦çµ±ä¸€ç¢ºèª
          3. æƒ…å ±ã®æ­£ç¢ºæ€§ãƒã‚§ãƒƒã‚¯
          4. 60ç§’åˆ¶é™æ™‚é–“æº–æ‹ ç¢ºèª
          5. ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„å“è³ªåŸºæº–æº€äº†
          
          æœ€çµ‚å‡ºåŠ›:
          1. å“è³ªãƒã‚§ãƒƒã‚¯ãƒ¬ãƒãƒ¼ãƒˆ: ${PROJECT_DIR}/final/quality_report.json
          2. æœ€çµ‚å‹•ç”»ç¢ºèªãƒ»æœ€é©åŒ–
          3. é…ä¿¡æº–å‚™å®Œäº†çŠ¶æ…‹ã§ã®ä¿å­˜
          
          å“è³ªåŸºæº–:
          - æŠ€è¡“ä»•æ§˜: 1920x1080, 30fps, H.264
          - éŸ³å£°: -14LUFS, æ˜Žçž­ã§èžãå–ã‚Šã‚„ã™ã„
          - æ™‚é–“: 60ç§’ä»¥å†…
          - å†…å®¹: æ­£ç¢ºã§ä¿¡é ¼æ€§ã®é«˜ã„æƒ…å ±"
          
          npx @anthropic-ai/claude-code \
            --mcp-config ".claude/mcp-kamuicode.json" \
            --allowedTools "Bash,Write,Read" \
            --max-turns 8 \
            --permission-mode "acceptEdits" \
            -p "$QC_PROMPT"
          
          echo "[$(date)] Quality assurance completed" >> "${PROJECT_DIR}/logs/execution.log"
          
          # Create final summary
          echo "=== PROFESSIONAL NEWS VIDEO CREATION COMPLETED ===" >> "${PROJECT_DIR}/final/completion_report.txt"
          echo "Project: ${{ inputs.project_name }}" >> "${PROJECT_DIR}/final/completion_report.txt"
          echo "Topic: ${{ inputs.news_topic }}" >> "${PROJECT_DIR}/final/completion_report.txt"
          echo "Completed: $(date)" >> "${PROJECT_DIR}/final/completion_report.txt"
          echo "Final video: ${FINAL_VIDEO}" >> "${PROJECT_DIR}/final/completion_report.txt"

      - name: Upload Final Results
        uses: actions/upload-artifact@v4
        with:
          name: final-professional-news-video
          path: ${{ needs.phase1-foundation.outputs.project_dir }}/

      - name: Create workflow summary
        run: |
          PROJECT_DIR="${{ needs.phase1-foundation.outputs.project_dir }}"
          echo "## ðŸŽ¬ Professional News Video Creation Completed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Topic:** ${{ inputs.news_topic }}" >> $GITHUB_STEP_SUMMARY
          echo "**Project:** ${{ inputs.project_name }}" >> $GITHUB_STEP_SUMMARY
          echo "**Duration:** 60 seconds professional news video" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š Workflow Phases Completed" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Phase 1: Information Gathering & Research" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Phase 2: Script & Structure Creation" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Phase 3: Parallel Audio & Image Generation" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Phase 4: Parallel Image Batch 2 & Video Conversion" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Phase 5: Parallel Video Production & BGM Creation" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Phase 6: Video Integration & Concatenation" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Phase 7: Professional Audio Mixing" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Phase 8: Quality Assurance & Final Export" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“ Output Location" >> $GITHUB_STEP_SUMMARY
          echo "All deliverables saved to: \`${PROJECT_DIR}/final/\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŽ¯ Professional Quality Standards Met" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ“º News broadcast quality visuals" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸŽ™ï¸ Professional narrator-style audio (-14LUFS)" >> $GITHUB_STEP_SUMMARY
          echo "- â±ï¸ Optimized 60-second information delivery" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸŽ¨ Consistent professional styling" >> $GITHUB_STEP_SUMMARY
          echo "- ðŸ“Š Multi-source verified information" >> $GITHUB_STEP_SUMMARY