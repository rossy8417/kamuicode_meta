name: "Presentation Slide Creation Workflow"
run-name: "ğŸ“Š Creating presentation: ${{ github.event.inputs.presentation_topic || 'Business Presentation' }}"

on:
  workflow_dispatch:
    inputs:
      presentation_topic:
        description: 'ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ãƒ¼ãƒãƒ»é¡Œæ'
        required: true
        default: 'æ–°å•†å“ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥ã€å››åŠæœŸæ¥­ç¸¾å ±å‘Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆ'
        type: string
      target_audience:
        description: 'å¯¾è±¡è´è¡†'
        required: true
        type: choice
        options:
        - executives
        - management
        - colleagues
        - clients
        - general
        default: 'management'
      presentation_time:
        description: 'ç™ºè¡¨äºˆå®šæ™‚é–“'
        required: true
        type: choice
        options:
        - 5-minutes
        - 10-minutes
        - 15-minutes
        - 30-minutes
        - 45-minutes
        - 60-minutes
        default: '15-minutes'
      slide_count:
        description: 'å¸Œæœ›ã‚¹ãƒ©ã‚¤ãƒ‰æ•° (5-50)'
        required: true
        default: '15'
        type: choice
        options:
        - '5'
        - '10'
        - '15'
        - '20'
        - '25'
        - '30'
        - '35'
        - '40'
        - '45'
        - '50'
      content_type:
        description: 'ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡'
        required: true
        type: choice
        options:
        - proposal
        - report
        - analysis
        - training
        - sales
        - strategy
        default: 'proposal'
      data_visualization_needs:
        description: 'ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã®å¿…è¦æ€§'
        required: true
        type: choice
        options:
        - heavy
        - moderate
        - minimal
        default: 'moderate'
      presentation_style:
        description: 'ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«'
        required: true
        type: choice
        options:
        - corporate
        - modern
        - creative
        - minimalist
        - technical
        default: 'corporate'
      color_preference:
        description: 'ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒï¼ˆä»»æ„ï¼‰'
        required: false
        type: choice
        options:
        - blue
        - green
        - red
        - purple
        - neutral
        - brand
        default: 'blue'
      purpose:
        description: 'ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ç›®çš„ï¼ˆä»»æ„ï¼‰'
        required: false
        default: 'æ–°å•†å“ã®æ‰¿èªã‚’å¾—ã‚‹ã€ãƒãƒ¼ãƒ ã®æ„è­˜çµ±ä¸€ã‚’å›³ã‚‹ã€æŠ•è³‡å®¶ã¸ã®èª¬å¾—'
        type: string

permissions:
  contents: write
  issues: read
  actions: read

env:
  CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

jobs:
  # Phase 1: äº‹å‰ãƒ†ã‚¹ãƒˆæ®µéš
  connectivity-test:
    runs-on: ubuntu-latest
    outputs:
      services_ready: ${{ steps.test.outputs.services_ready }}
      image_generation_available: ${{ steps.test.outputs.image_generation_available }}
    steps:
      - name: Test design and generation services
        id: test
        run: |
          echo "ğŸ“Š Testing design and generation services..."
          
          mkdir -p .logs/connectivity-tests
          
          # Test Claude Code for presentation content generation
          echo "Testing presentation content generation..."
          if timeout 30 claude-code --prompt "Test: Create a simple slide title for testing." > .logs/connectivity-tests/content-test.log 2>&1; then
            CONTENT_GEN_STATUS="success"
            echo "âœ… Content Generation: Available"
          else
            CONTENT_GEN_STATUS="failed"
            echo "âŒ Content Generation: Failed"
          fi
          
          # Test image generation services for slide backgrounds
          echo "Testing image generation for slide backgrounds..."
          if timeout 90 claude-code --mcp-config=.claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-fast --prompt "professional business presentation background, corporate style" > .logs/connectivity-tests/image-test.log 2>&1; then
            IMAGE_GEN_STATUS="success"
            echo "âœ… Image Generation: Available"
          else
            IMAGE_GEN_STATUS="failed"
            echo "âš ï¸ Image Generation: Not available - will use text-only slides"
          fi
          
          # Set outputs
          echo "services_ready=true" >> $GITHUB_OUTPUT
          echo "image_generation_available=$IMAGE_GEN_STATUS" >> $GITHUB_OUTPUT
          
          echo "ğŸ“Š Design services connectivity tests completed"

  # Phase 2: ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³åˆ†ææ®µéš
  presentation-analysis:
    needs: connectivity-test
    runs-on: ubuntu-latest
    outputs:
      analysis_ready: ${{ steps.analyze.outputs.analysis_ready }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Analyze presentation requirements
        id: analyze
        env:
          CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
        run: |
