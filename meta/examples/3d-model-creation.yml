# 3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆ - è¶…è©³ç´°ã‚¿ã‚¹ã‚¯åˆ†è§£
name: "3d-model-creation"
description: "2Dç”»åƒã‹ã‚‰3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆãƒ»æœ€é©åŒ–ãƒ»æ´»ç”¨æº–å‚™ã®å°‚é–€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"
category: "3d-content-generation"
complexity_level: 5
estimated_duration_minutes: 30

# å‹•çš„ãƒ¢ãƒ¼ãƒ€ãƒ«å…¥åŠ›ä»•æ§˜ (Dynamic Modal Input Specification)
dynamic_inputs_spec:
  modal_title: "3Dãƒ¢ãƒ‡ãƒ«åˆ¶ä½œè¨­å®š"
  modal_description: "2Dç”»åƒã‹ã‚‰3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆãƒ»æœ€é©åŒ–ã®è©³ç´°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"
  form_sections:
    - section_name: "3Dãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ã‚»ãƒ—ãƒˆ"
      section_description: "åˆ¶ä½œã™ã‚‹3Dãƒ¢ãƒ‡ãƒ«ã®åŸºæœ¬è¨­è¨ˆ"
      inputs:
        - name: "model_concept"
          label: "3Dãƒ¢ãƒ‡ãƒ«ã‚³ãƒ³ã‚»ãƒ—ãƒˆ"
          type: "textarea"
          required: true
          placeholder: "ä¾‹: å•†å“ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®3Dè¡¨ç¤ºã€å»ºç¯‰ç‰©ã®ç«‹ä½“ãƒ¢ãƒ‡ãƒ«ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ•ã‚£ã‚®ãƒ¥ã‚¢"
          description: "åˆ¶ä½œã—ãŸã„3Dãƒ¢ãƒ‡ãƒ«ã®ç”¨é€”ãƒ»ç›®çš„ãƒ»ç‰¹å¾´ã‚’è©³ç´°ã«è¨˜è¼‰"
          validation:
            min_length: 20
            max_length: 500
        
        - name: "model_type"
          label: "ãƒ¢ãƒ‡ãƒ«ã‚¿ã‚¤ãƒ—"
          type: "select"
          required: true
          options:
            - value: "product"
              label: "ğŸ“¦ è£½å“ãƒ»å•†å“ (ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ»ã‚¢ã‚¤ãƒ†ãƒ )"
            - value: "architectural"
              label: "ğŸ—ï¸ å»ºç¯‰ãƒ»æ§‹é€ ç‰© (å»ºç‰©ãƒ»ã‚¤ãƒ³ãƒ†ãƒªã‚¢)"
            - value: "character"
              label: "ğŸ‘¤ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»äººç‰© (ãƒ•ã‚£ã‚®ãƒ¥ã‚¢ãƒ»ã‚¢ãƒã‚¿ãƒ¼)"
            - value: "mechanical"
              label: "âš™ï¸ æ©Ÿæ¢°ãƒ»å™¨å…· (ãƒ„ãƒ¼ãƒ«ãƒ»è£…ç½®)"
            - value: "organic"
              label: "ğŸŒ¿ æœ‰æ©Ÿç‰©ãƒ»è‡ªç„¶ (æ¤ç‰©ãƒ»å‹•ç‰©ãƒ»åœ°å½¢)"
            - value: "abstract"
              label: "ğŸ¨ æŠ½è±¡ãƒ»ã‚¢ãƒ¼ãƒˆ (ãƒ‡ã‚¶ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)"
          default: "product"
        
        - name: "detail_level"
          label: "è©³ç´°ãƒ¬ãƒ™ãƒ«"
          type: "select"
          required: true
          options:
            - value: "low_poly"
              label: "ğŸ“ ãƒ­ãƒ¼ãƒãƒª (ã‚·ãƒ³ãƒ—ãƒ«ãƒ»é«˜é€Ÿå‡¦ç†)"
            - value: "medium_detail"
              label: "ğŸ¯ ä¸­è©³ç´° (ãƒãƒ©ãƒ³ã‚¹é‡è¦–)"
            - value: "high_detail"
              label: "ğŸ” é«˜è©³ç´° (ãƒªã‚¢ãƒ«ãƒ»é«˜å“è³ª)"
            - value: "ultra_detail"
              label: "ğŸ’ è¶…é«˜è©³ç´° (æœ€é«˜å“è³ªãƒ»é‡ã„)"
          default: "medium_detail"

    - section_name: "ç”Ÿæˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"
      section_description: "3Dç”Ÿæˆã®æŠ€è¡“çš„è¨­å®š"
      inputs:
        - name: "reference_angles"
          label: "å‚ç…§ã‚¢ãƒ³ã‚°ãƒ«æ•°"
          type: "range"
          required: true
          min: 1
          max: 8
          default: 4
          step: 1
          description: "3Dç”Ÿæˆã«ä½¿ç”¨ã™ã‚‹å‚ç…§ç”»åƒã®è§’åº¦æ•° (å¤šã„ã»ã©ç²¾å¯†)"
        
        - name: "model_scale"
          label: "ãƒ¢ãƒ‡ãƒ«ã‚¹ã‚±ãƒ¼ãƒ«"
          type: "select"
          required: true
          options:
            - value: "miniature"
              label: "ğŸ”¬ ãƒŸãƒ‹ãƒãƒ¥ã‚¢ (å°ç‰©ãƒ»ç²¾å¯†)"
            - value: "standard"
              label: "ğŸ“ æ¨™æº– (ä¸€èˆ¬çš„ãªã‚µã‚¤ã‚º)"
            - value: "large_scale"
              label: "ğŸ“ å¤§å‹ (å»ºç¯‰ãƒ»æ™¯è¦³)"
          default: "standard"
        
        - name: "surface_quality"
          label: "è¡¨é¢å“è³ª"
          type: "select"
          required: true
          options:
            - value: "smooth"
              label: "âœ¨ ã‚¹ãƒ ãƒ¼ã‚¹ (æ»‘ã‚‰ã‹ãƒ»ãƒ„ãƒ¤ã‚ã‚Š)"
            - value: "textured"
              label: "ğŸ”² ãƒ†ã‚¯ã‚¹ãƒãƒ£ (è³ªæ„Ÿãƒ»æ¨¡æ§˜ã‚ã‚Š)"
            - value: "rough"
              label: "âš¡ ãƒ©ãƒ• (ç²—ã„ãƒ»ãƒãƒƒãƒˆ)"
            - value: "mixed"
              label: "ğŸ¨ ãƒŸãƒƒã‚¯ã‚¹ (éƒ¨åˆ†çš„ã«ç•°ãªã‚‹è³ªæ„Ÿ)"
          default: "textured"

    - section_name: "å‡ºåŠ›è¨­å®š"
      section_description: "3Dãƒ¢ãƒ‡ãƒ«ã®å‡ºåŠ›å½¢å¼ã¨ç”¨é€”"
      inputs:
        - name: "output_format"
          label: "å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
          type: "select"
          required: true
          options:
            - value: "obj_mtl"
              label: "ğŸ“„ OBJ+MTL (æ±ç”¨ãƒ»è»½é‡)"
            - value: "fbx"
              label: "ğŸ® FBX (ã‚²ãƒ¼ãƒ ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)"
            - value: "gltf"
              label: "ğŸŒ glTF (Webãƒ»AR/VR)"
            - value: "stl"
              label: "ğŸ–¨ï¸ STL (3Dãƒ—ãƒªãƒ³ãƒˆ)"
            - value: "all_formats"
              label: "ğŸ“¦ å…¨å½¢å¼ (è¤‡æ•°å½¢å¼å‡ºåŠ›)"
          default: "obj_mtl"
        
        - name: "optimization_level"
          label: "æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«"
          type: "select"
          required: true
          options:
            - value: "none"
              label: "âšª æœ€é©åŒ–ãªã— (ã‚ªãƒªã‚¸ãƒŠãƒ«å“è³ª)"
            - value: "light"
              label: "ğŸª¶ è»½é‡æœ€é©åŒ– (ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºé‡è¦–)"
            - value: "balanced"
              label: "âš–ï¸ ãƒãƒ©ãƒ³ã‚¹æœ€é©åŒ– (å“è³ªã¨ã‚µã‚¤ã‚ºä¸¡ç«‹)"
            - value: "aggressive"
              label: "ğŸš€ ç©æ¥µçš„æœ€é©åŒ– (æœ€å°ã‚µã‚¤ã‚º)"
          default: "balanced"

# äººé–“ã®ç„¡æ„è­˜æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹
human_process:
  - phase: "concept_visualization"
    description: "æ¦‚å¿µå¯è¦–åŒ–æ®µéšï¼ˆ3DåŒ–å¯¾è±¡ãƒ»ç”¨é€”ãƒ»ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»æŠ€è¡“è¦ä»¶ï¼‰"
  - phase: "reference_preparation"
    description: "å‚ç…§æº–å‚™æ®µéšï¼ˆã‚½ãƒ¼ã‚¹ç”»åƒãƒ»è§’åº¦ãƒ»å“è³ªãƒ»å‰å‡¦ç†ï¼‰"
  - phase: "3d_generation"
    description: "3Dç”Ÿæˆæ®µéšï¼ˆãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆãƒ»ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ»å¹¾ä½•å­¦å‡¦ç†ï¼‰"
  - phase: "model_optimization"
    description: "ãƒ¢ãƒ‡ãƒ«æœ€é©åŒ–æ®µéšï¼ˆãƒˆãƒãƒ­ã‚¸ãƒ¼ãƒ»UVå±•é–‹ãƒ»LODãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰"
  - phase: "rendering_setup"
    description: "ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¨­å®šæ®µéšï¼ˆãƒãƒ†ãƒªã‚¢ãƒ«ãƒ»ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ãƒ»ã‚«ãƒ¡ãƒ©ãƒ»ç’°å¢ƒï¼‰"
  - phase: "delivery_preparation"
    description: "é…ä¿¡æº–å‚™æ®µéšï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ãƒ»æœ€é©åŒ–ãƒ»ç”¨é€”åˆ¥èª¿æ•´ãƒ»å“è³ªç®¡ç†ï¼‰"

# GitHub Actions ãƒãƒ¼ãƒ‰è¨­è¨ˆ
github_actions_config:
  workflow_name: "3D Model Creation Pipeline"
  on_triggers: ["workflow_dispatch", "issues"]
  permissions:
    contents: "write"
    issues: "write"
    actions: "read"
  artifacts_retention_days: 30
  max_parallel_jobs: 3

# è¶…è©³ç´°ã‚¿ã‚¹ã‚¯åˆ†è§£
tasks:
  # === äº‹å‰ãƒ†ã‚¹ãƒˆæ®µéš ===
  - id: "3d-services-connectivity-test"
    name: "3Dç”Ÿæˆãƒ»å‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ"
    phase: "pre_validation"
    github_job: "connectivity-test"
    type: "validation"
    implementation: "mcp"
    duration_minutes: 3
    dependencies: []
    parallel_group: null
    
    github_steps:
      - name: "Test 3D generation and processing services"
        shell: "bash"
        script: |
          echo "ğŸ§Š Testing 3D generation and processing services..."
          
          mkdir -p .logs/connectivity-tests
          
          # 3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆI2I3Dï¼‰
          echo "Testing 3D model generation service..."
          if timeout 180 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp i2i3d-fal-hunyuan3d-v21 --image-path "/tmp/test.jpg" > .logs/connectivity-tests/3d-gen-test.log 2>&1; then
            THREED_GEN_STATUS="success"
            echo "âœ… 3D Model Generation (Hunyuan3D): Available"
          else
            THREED_GEN_STATUS="failed"
            echo "âŒ 3D Model Generation: Failed"
          fi
          
          # ç”»åƒç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆå‚ç…§ç”»åƒä½œæˆç”¨ï¼‰
          echo "Testing image generation for reference creation..."
          if timeout 90 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-fast --prompt "3d reference object test" > .logs/connectivity-tests/ref-image-test.log 2>&1; then
            REF_IMAGE_STATUS="success"
            echo "âœ… Reference Image Generation: Available"
          else
            REF_IMAGE_STATUS="failed"
            echo "âš ï¸ Reference Image Generation: Not available"
          fi
          
          # ç”»åƒå¼·åŒ–ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆ3Dç”Ÿæˆå‰ã®å‰å‡¦ç†ç”¨ï¼‰
          echo "Testing image enhancement for preprocessing..."
          if timeout 60 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp i2i-fal-flux-kontext-max --image-path "/tmp/test.jpg" --enhancement "3d reference optimization" > .logs/connectivity-tests/enhancement-test.log 2>&1; then
            IMAGE_ENHANCEMENT_STATUS="success" 
            echo "âœ… Image Enhancement: Available"
          else
            IMAGE_ENHANCEMENT_STATUS="failed"
            echo "âš ï¸ Image Enhancement: Not available"
          fi
          
          # Claude Code AI ãƒ†ã‚¹ãƒˆï¼ˆ3Dåˆ†æãƒ»æœ€é©åŒ–ç”¨ï¼‰
          echo "Testing Claude Code for 3D analysis..."
          if timeout 30 claude-code --prompt "Test: Analyze 3D modeling requirements for a simple cube and return '3D_AI_TEST_SUCCESS' if working." > .logs/connectivity-tests/3d-ai-test.log 2>&1; then
            if grep -q "3D_AI_TEST_SUCCESS" .logs/connectivity-tests/3d-ai-test.log; then
              THREED_AI_STATUS="success"
              echo "âœ… 3D AI Analysis: Available"
            else
              THREED_AI_STATUS="partial"
              echo "âš ï¸ 3D AI Analysis: Partial response"
            fi
          else
            THREED_AI_STATUS="failed"
            echo "âŒ 3D AI Analysis: Failed"
          fi
          
          # å¤–éƒ¨3Då‡¦ç†API ãƒ†ã‚¹ãƒˆ
          echo "Testing external 3D processing APIs..."
          if [ -n "${{ secrets.SKETCHFAB_API_KEY }}" ]; then
            if timeout 30 curl -s -H "Authorization: Token ${{ secrets.SKETCHFAB_API_KEY }}" "https://api.sketchfab.com/v3/me" > .logs/connectivity-tests/sketchfab-test.log 2>&1; then
              THREED_API_STATUS="success"
              echo "âœ… 3D Platform API: Available"
            else
              THREED_API_STATUS="failed"
              echo "âš ï¸ 3D Platform API: Failed"
            fi
          else
            THREED_API_STATUS="not_configured"
            echo "â„¹ï¸ 3D Platform API: Not configured"
          fi
          
          # 3Då‡¦ç†ãƒ„ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
          echo "Testing 3D processing tools..."
          if command -v blender &> /dev/null; then
            if timeout 10 blender --version > .logs/connectivity-tests/blender-test.log 2>&1; then
              THREED_TOOLS_STATUS="success"
              echo "âœ… 3D Processing Tools: Available"
            else
              THREED_TOOLS_STATUS="limited"
              echo "âš ï¸ 3D Tools: Limited functionality"
            fi
          else
            THREED_TOOLS_STATUS="not_available" 
            echo "â„¹ï¸ 3D Processing Tools: Not installed"
          fi
          
          # 3Dåˆ¶ä½œèƒ½åŠ›ã®è©•ä¾¡
          BASIC_3D_CAPABILITY="none"
          ADVANCED_3D_CAPABILITY="none"
          
          # åŸºæœ¬æ©Ÿèƒ½ï¼ˆ3Dç”Ÿæˆã¾ãŸã¯AIåˆ†æï¼‰
          if [ "$THREED_GEN_STATUS" = "success" ] || [ "$THREED_AI_STATUS" = "success" ]; then
            BASIC_3D_CAPABILITY="available"
          fi
          
          # é«˜åº¦æ©Ÿèƒ½ï¼ˆ3Dç”Ÿæˆ+å¼·åŒ–+åˆ†æï¼‰
          if [ "$THREED_GEN_STATUS" = "success" ] && [ "$IMAGE_ENHANCEMENT_STATUS" = "success" ] && [ "$THREED_AI_STATUS" = "success" ]; then
            ADVANCED_3D_CAPABILITY="available"
          fi
          
          # ãƒ†ã‚¹ãƒˆçµæœã‚’JSONä¿å­˜
          cat > .logs/connectivity-tests/test-results.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "3d_services": {
              "3d_model_generation": "$THREED_GEN_STATUS",
              "reference_image_generation": "$REF_IMAGE_STATUS",
              "image_enhancement": "$IMAGE_ENHANCEMENT_STATUS",
              "3d_ai_analysis": "$THREED_AI_STATUS",
              "3d_platform_api": "$THREED_API_STATUS",
              "3d_processing_tools": "$THREED_TOOLS_STATUS"
            },
            "capability_assessment": {
              "basic_3d_capability": "$BASIC_3D_CAPABILITY",
              "advanced_3d_capability": "$ADVANCED_3D_CAPABILITY",
              "workflow_can_proceed": $([ "$BASIC_3D_CAPABILITY" = "available" ] && echo "true" || echo "false"),
              "professional_3d_production": $([ "$ADVANCED_3D_CAPABILITY" = "available" ] && echo "true" || echo "false")
            },
            "service_priorities": {
              "primary_3d_service": "$([ "$THREED_GEN_STATUS" = "success" ] && echo "i2i3d-fal-hunyuan3d-v21" || echo "none")",
              "image_preprocessing": "$([ "$IMAGE_ENHANCEMENT_STATUS" = "success" ] && echo "i2i-fal-flux-kontext-max" || echo "none")",
              "reference_creation": "$([ "$REF_IMAGE_STATUS" = "success" ] && echo "t2i-fal-imagen4-fast" || echo "none")"
            }
          }
          EOF
          
          # ç’°å¢ƒå¤‰æ•°ã«çµæœã‚’è¨­å®š
          echo "BASIC_3D_CAPABILITY=$BASIC_3D_CAPABILITY" >> $GITHUB_ENV
          echo "ADVANCED_3D_CAPABILITY=$ADVANCED_3D_CAPABILITY" >> $GITHUB_ENV
          echo "THREED_GEN_AVAILABLE=$([ "$THREED_GEN_STATUS" = "success" ] && echo "true" || echo "false")" >> $GITHUB_ENV
          echo "IMAGE_ENHANCEMENT_AVAILABLE=$([ "$IMAGE_ENHANCEMENT_STATUS" = "success" ] && echo "true" || echo "false")" >> $GITHUB_ENV
          echo "REF_IMAGE_AVAILABLE=$([ "$REF_IMAGE_STATUS" = "success" ] && echo "true" || echo "false")" >> $GITHUB_ENV
          echo "THREED_AI_AVAILABLE=$([ "$THREED_AI_STATUS" = "success" ] && echo "true" || echo "false")" >> $GITHUB_ENV
          
          echo "ğŸ§Š 3D services connectivity tests completed"
          echo "Basic capability: $BASIC_3D_CAPABILITY"
          echo "Advanced capability: $ADVANCED_3D_CAPABILITY"
          
    validation:
      criteria:
        - "åŸºæœ¬çš„ãª3Dç”Ÿæˆæ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½"
        - "ãƒ†ã‚¹ãƒˆçµæœãŒJSONå½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã‚‹"
      validation_script: |
        if [ ! -f ".logs/connectivity-tests/test-results.json" ]; then
          echo "âŒ VALIDATION FAILED: Test results missing"
          exit 1
        fi
        
        WORKFLOW_CAN_PROCEED=$(jq -r '.capability_assessment.workflow_can_proceed' .logs/connectivity-tests/test-results.json)
        if [ "$WORKFLOW_CAN_PROCEED" = "true" ]; then
          echo "âœ… Validation passed: 3D production services ready"
        else
          echo "âŒ VALIDATION FAILED: Critical 3D services unavailable"
          exit 1
        fi

  # === æ¦‚å¿µå¯è¦–åŒ–æ®µéš ===
  - id: "3d-concept-development"
    name: "3Dãƒ¢ãƒ‡ãƒ«æ¦‚å¿µãƒ»ä»•æ§˜è¨­è¨ˆ"
    phase: "concept_visualization"
    github_job: "concept-development"
    type: "planning"
    implementation: "ai"
    duration_minutes: 4
    dependencies: ["3d-services-connectivity-test"]
    parallel_group: null
    
    github_steps:
      - name: "Develop 3D model concept and specifications"
        shell: "bash"
        script: |
          echo "ğŸ¯ Developing 3D model concept and specifications..."
          
          mkdir -p .logs/3d-concept
          
          # å…¥åŠ›ã‹ã‚‰3Dè¦ä»¶ã‚’æŠ½å‡º
          MODEL_SUBJECT="${{ github.event.inputs.model_subject || github.event.issue.title || 'Product Design Object' }}"
          MODEL_STYLE="${{ github.event.inputs.model_style || 'realistic' }}"
          INTENDED_USE="${{ github.event.inputs.intended_use || 'product visualization' }}"
          COMPLEXITY_LEVEL="${{ github.event.inputs.complexity_level || 'medium' }}"
          TARGET_QUALITY="${{ github.event.inputs.target_quality || 'high' }}"
          PLATFORM_TARGET="${{ github.event.inputs.platform_target || 'web and mobile' }}"
          
          echo "Model subject: $MODEL_SUBJECT"
          echo "Style: $MODEL_STYLE"
          echo "Intended use: $INTENDED_USE"
          echo "Complexity: $COMPLEXITY_LEVEL"
          echo "Quality target: $TARGET_QUALITY"
          echo "Platform: $PLATFORM_TARGET"
          
          # Claude Code ã§3Dã‚³ãƒ³ã‚»ãƒ—ãƒˆè¨­è¨ˆ
          claude-code --prompt "ä»¥ä¸‹ã®è¦ä»¶ã«åŸºã¥ã„ã¦ã€3Dãƒ¢ãƒ‡ãƒ«åˆ¶ä½œã®è©³ç´°ãªã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨æŠ€è¡“ä»•æ§˜ã‚’è¨­è¨ˆã—ã¦ãã ã•ã„ï¼š
          
          ãƒ¢ãƒ‡ãƒ«å¯¾è±¡: $MODEL_SUBJECT
          ã‚¹ã‚¿ã‚¤ãƒ«: $MODEL_STYLE
          ç”¨é€”: $INTENDED_USE
          è¤‡é›‘åº¦: $COMPLEXITY_LEVEL
          å“è³ªç›®æ¨™: $TARGET_QUALITY
          å¯¾è±¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ : $PLATFORM_TARGET
          
          ä»¥ä¸‹ã®å½¢å¼ã§JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
          {
            \"3d_concept\": {
              \"primary_subject\": \"ä¸»è¦å¯¾è±¡ç‰©\",
              \"conceptual_approach\": \"ã‚³ãƒ³ã‚»ãƒ—ãƒãƒ¥ã‚¢ãƒ«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ\",
              \"visual_style\": \"ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«è©³ç´°\",
              \"artistic_direction\": \"ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒ†ã‚£ãƒƒã‚¯æ–¹å‘æ€§\",
              \"unique_characteristics\": [\"ç‹¬è‡ªç‰¹å¾´ãƒ»å€‹æ€§\"],
              \"reference_inspirations\": [\"å‚è€ƒãƒ»ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æº\"]
            },
            \"technical_specifications\": {
              \"geometry_complexity\": \"å¹¾ä½•å­¦çš„è¤‡é›‘åº¦\",
              \"polygon_budget\": \"ãƒãƒªã‚´ãƒ³äºˆç®—ç›®å®‰\",
              \"texture_resolution\": \"ãƒ†ã‚¯ã‚¹ãƒãƒ£è§£åƒåº¦ç›®æ¨™\",
              \"material_complexity\": \"ãƒãƒ†ãƒªã‚¢ãƒ«è¤‡é›‘åº¦\",
              \"animation_requirements\": \"ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶\",
              \"optimization_priorities\": [\"æœ€é©åŒ–å„ªå…ˆåº¦\"]
            },
            \"dimensional_specifications\": {
              \"primary_proportions\": \"ä¸»è¦ãƒ—ãƒ­ãƒãƒ¼ã‚·ãƒ§ãƒ³\",
              \"scale_considerations\": \"ã‚¹ã‚±ãƒ¼ãƒ«é…æ…®äº‹é …\",
              \"viewing_angles\": [\"é‡è¦è¦–ç‚¹è§’åº¦\"],
              \"detail_hierarchy\": \"è©³ç´°éšå±¤\",
              \"geometric_features\": [\"å¹¾ä½•å­¦çš„ç‰¹å¾´\"]
            },
            \"material_design\": {
              \"surface_characteristics\": [\"è¡¨é¢ç‰¹æ€§\"],
              \"texture_types\": [\"ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚¿ã‚¤ãƒ—\"],
              \"material_properties\": [\"ãƒãƒ†ãƒªã‚¢ãƒ«ç‰¹æ€§\"],
              \"lighting_response\": \"ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°å¿œç­”\",
              \"environmental_interaction\": \"ç’°å¢ƒç›¸äº’ä½œç”¨\"
            },
            \"use_case_optimization\": {
              \"platform_requirements\": [\"ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ è¦ä»¶\"],
              \"performance_targets\": [\"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™\"],
              \"viewing_contexts\": [\"è¦–è´ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ\"],
              \"interaction_methods\": [\"ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ–¹æ³•\"],
              \"accessibility_considerations\": [\"ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£é…æ…®\"]
            },
            \"production_strategy\": {
              \"reference_image_requirements\": [\"å‚ç…§ç”»åƒè¦ä»¶\"],
              \"generation_approach\": \"ç”Ÿæˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ\",
              \"quality_validation\": \"å“è³ªæ¤œè¨¼æ–¹é‡\",
              \"optimization_workflow\": \"æœ€é©åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\",
              \"delivery_formats\": [\"é…ä¿¡ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\"]
            },
            \"quality_benchmarks\": {
              \"visual_fidelity\": \"è¦–è¦šçš„å¿ å®Ÿåº¦åŸºæº–\",
              \"technical_accuracy\": \"æŠ€è¡“çš„ç²¾åº¦åŸºæº–\",
              \"performance_efficiency\": \"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ¹ç‡åŸºæº–\",
              \"user_experience\": \"ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“åŸºæº–\",
              \"commercial_viability\": \"å•†ç”¨å¯èƒ½æ€§åŸºæº–\"
            }
          }" > .logs/3d-concept/3d-concept.json
          
          THREED_CONCEPT=$(cat .logs/3d-concept/3d-concept.json)
          echo "THREED_CONCEPT_FILE=.logs/3d-concept/3d-concept.json" >> $GITHUB_ENV
          
          # ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š
          POLYGON_BUDGET=$(echo "$THREED_CONCEPT" | jq -r '.technical_specifications.polygon_budget' | sed 's/[^0-9]//g')
          TEXTURE_RESOLUTION=$(echo "$THREED_CONCEPT" | jq -r '.technical_specifications.texture_resolution' | sed 's/[^0-9]//g')
          
          echo "POLYGON_BUDGET=${POLYGON_BUDGET:-10000}" >> $GITHUB_ENV
          echo "TEXTURE_RESOLUTION=${TEXTURE_RESOLUTION:-1024}" >> $GITHUB_ENV
          
          echo "ğŸ¯ 3D concept development completed"
          echo "Polygon budget: ${POLYGON_BUDGET:-10000}"
          echo "Texture resolution: ${TEXTURE_RESOLUTION:-1024}px"

  # === å‚ç…§æº–å‚™æ®µéš ===
  - id: "reference-image-preparation"
    name: "å‚ç…§ç”»åƒç”Ÿæˆãƒ»å‰å‡¦ç†"
    phase: "reference_preparation"
    github_job: "reference-preparation"
    type: "generation"
    implementation: "mcp"
    tool: "image-generation"
    duration_minutes: 5
    dependencies: ["3d-concept-development"]
    parallel_group: null
    
    github_steps:
      - name: "Generate and prepare reference images"
        shell: "bash"
        script: |
          echo "ğŸ–¼ï¸ Generating and preparing reference images..."
          
          mkdir -p .logs/reference-preparation
          
          THREED_CONCEPT=$(cat .logs/3d-concept/3d-concept.json)
          
          # å‚ç…§ç”»åƒè¦ä»¶ã®æŠ½å‡º
          REFERENCE_REQUIREMENTS=$(echo "$THREED_CONCEPT" | jq -r '.production_strategy.reference_image_requirements[]' | head -5)
          PRIMARY_SUBJECT=$(echo "$THREED_CONCEPT" | jq -r '.3d_concept.primary_subject')
          VISUAL_STYLE=$(echo "$THREED_CONCEPT" | jq -r '.3d_concept.visual_style')
          
          if [ "$REF_IMAGE_AVAILABLE" = "true" ]; then
            echo "Reference image generation service available - creating reference images..."
            
            # ãƒ¡ã‚¤ãƒ³å‚ç…§ç”»åƒã®ç”Ÿæˆ
            echo "Generating primary reference image..."
            PRIMARY_PROMPT="$PRIMARY_SUBJECT in $VISUAL_STYLE style, perfect for 3D modeling reference, clear details, neutral background, professional product photography lighting, high resolution, multiple angles visible"
            
            if timeout 120 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-fast --prompt "$PRIMARY_PROMPT" > .logs/reference-preparation/primary-reference.json 2>&1; then
              echo "âœ… Primary reference image generated"
              PRIMARY_REF_STATUS="success"
            else
              echo "âŒ Primary reference generation failed"
              PRIMARY_REF_STATUS="failed"
            fi
            
            # å¤šè§’åº¦å‚ç…§ç”»åƒã®ç”Ÿæˆ
            VIEWING_ANGLES=$(echo "$THREED_CONCEPT" | jq -r '.dimensional_specifications.viewing_angles[]')
            ANGLE_INDEX=0
            
            while IFS= read -r angle; do
              if [ -n "$angle" ] && [ "$angle" != "null" ]; then
                echo "Generating reference for $angle view..."
                ANGLE_PROMPT="$PRIMARY_SUBJECT from $angle view, $VISUAL_STYLE style, 3D modeling reference, clear geometry, neutral background, professional lighting"
                
                if timeout 90 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-fast --prompt "$ANGLE_PROMPT" > .logs/reference-preparation/angle-${ANGLE_INDEX}-reference.json 2>&1; then
                  echo "âœ… $angle reference generated"
                else
                  echo "âš ï¸ $angle reference generation failed"
                fi
                
                ANGLE_INDEX=$((ANGLE_INDEX + 1))
              fi
            done <<< "$VIEWING_ANGLES"
            
            # è©³ç´°ç‰¹å¾´å‚ç…§ç”»åƒã®ç”Ÿæˆ
            GEOMETRIC_FEATURES=$(echo "$THREED_CONCEPT" | jq -r '.dimensional_specifications.geometric_features[]')
            FEATURE_INDEX=0
            
            while IFS= read -r feature; do
              if [ -n "$feature" ] && [ "$feature" != "null" ] && [ $FEATURE_INDEX -lt 3 ]; then
                echo "Generating detail reference for: $feature"
                FEATURE_PROMPT="close-up detail of $feature on $PRIMARY_SUBJECT, $VISUAL_STYLE style, high detail for 3D modeling, clear texture and geometry"
                
                if timeout 90 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp t2i-fal-imagen4-fast --prompt "$FEATURE_PROMPT" > .logs/reference-preparation/feature-${FEATURE_INDEX}-detail.json 2>&1; then
                  echo "âœ… $feature detail reference generated"
                else
                  echo "âš ï¸ $feature detail reference failed"
                fi
                
                FEATURE_INDEX=$((FEATURE_INDEX + 1))
              fi
            done <<< "$GEOMETRIC_FEATURES"
            
          else
            echo "âš ï¸ Reference image generation not available"
            PRIMARY_REF_STATUS="service_unavailable"
          fi
          
          # ç”Ÿæˆã•ã‚ŒãŸå‚ç…§ç”»åƒã®å‰å‡¦ç†ãƒ»æœ€é©åŒ–
          if [ "$IMAGE_ENHANCEMENT_AVAILABLE" = "true" ] && [ "$PRIMARY_REF_STATUS" = "success" ]; then
            echo "Enhancing reference images for optimal 3D generation..."
            
            for ref_file in .logs/reference-preparation/*.json; do
              if [ -f "$ref_file" ]; then
                REF_NAME=$(basename "$ref_file" .json)
                IMAGE_PATH=$(jq -r '.image_url // .file_path // "none"' "$ref_file" 2>/dev/null)
                
                if [ "$IMAGE_PATH" != "none" ]; then
                  echo "Enhancing $REF_NAME for 3D generation..."
                  ENHANCEMENT_PROMPT="optimize for 3D model generation, enhance edge definition, improve contrast, clarify geometric details, maintain color accuracy"
                  
                  if timeout 90 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp i2i-fal-flux-kontext-max --image-path "$IMAGE_PATH" --enhancement "$ENHANCEMENT_PROMPT" > .logs/reference-preparation/${REF_NAME}-enhanced.json 2>&1; then
                    echo "âœ… $REF_NAME enhanced successfully"
                  else
                    echo "âš ï¸ $REF_NAME enhancement failed"
                  fi
                fi
              fi
            done
          fi
          
          # å‚ç…§ç”»åƒæº–å‚™çµæœã®çµ±è¨ˆ
          GENERATED_REF_COUNT=$(ls .logs/reference-preparation/*.json 2>/dev/null | wc -l)
          ENHANCED_COUNT=$(ls .logs/reference-preparation/*-enhanced.json 2>/dev/null | wc -l)
          
          # å‚ç…§æº–å‚™ãƒ­ã‚°
          cat > .logs/reference-preparation/preparation-log.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "reference_preparation_summary": {
              "primary_reference_status": "$PRIMARY_REF_STATUS",
              "total_reference_images": $GENERATED_REF_COUNT,
              "enhanced_images": $ENHANCED_COUNT,
              "reference_generation_available": "$REF_IMAGE_AVAILABLE",
              "enhancement_available": "$IMAGE_ENHANCEMENT_AVAILABLE"
            },
            "reference_types": {
              "primary_reference": "$([ "$PRIMARY_REF_STATUS" = "success" ] && echo "generated" || echo "unavailable")",
              "angle_references": "$([ $GENERATED_REF_COUNT -gt 1 ] && echo "multiple_angles" || echo "single_view")",
              "detail_references": "$([ $GENERATED_REF_COUNT -gt 3 ] && echo "feature_details" || echo "basic_only")"
            },
            "generated_assets": [$(ls .logs/reference-preparation/*.json 2>/dev/null | sed 's/.*/"&"/' | paste -sd,)]
          }
          EOF
          
          echo "REFERENCE_PREPARATION_STATUS=$PRIMARY_REF_STATUS" >> $GITHUB_ENV
          echo "GENERATED_REF_COUNT=$GENERATED_REF_COUNT" >> $GITHUB_ENV
          echo "ENHANCED_REF_COUNT=$ENHANCED_COUNT" >> $GITHUB_ENV
          
          echo "ğŸ–¼ï¸ Reference image preparation completed: $GENERATED_REF_COUNT images"

  # === 3Dç”Ÿæˆæ®µéš ===
  - id: "primary-3d-model-generation"
    name: "ãƒ¡ã‚¤ãƒ³3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆ"
    phase: "3d_generation"
    github_job: "3d-generation"
    type: "generation"
    implementation: "mcp"
    tool: "3d-generation"
    duration_minutes: 8
    dependencies: ["reference-image-preparation"]
    parallel_group: null
    
    github_steps:
      - name: "Generate primary 3D models"
        shell: "bash"
        script: |
          echo "ğŸ§Š Generating primary 3D models..."
          
          mkdir -p .logs/3d-generation
          
          THREED_CONCEPT=$(cat .logs/3d-concept/3d-concept.json)
          REFERENCE_LOG=$(cat .logs/reference-preparation/preparation-log.json)
          
          if [ "$THREED_GEN_AVAILABLE" = "true" ]; then
            echo "3D model generation service available - creating models..."
            
            # ãƒ—ãƒ©ã‚¤ãƒãƒªå‚ç…§ç”»åƒã‹ã‚‰3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆ
            PRIMARY_REF_FILE=$(ls .logs/reference-preparation/primary-reference*.json 2>/dev/null | head -1)
            
            if [ -n "$PRIMARY_REF_FILE" ]; then
              PRIMARY_IMAGE_PATH=$(jq -r '.image_url // .file_path // "none"' "$PRIMARY_REF_FILE" 2>/dev/null)
              
              if [ "$PRIMARY_IMAGE_PATH" != "none" ]; then
                echo "Generating 3D model from primary reference..."
                
                if timeout 240 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp i2i3d-fal-hunyuan3d-v21 --image-path "$PRIMARY_IMAGE_PATH" > .logs/3d-generation/primary-3d-model.json 2>&1; then
                  echo "âœ… Primary 3D model generated successfully"
                  PRIMARY_3D_STATUS="success"
                else
                  echo "âŒ Primary 3D model generation failed"
                  PRIMARY_3D_STATUS="failed"
                fi
              else
                echo "âš ï¸ Primary reference image path not found"
                PRIMARY_3D_STATUS="no_reference"
              fi
            else
              echo "âš ï¸ No primary reference image available"
              PRIMARY_3D_STATUS="no_reference"
            fi
            
            # å¼·åŒ–ã•ã‚ŒãŸå‚ç…§ç”»åƒã‹ã‚‰3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆï¼ˆã‚ˆã‚Šé«˜å“è³ªï¼‰
            ENHANCED_REF_FILE=$(ls .logs/reference-preparation/primary-reference-enhanced.json 2>/dev/null | head -1)
            
            if [ -n "$ENHANCED_REF_FILE" ]; then
              ENHANCED_IMAGE_PATH=$(jq -r '.image_url // .file_path // "none"' "$ENHANCED_REF_FILE" 2>/dev/null)
              
              if [ "$ENHANCED_IMAGE_PATH" != "none" ]; then
                echo "Generating enhanced 3D model from optimized reference..."
                
                if timeout 240 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp i2i3d-fal-hunyuan3d-v21 --image-path "$ENHANCED_IMAGE_PATH" > .logs/3d-generation/enhanced-3d-model.json 2>&1; then
                  echo "âœ… Enhanced 3D model generated successfully"
                  ENHANCED_3D_STATUS="success"
                else
                  echo "âš ï¸ Enhanced 3D model generation failed"
                  ENHANCED_3D_STATUS="failed"
                fi
              fi
            else
              ENHANCED_3D_STATUS="no_enhanced_reference"
            fi
            
            # å¤šè§’åº¦å‚ç…§ã‹ã‚‰ã®3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆï¼ˆãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            echo "Generating angle-specific 3D models..."
            ANGLE_3D_COUNT=0
            
            for angle_file in .logs/reference-preparation/angle-*-reference.json; do
              if [ -f "$angle_file" ] && [ $ANGLE_3D_COUNT -lt 3 ]; then
                ANGLE_NAME=$(basename "$angle_file" .json)
                ANGLE_IMAGE_PATH=$(jq -r '.image_url // .file_path // "none"' "$angle_file" 2>/dev/null)
                
                if [ "$ANGLE_IMAGE_PATH" != "none" ]; then
                  echo "Generating 3D model from $ANGLE_NAME..."
                  
                  if timeout 180 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp i2i3d-fal-hunyuan3d-v21 --image-path "$ANGLE_IMAGE_PATH" > .logs/3d-generation/${ANGLE_NAME}-3d-model.json 2>&1; then
                    echo "âœ… $ANGLE_NAME 3D model generated"
                    ANGLE_3D_COUNT=$((ANGLE_3D_COUNT + 1))
                  else
                    echo "âš ï¸ $ANGLE_NAME 3D model generation failed"
                  fi
                fi
              fi
            done
            
            # è©³ç´°ç‰¹å¾´ã‹ã‚‰ã®3Dãƒ¢ãƒ‡ãƒ«ç”Ÿæˆï¼ˆè©³ç´°ãƒ‘ãƒ¼ãƒ„ï¼‰
            echo "Generating detail-specific 3D models..."
            DETAIL_3D_COUNT=0
            
            for detail_file in .logs/reference-preparation/feature-*-detail.json; do
              if [ -f "$detail_file" ] && [ $DETAIL_3D_COUNT -lt 2 ]; then
                DETAIL_NAME=$(basename "$detail_file" .json)
                DETAIL_IMAGE_PATH=$(jq -r '.image_url // .file_path // "none"' "$detail_file" 2>/dev/null)
                
                if [ "$DETAIL_IMAGE_PATH" != "none" ]; then
                  echo "Generating detail 3D model from $DETAIL_NAME..."
                  
                  if timeout 150 claude-code --mcp-config=~/.claude/mcp-kamuicode.json --mcp i2i3d-fal-hunyuan3d-v21 --image-path "$DETAIL_IMAGE_PATH" > .logs/3d-generation/${DETAIL_NAME}-3d-model.json 2>&1; then
                    echo "âœ… $DETAIL_NAME detail 3D model generated"
                    DETAIL_3D_COUNT=$((DETAIL_3D_COUNT + 1))
                  else
                    echo "âš ï¸ $DETAIL_NAME detail 3D model generation failed"
                  fi
                fi
              fi
            done
            
          else
            echo "âš ï¸ 3D model generation service not available"
            PRIMARY_3D_STATUS="service_unavailable"
            
            # ä»£æ›¿æ¡ˆã®æç¤º
            cat > .logs/3d-generation/3d-alternatives.json << EOF
            {
              "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
              "3d_service_status": "unavailable",
              "alternative_approaches": [
                "Use external 3D modeling software (Blender, Maya, etc.)",
                "Employ photogrammetry techniques",
                "Manual 3D modeling based on reference images",
                "Use AI-powered desktop 3D generation tools",
                "Outsource to 3D modeling professionals"
              ],
              "reference_specifications": $(cat .logs/3d-concept/3d-concept.json | jq '.production_strategy'),
              "recommended_workflow": [
                "Export reference images and specifications",
                "Create detailed modeling guidelines",
                "Set up quality validation criteria",
                "Establish optimization parameters"
              ]
            }
            EOF
          fi
          
          # 3Dç”Ÿæˆçµæœã®çµ±è¨ˆ
          GENERATED_3D_COUNT=$(ls .logs/3d-generation/*.json 2>/dev/null | wc -l)
          
          # 3Dç”Ÿæˆãƒ­ã‚°
          cat > .logs/3d-generation/generation-log.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "3d_generation_summary": {
              "primary_3d_status": "$PRIMARY_3D_STATUS",
              "enhanced_3d_status": "${ENHANCED_3D_STATUS:-not_attempted}",
              "total_3d_models_generated": $GENERATED_3D_COUNT,
              "angle_variants": $ANGLE_3D_COUNT,
              "detail_models": $DETAIL_3D_COUNT,
              "generation_service_used": "$([ "$THREED_GEN_AVAILABLE" = "true" ] && echo "i2i3d-fal-hunyuan3d-v21" || echo "none")"
            },
            "model_types": {
              "primary_model": "$([ "$PRIMARY_3D_STATUS" = "success" ] && echo "generated" || echo "unavailable")",
              "enhanced_model": "$([ "$ENHANCED_3D_STATUS" = "success" ] && echo "generated" || echo "unavailable")",
              "angle_variants": "$ANGLE_3D_COUNT models",
              "detail_models": "$DETAIL_3D_COUNT models"
            },
            "generated_assets": [$(ls .logs/3d-generation/*.json 2>/dev/null | sed 's/.*/"&"/' | paste -sd,)]
          }
          EOF
          
          echo "THREED_GENERATION_STATUS=$PRIMARY_3D_STATUS" >> $GITHUB_ENV
          echo "GENERATED_3D_COUNT=$GENERATED_3D_COUNT" >> $GITHUB_ENV
          echo "ANGLE_3D_VARIANTS=$ANGLE_3D_COUNT" >> $GITHUB_ENV
          echo "DETAIL_3D_MODELS=$DETAIL_3D_COUNT" >> $GITHUB_ENV
          
          echo "ğŸ§Š Primary 3D model generation completed: $GENERATED_3D_COUNT models"

  # === ãƒ¢ãƒ‡ãƒ«æœ€é©åŒ–æ®µéš ===
  - id: "3d-model-optimization"
    name: "3Dãƒ¢ãƒ‡ãƒ«æœ€é©åŒ–ãƒ»å“è³ªå‘ä¸Š"
    phase: "model_optimization"
    github_job: "model-optimization"
    type: "optimization"
    implementation: "ai"
    duration_minutes: 5
    dependencies: ["primary-3d-model-generation"]
    parallel_group: null
    
    github_steps:
      - name: "Optimize 3D models for performance and quality"
        shell: "bash"
        script: |
          echo "âš¡ Optimizing 3D models for performance and quality..."
          
          mkdir -p .logs/model-optimization
          
          THREED_CONCEPT=$(cat .logs/3d-concept/3d-concept.json)
          GENERATION_LOG=$(cat .logs/3d-generation/generation-log.json)
          
          # 3Dæœ€é©åŒ–åˆ†æ
          claude-code --prompt "ä»¥ä¸‹ã®3Dç”Ÿæˆçµæœã‚’åŸºã«ã€ãƒ¢ãƒ‡ãƒ«æœ€é©åŒ–ã¨å“è³ªå‘ä¸Šã®è©³ç´°åˆ†æã‚’è¡Œã£ã¦ãã ã•ã„ï¼š
          
          3Dã‚³ãƒ³ã‚»ãƒ—ãƒˆ: $THREED_CONCEPT
          ç”Ÿæˆãƒ­ã‚°: $GENERATION_LOG
          
          ä»¥ä¸‹ã®å½¢å¼ã§JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
          {
            \"optimization_analysis\": {
              \"current_model_quality\": {
                \"geometric_accuracy\": \"å¹¾ä½•å­¦çš„ç²¾åº¦è©•ä¾¡ï¼ˆ1-10ç‚¹ï¼‰\",
                \"topology_quality\": \"ãƒˆãƒãƒ­ã‚¸ãƒ¼å“è³ªè©•ä¾¡ï¼ˆ1-10ç‚¹ï¼‰\",
                \"texture_fidelity\": \"ãƒ†ã‚¯ã‚¹ãƒãƒ£å¿ å®Ÿåº¦è©•ä¾¡ï¼ˆ1-10ç‚¹ï¼‰\",
                \"detail_preservation\": \"è©³ç´°ä¿æŒè©•ä¾¡ï¼ˆ1-10ç‚¹ï¼‰\",
                \"overall_quality_score\": \"ç·åˆå“è³ªã‚¹ã‚³ã‚¢ï¼ˆ1-10ç‚¹ï¼‰\"
              },
              \"performance_metrics\": {
                \"estimated_polygon_count\": \"æ¨å®šãƒãƒªã‚´ãƒ³æ•°\",
                \"texture_memory_usage\": \"ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡\",
                \"rendering_complexity\": \"ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¤‡é›‘åº¦\",
                \"mobile_compatibility\": \"ãƒ¢ãƒã‚¤ãƒ«äº’æ›æ€§\",
                \"web_performance\": \"Web ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹\"
              }
            },
            \"optimization_recommendations\": [
              {
                \"optimization_type\": \"geometry|texture|material|performance|quality\",
                \"target_models\": [\"å¯¾è±¡ãƒ¢ãƒ‡ãƒ«\"],
                \"specific_improvements\": \"å…·ä½“çš„æ”¹å–„å†…å®¹\",
                \"technical_approach\": \"æŠ€è¡“çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ\",
                \"expected_benefits\": \"æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ\",
                \"implementation_priority\": \"high|medium|low\"
              }
            ],
            \"lod_strategy\": {
              \"lod_levels_needed\": \"å¿…è¦LODãƒ¬ãƒ™ãƒ«æ•°\",
              \"lod_specifications\": [
                {
                  \"lod_level\": \"LODãƒ¬ãƒ™ãƒ«\",
                  \"polygon_reduction\": \"ãƒãƒªã‚´ãƒ³å‰Šæ¸›ç‡\",
                  \"viewing_distance\": \"è¦–è·é›¢\",
                  \"quality_threshold\": \"å“è³ªé–¾å€¤\",
                  \"use_cases\": [\"ä½¿ç”¨å ´é¢\"]
                }
              ],
              \"automatic_lod_generation\": \"è‡ªå‹•LODç”Ÿæˆå¯èƒ½æ€§\"
            },
            \"texture_optimization\": {
              \"texture_atlas_strategy\": \"ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚¢ãƒˆãƒ©ã‚¹æˆ¦ç•¥\",
              \"compression_recommendations\": [\"åœ§ç¸®æ¨å¥¨äº‹é …\"],
              \"resolution_targets\": \"è§£åƒåº¦ç›®æ¨™è¨­å®š\",
              \"format_optimizations\": [\"ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæœ€é©åŒ–\"],
              \"memory_efficiency\": \"ãƒ¡ãƒ¢ãƒªåŠ¹ç‡æ”¹å–„\"
            },
            \"material_enhancement\": {
              \"pbr_workflow\": \"PBR ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æœ€é©åŒ–\",
              \"shader_optimization\": \"ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼æœ€é©åŒ–\",
              \"lighting_response\": \"ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°å¿œç­”æ”¹å–„\",
              \"realistic_rendering\": \"ãƒªã‚¢ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°\",
              \"performance_balance\": \"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ©ãƒ³ã‚¹\"
            },
            \"platform_specific_optimization\": {
              \"web_optimization\": {
                \"file_size_targets\": \"ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç›®æ¨™\",
                \"loading_optimization\": \"ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æœ€é©åŒ–\",
                \"browser_compatibility\": \"ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§\",
                \"performance_budgets\": \"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆç®—\"
              },
              \"mobile_optimization\": {
                \"polygon_limits\": \"ãƒãƒªã‚´ãƒ³åˆ¶é™\",
                \"texture_constraints\": \"ãƒ†ã‚¯ã‚¹ãƒãƒ£åˆ¶ç´„\",
                \"rendering_efficiency\": \"ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°åŠ¹ç‡\",
                \"battery_impact\": \"ãƒãƒƒãƒ†ãƒªãƒ¼å½±éŸ¿\"
              },
              \"desktop_optimization\": {
                \"quality_enhancements\": \"å“è³ªå¼·åŒ–\",
                \"detail_maximization\": \"è©³ç´°æœ€å¤§åŒ–\",
                \"advanced_features\": \"é«˜åº¦æ©Ÿèƒ½æ´»ç”¨\"
              }
            },
            \"quality_assurance\": {
              \"validation_criteria\": [\"æ¤œè¨¼åŸºæº–\"],
              \"testing_scenarios\": [\"ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª\"],
              \"performance_benchmarks\": [\"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯\"],
              \"user_experience_metrics\": [\"UX ãƒ¡ãƒˆãƒªã‚¯ã‚¹\"]
            },
            \"implementation_roadmap\": {
              \"immediate_optimizations\": [\"å³åº§å®Ÿè¡Œå¯èƒ½æœ€é©åŒ–\"],
              \"advanced_processing\": [\"é«˜åº¦å‡¦ç†è¦ä»¶\"],
              \"tool_requirements\": [\"å¿…è¦ãƒ„ãƒ¼ãƒ«\"],
              \"workflow_integration\": \"ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµ±åˆæ–¹é‡\"
            }
          }" > .logs/model-optimization/optimization-analysis.json
          
          OPTIMIZATION_ANALYSIS=$(cat .logs/model-optimization/optimization-analysis.json)
          
          # æœ€é©åŒ–ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®æŠ½å‡º
          OVERALL_QUALITY=$(echo "$OPTIMIZATION_ANALYSIS" | jq -r '.optimization_analysis.current_model_quality.overall_quality_score')
          HIGH_PRIORITY_OPTS=$(echo "$OPTIMIZATION_ANALYSIS" | jq '[.optimization_recommendations[] | select(.implementation_priority == "high")] | length')
          
          echo "CURRENT_3D_QUALITY=$OVERALL_QUALITY" >> $GITHUB_ENV
          echo "HIGH_PRIORITY_3D_OPTS=$HIGH_PRIORITY_OPTS" >> $GITHUB_ENV
          echo "OPTIMIZATION_ANALYSIS_FILE=.logs/model-optimization/optimization-analysis.json" >> $GITHUB_ENV
          
          # å®Ÿè¡Œå¯èƒ½ãªæœ€é©åŒ–ã®é©ç”¨æŒ‡é‡
          echo "Creating optimization implementation guide..."
          
          claude-code --prompt "Based on the 3D optimization analysis, create a detailed implementation guide for the high-priority optimizations:
          
          Optimization Analysis: $OPTIMIZATION_ANALYSIS
          Available 3D Models: $GENERATED_3D_COUNT
          
          Focus on practical steps that can be implemented and create specific parameter recommendations for 3D model enhancement." > .logs/model-optimization/implementation-guide.json 2>&1
          
          echo "âš¡ 3D model optimization completed"
          echo "Current quality score: $OVERALL_QUALITY/10"
          echo "High priority optimizations identified: $HIGH_PRIORITY_OPTS"

  # === ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¨­å®šæ®µéš ===
  - id: "rendering-visualization-setup"
    name: "ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ»å¯è¦–åŒ–è¨­å®š"
    phase: "rendering_setup"
    github_job: "rendering-setup"
    type: "configuration"
    implementation: "ai"
    duration_minutes: 4
    dependencies: ["3d-model-optimization"]
    parallel_group: null
    
    github_steps:
      - name: "Setup rendering and visualization configurations"
        shell: "bash"
        script: |
          echo "ğŸ¨ Setting up rendering and visualization configurations..."
          
          mkdir -p .logs/rendering-setup
          
          THREED_CONCEPT=$(cat .logs/3d-concept/3d-concept.json)
          OPTIMIZATION_ANALYSIS=$(cat .logs/model-optimization/optimization-analysis.json)
          
          # ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¨­å®šåˆ†æ
          claude-code --prompt "ä»¥ä¸‹ã®3Dãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’åŸºã«ã€æœ€é©ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¨å¯è¦–åŒ–è¨­å®šã‚’è¨­è¨ˆã—ã¦ãã ã•ã„ï¼š
          
          3Dã‚³ãƒ³ã‚»ãƒ—ãƒˆ: $THREED_CONCEPT
          æœ€é©åŒ–åˆ†æ: $OPTIMIZATION_ANALYSIS
          
          ä»¥ä¸‹ã®å½¢å¼ã§JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
          {
            \"rendering_strategy\": {
              \"primary_rendering_approach\": \"ä¸»è¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ\",
              \"quality_vs_performance_balance\": \"å“è³ªãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ©ãƒ³ã‚¹\",
              \"target_platforms\": [\"å¯¾è±¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ \"],
              \"rendering_pipeline\": \"ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³\"
            },
            \"lighting_setup\": {
              \"lighting_scheme\": \"ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ã‚¹ã‚­ãƒ¼ãƒ \",
              \"key_light_configuration\": {
                \"type\": \"ãƒ©ã‚¤ãƒˆã‚¿ã‚¤ãƒ—\",
                \"intensity\": \"å¼·åº¦\",
                \"color_temperature\": \"è‰²æ¸©åº¦\",
                \"position\": \"ä½ç½®\",
                \"shadow_settings\": \"ã‚·ãƒ£ãƒ‰ã‚¦è¨­å®š\"
              },
              \"fill_lights\": [
                {
                  \"purpose\": \"ç”¨é€”\",
                  \"configuration\": \"è¨­å®šè©³ç´°\",
                  \"intensity\": \"å¼·åº¦\"
                }
              ],
              \"environment_lighting\": {
                \"hdri_environment\": \"HDRIç’°å¢ƒ\",
                \"ambient_occlusion\": \"ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆã‚ªã‚¯ãƒ«ãƒ¼ã‚¸ãƒ§ãƒ³\",
                \"global_illumination\": \"ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ«ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³\"
              }
            },
            \"material_rendering\": {
              \"pbr_setup\": {
                \"albedo_configuration\": \"ã‚¢ãƒ«ãƒ™ãƒ‰è¨­å®š\",
                \"metallic_settings\": \"ãƒ¡ã‚¿ãƒªãƒƒã‚¯è¨­å®š\",
                \"roughness_configuration\": \"ãƒ©ãƒ•ãƒã‚¹è¨­å®š\",
                \"normal_mapping\": \"ãƒãƒ¼ãƒãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°\",
                \"emission_properties\": \"ã‚¨ãƒŸãƒƒã‚·ãƒ§ãƒ³ç‰¹æ€§\"
              },
              \"shader_optimization\": \"ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼æœ€é©åŒ–\",
              \"texture_filtering\": \"ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\",
              \"anisotropy_settings\": \"ç•°æ–¹æ€§è¨­å®š\"
            },
            \"camera_configuration\": {
              \"default_camera_setup\": {
                \"position\": \"ã‚«ãƒ¡ãƒ©ä½ç½®\",
                \"target\": \"æ³¨è¦–ç‚¹\",
                \"field_of_view\": \"è¦–é‡è§’\",
                \"depth_of_field\": \"è¢«å†™ç•Œæ·±åº¦\"
              },
              \"presentation_angles\": [
                {
                  \"angle_name\": \"ã‚¢ãƒ³ã‚°ãƒ«å\",
                  \"camera_settings\": \"ã‚«ãƒ¡ãƒ©è¨­å®š\",
                  \"purpose\": \"ç”¨é€”\"
                }
              ],
              \"animation_paths\": [\"ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹\"],
              \"interactive_controls\": \"ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–åˆ¶å¾¡\"
            },
            \"post_processing\": {
              \"tone_mapping\": \"ãƒˆãƒ¼ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°\",
              \"color_grading\": \"ã‚«ãƒ©ãƒ¼ã‚°ãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°\",
              \"anti_aliasing\": \"ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°\",
              \"bloom_effects\": \"ãƒ–ãƒ«ãƒ¼ãƒ åŠ¹æœ\",
              \"depth_effects\": \"æ·±åº¦åŠ¹æœ\",
              \"screen_space_effects\": [\"ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¹ãƒšãƒ¼ã‚¹åŠ¹æœ\"]
            },
            \"output_specifications\": {
              \"image_formats\": [\"ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\"],
              \"resolution_targets\": [\"è§£åƒåº¦ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ\"],
              \"frame_rates\": [\"ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ\"],
              \"compression_settings\": \"åœ§ç¸®è¨­å®š\",
              \"color_spaces\": [\"è‰²ç©ºé–“\"]
            },
            \"platform_rendering_configs\": {
              \"web_rendering\": {
                \"webgl_settings\": \"WebGLè¨­å®š\",
                \"progressive_loading\": \"ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°\",
                \"fallback_options\": [\"ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯é¸æŠè‚¢\"]
              },
              \"mobile_rendering\": {
                \"optimization_level\": \"æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«\",
                \"quality_scaling\": \"å“è³ªã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°\",
                \"performance_monitoring\": \"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–\"
              },
              \"desktop_rendering\": {
                \"high_quality_features\": [\"é«˜å“è³ªæ©Ÿèƒ½\"],
                \"advanced_shading\": \"é«˜åº¦ã‚·ã‚§ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°\",
                \"ray_tracing_options\": \"ãƒ¬ã‚¤ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°é¸æŠè‚¢\"
              }
            },
            \"interactive_features\": {
              \"user_controls\": [\"ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¶å¾¡\"],
              \"animation_triggers\": [\"ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒªã‚¬ãƒ¼\"],
              \"customization_options\": [\"ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³é¸æŠè‚¢\"],
              \"performance_adaptivity\": \"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é©å¿œæ€§\"
            },
            \"quality_validation\": {
              \"visual_quality_checks\": [\"è¦–è¦šå“è³ªãƒã‚§ãƒƒã‚¯\"],
              \"performance_benchmarks\": [\"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯\"],
              \"cross_platform_testing\": [\"ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆ\"],
              \"user_experience_validation\": [\"UXæ¤œè¨¼\"]
            }
          }" > .logs/rendering-setup/rendering-configuration.json
          
          RENDERING_CONFIG=$(cat .logs/rendering-setup/rendering-configuration.json)
          
          # ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¨­å®šæƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š
          RENDERING_APPROACH=$(echo "$RENDERING_CONFIG" | jq -r '.rendering_strategy.primary_rendering_approach')
          PLATFORM_COUNT=$(echo "$RENDERING_CONFIG" | jq '.rendering_strategy.target_platforms | length')
          
          echo "RENDERING_APPROACH=$RENDERING_APPROACH" >> $GITHUB_ENV
          echo "TARGET_PLATFORM_COUNT=$PLATFORM_COUNT" >> $GITHUB_ENV
          echo "RENDERING_CONFIG_FILE=.logs/rendering-setup/rendering-configuration.json" >> $GITHUB_ENV
          
          echo "ğŸ¨ Rendering and visualization setup completed"
          echo "Rendering approach: $RENDERING_APPROACH"
          echo "Target platforms: $PLATFORM_COUNT"

  # === é…ä¿¡æº–å‚™æ®µéš ===
  - id: "3d-delivery-packaging"
    name: "3Dé…ä¿¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæœ€é©åŒ–"
    phase: "delivery_preparation"
    github_job: "delivery-packaging"
    type: "packaging"
    implementation: "ai"
    duration_minutes: 4
    dependencies: ["rendering-visualization-setup"]
    parallel_group: null
    
    github_steps:
      - name: "Create delivery package and optimize formats"
        shell: "bash"
        script: |
          echo "ğŸ“¦ Creating 3D delivery package and optimizing formats..."
          
          mkdir -p .logs/delivery-packaging
          
          THREED_CONCEPT=$(cat .logs/3d-concept/3d-concept.json)
          OPTIMIZATION_ANALYSIS=$(cat .logs/model-optimization/optimization-analysis.json)
          RENDERING_CONFIG=$(cat .logs/rendering-setup/rendering-configuration.json)
          GENERATION_LOG=$(cat .logs/3d-generation/generation-log.json)
          
          # é…ä¿¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æˆ¦ç•¥
          claude-code --prompt "ä»¥ä¸‹ã®3Dãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’åŸºã«ã€é…ä¿¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæœ€é©åŒ–æˆ¦ç•¥ã‚’è¨­è¨ˆã—ã¦ãã ã•ã„ï¼š
          
          3Dã‚³ãƒ³ã‚»ãƒ—ãƒˆ: $THREED_CONCEPT
          æœ€é©åŒ–åˆ†æ: $OPTIMIZATION_ANALYSIS
          ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¨­å®š: $RENDERING_CONFIG
          ç”Ÿæˆãƒ­ã‚°: $GENERATION_LOG
          
          ä»¥ä¸‹ã®å½¢å¼ã§JSONã§å›ç­”ã—ã¦ãã ã•ã„ï¼š
          {
            \"delivery_strategy\": {
              \"primary_use_cases\": [\"ä¸»è¦ç”¨é€”\"],
              \"target_audiences\": [\"å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼\"],
              \"distribution_channels\": [\"é…ä¿¡ãƒãƒ£ãƒãƒ«\"],
              \"deployment_scenarios\": [\"ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚·ãƒŠãƒªã‚ª\"]
            },
            \"format_specifications\": [
              {
                \"format_name\": \"ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå\",
                \"file_extension\": \"ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­\",
                \"use_case\": \"ä½¿ç”¨ç”¨é€”\",
                \"platform_compatibility\": [\"ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§\"],
                \"technical_specs\": {
                  \"polygon_limit\": \"ãƒãƒªã‚´ãƒ³åˆ¶é™\",
                  \"texture_size\": \"ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚µã‚¤ã‚º\",
                  \"compression_level\": \"åœ§ç¸®ãƒ¬ãƒ™ãƒ«\",
                  \"file_size_estimate\": \"æ¨å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º\"
                },
                \"quality_profile\": \"å“è³ªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«\",
                \"loading_performance\": \"ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹\"
              }
            ],
            \"optimization_variants\": {
              \"high_quality\": {
                \"description\": \"é«˜å“è³ªç‰ˆä»•æ§˜\",
                \"polygon_count\": \"ãƒãƒªã‚´ãƒ³æ•°\",
                \"texture_resolution\": \"ãƒ†ã‚¯ã‚¹ãƒãƒ£è§£åƒåº¦\",
                \"target_platforms\": [\"å¯¾è±¡ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ \"]
              },
              \"standard_quality\": {
                \"description\": \"æ¨™æº–å“è³ªç‰ˆä»•æ§˜\",
                \"optimization_level\": \"æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«\",
                \"performance_target\": \"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™\"
              },
              \"mobile_optimized\": {
                \"description\": \"ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ç‰ˆä»•æ§˜\",
                \"constraints\": [\"åˆ¶ç´„æ¡ä»¶\"],
                \"optimization_techniques\": [\"æœ€é©åŒ–æŠ€æ³•\"]
              },
              \"web_optimized\": {
                \"description\": \"Webæœ€é©åŒ–ç‰ˆä»•æ§˜\",
                \"loading_strategy\": \"ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æˆ¦ç•¥\",
                \"streaming_support\": \"ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ\"
              }
            },
            \"asset_package\": {
              \"3d_models\": {
                \"primary_models\": [\"ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«\"],
                \"lod_variants\": [\"LODãƒãƒªã‚¢ãƒ³ãƒˆ\"],
                \"detail_models\": [\"è©³ç´°ãƒ¢ãƒ‡ãƒ«\"]
              },
              \"textures\": {
                \"diffuse_maps\": [\"ãƒ‡ã‚£ãƒ•ãƒ¥ãƒ¼ã‚ºãƒãƒƒãƒ—\"],
                \"normal_maps\": [\"ãƒãƒ¼ãƒãƒ«ãƒãƒƒãƒ—\"],
                \"pbr_textures\": [\"PBRãƒ†ã‚¯ã‚¹ãƒãƒ£\"],
                \"environment_maps\": [\"ç’°å¢ƒãƒãƒƒãƒ—\"]
              },
              \"materials\": {
                \"material_definitions\": [\"ãƒãƒ†ãƒªã‚¢ãƒ«å®šç¾©\"],
                \"shader_configurations\": [\"ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼è¨­å®š\"],
                \"rendering_parameters\": [\"ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿\"]
              },
              \"documentation\": {
                \"technical_specifications\": \"æŠ€è¡“ä»•æ§˜æ›¸\",
                \"usage_guidelines\": \"ä½¿ç”¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³\",
                \"integration_instructions\": \"çµ±åˆæ‰‹é †æ›¸\",
                \"troubleshooting_guide\": \"ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°\"
              }
            },
            \"metadata_package\": {
              \"model_information\": {
                \"model_name\": \"ãƒ¢ãƒ‡ãƒ«å\",
                \"creation_date\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\",
                \"generation_method\": \"AI-generated 3D model\",
                \"quality_level\": \"$CURRENT_3D_QUALITY/10\",
                \"polygon_count\": \"ãƒãƒªã‚´ãƒ³æ•°\"
              },
              \"technical_metadata\": {
                \"coordinate_system\": \"åº§æ¨™ç³»\",
                \"unit_scale\": \"å˜ä½ã‚¹ã‚±ãƒ¼ãƒ«\",
                \"pivot_point\": \"ãƒ”ãƒœãƒƒãƒˆãƒã‚¤ãƒ³ãƒˆ\",
                \"bounding_box\": \"ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹\"
              },
              \"usage_rights\": {
                \"license_type\": \"ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç¨®åˆ¥\",
                \"commercial_usage\": \"å•†ç”¨åˆ©ç”¨å¯å¦\",
                \"modification_rights\": \"æ”¹å¤‰æ¨©é™\",
                \"attribution_requirements\": [\"ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¦ä»¶\"]
              }
            },
            \"quality_assurance\": {
              \"validation_checklist\": [\"æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ\"],
              \"compatibility_tests\": [\"äº’æ›æ€§ãƒ†ã‚¹ãƒˆ\"],
              \"performance_benchmarks\": [\"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯\"],
              \"user_acceptance_criteria\": [\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å—å®¹åŸºæº–\"]
            },
            \"deployment_guidance\": {
              \"integration_steps\": [\"çµ±åˆã‚¹ãƒ†ãƒƒãƒ—\"],
              \"configuration_options\": [\"è¨­å®šé¸æŠè‚¢\"],
              \"optimization_tips\": [\"æœ€é©åŒ–ã®ã‚³ãƒ„\"],
              \"maintenance_recommendations\": [\"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ¨å¥¨äº‹é …\"]
            },
            \"success_metrics\": {
              \"technical_kpis\": [\"æŠ€è¡“çš„KPI\"],
              \"user_experience_metrics\": [\"UX ãƒ¡ãƒˆãƒªã‚¯ã‚¹\"],
              \"performance_indicators\": [\"ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™\"],
              \"quality_benchmarks\": [\"å“è³ªãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯\"]
            }
          }" > .logs/delivery-packaging/delivery-strategy.json
          
          DELIVERY_STRATEGY=$(cat .logs/delivery-packaging/delivery-strategy.json)
          
          # é…ä¿¡æƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š
          FORMAT_COUNT=$(echo "$DELIVERY_STRATEGY" | jq '.format_specifications | length')
          VARIANT_COUNT=$(echo "$DELIVERY_STRATEGY" | jq '.optimization_variants | keys | length')
          
          echo "DELIVERY_FORMAT_COUNT=$FORMAT_COUNT" >> $GITHUB_ENV
          echo "OPTIMIZATION_VARIANT_COUNT=$VARIANT_COUNT" >> $GITHUB_ENV
          echo "DELIVERY_STRATEGY_FILE=.logs/delivery-packaging/delivery-strategy.json" >> $GITHUB_ENV
          
          echo "ğŸ“¦ 3D delivery packaging completed"
          echo "Delivery formats: $FORMAT_COUNT"
          echo "Optimization variants: $VARIANT_COUNT"

  - id: "final-3d-project-packaging"
    name: "æœ€çµ‚3Dãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ"
    phase: "delivery_preparation"
    github_job: "final-packaging"
    type: "packaging"
    implementation: "script"
    duration_minutes: 2
    dependencies: ["3d-delivery-packaging"]
    parallel_group: null
    
    github_steps:
      - name: "Create comprehensive 3D project delivery package"
        shell: "bash"
        script: |
          echo "ğŸ“¦ Creating comprehensive 3D project delivery package..."
          
          mkdir -p .final-output/{concept,generation,optimization,rendering}
          
          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–‡æ›¸
          cp .logs/3d-concept/3d-concept.json .final-output/concept/ 2>/dev/null || true
          cp .logs/reference-preparation/preparation-log.json .final-output/concept/ 2>/dev/null || true
          
          # 3Dç”Ÿæˆæˆæœç‰©
          mkdir -p .final-output/generation/{models,references}
          cp .logs/3d-generation/*.json .final-output/generation/models/ 2>/dev/null || true
          cp .logs/reference-preparation/*.json .final-output/generation/references/ 2>/dev/null || true
          
          # æœ€é©åŒ–ãƒ»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è³‡æ–™
          cp .logs/model-optimization/*.json .final-output/optimization/ 2>/dev/null || true
          cp .logs/rendering-setup/*.json .final-output/rendering/ 2>/dev/null || true
          cp .logs/delivery-packaging/*.json .final-output/rendering/ 2>/dev/null || true
          
          # ãƒã‚¹ã‚¿ãƒ¼3Dãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
          cat > .final-output/3d-project-master.json << EOF
          {
            "project_info": {
              "project_name": "3D Model Creation",
              "created_at": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
              "github_run_id": "${{ github.run_id }}",
              "project_type": "3d_model_generation_and_optimization",
              "total_production_time": "30 minutes"
            },
            "3d_overview": {
              "polygon_budget": $POLYGON_BUDGET,
              "texture_resolution": $TEXTURE_RESOLUTION,
              "current_quality_score": "$CURRENT_3D_QUALITY/10",
              "delivery_formats": $DELIVERY_FORMAT_COUNT,
              "optimization_variants": $OPTIMIZATION_VARIANT_COUNT
            },
            "production_summary": {
              "3d_generation_available": "$THREED_GEN_AVAILABLE",
              "reference_generation_available": "$REF_IMAGE_AVAILABLE",
              "image_enhancement_available": "$IMAGE_ENHANCEMENT_AVAILABLE",
              "ai_analysis_available": "$THREED_AI_AVAILABLE",
              "generated_3d_models": $GENERATED_3D_COUNT,
              "reference_images": $GENERATED_REF_COUNT,
              "angle_variants": $ANGLE_3D_VARIANTS,
              "detail_models": $DETAIL_3D_MODELS
            },
            "deliverables": {
              "concept_documents": {
                "3d_concept": "concept/3d-concept.json",
                "reference_preparation": "concept/preparation-log.json"
              },
              "3d_assets": {
                "generated_models": "generation/models/",
                "reference_images": "generation/references/"
              },
              "optimization_reports": {
                "model_optimization": "optimization/optimization-analysis.json",
                "rendering_configuration": "rendering/rendering-configuration.json",
                "delivery_strategy": "rendering/delivery-strategy.json"
              }
            },
            "technical_capabilities": {
              "basic_3d_capability": "$BASIC_3D_CAPABILITY",
              "advanced_3d_capability": "$ADVANCED_3D_CAPABILITY",
              "primary_3d_service": "$([ "$THREED_GEN_AVAILABLE" = "true" ] && echo "i2i3d-fal-hunyuan3d-v21" || echo "none")",
              "enhancement_services": "$([ "$IMAGE_ENHANCEMENT_AVAILABLE" = "true" ] && echo "i2i-fal-flux-kontext-max" || echo "none")"
            },
            "production_readiness": {
              "3d_generation_status": "$THREED_GENERATION_STATUS",
              "reference_preparation_status": "$REFERENCE_PREPARATION_STATUS",
              "quality_score": "$CURRENT_3D_QUALITY/10",
              "high_priority_optimizations": $HIGH_PRIORITY_3D_OPTS,
              "rendering_approach": "$RENDERING_APPROACH",
              "delivery_ready": $([ "$THREED_GENERATION_STATUS" = "success" ] && echo "true" || echo "false")
            },
            "usage_guidelines": {
              "model_modification": "Generated 3D models can be further processed using specifications provided",
              "optimization_implementation": "Follow optimization analysis recommendations for best performance",
              "rendering_setup": "Use rendering configuration for optimal visual presentation",
              "platform_deployment": "Reference delivery strategy for platform-specific optimizations",
              "quality_maintenance": "Regular validation using provided quality benchmarks"
            },
            "support_resources": {
              "model_regeneration": "Use 3d-concept.json specifications to recreate or modify models",
              "optimization_guidance": "Follow optimization-analysis.json recommendations",
              "rendering_setup": "Use rendering-configuration.json for setup guidance",
              "troubleshooting": "Check generation logs for detailed creation information"
            }
          }
          EOF
          
          # 3Dåˆ¶ä½œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¬ã‚¤ãƒ‰ã®ä½œæˆ
          cat > .final-output/3D_PROJECT_GUIDE.md << 'EOF'
          # 3Dãƒ¢ãƒ‡ãƒ«åˆ¶ä½œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¬ã‚¤ãƒ‰
          
          ## ğŸ§Š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
          - åˆ¶ä½œæ‰‹æ³•: AIç”Ÿæˆã«ã‚ˆã‚‹3Dãƒ¢ãƒ‡ãƒ«åˆ¶ä½œ
          - å“è³ªãƒ¬ãƒ™ãƒ«: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å¯¾å¿œ
          - æœ€é©åŒ–: ãƒãƒ«ãƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ
          
          ## ğŸ¯ 3Dãƒ¢ãƒ‡ãƒ«ä»•æ§˜
          - ãƒãƒªã‚´ãƒ³äºˆç®—ã¨æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«
          - ãƒ†ã‚¯ã‚¹ãƒãƒ£è§£åƒåº¦ã¨å“è³ªè¨­å®š
          - ãƒãƒ†ãƒªã‚¢ãƒ«ãƒ»ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼è¨­å®š
          - LOD (Level of Detail) æˆ¦ç•¥
          
          ## ğŸ¨ åˆ¶ä½œæˆæœç‰©
          - ãƒ¡ã‚¤ãƒ³3Dãƒ¢ãƒ‡ãƒ«
          - è§’åº¦åˆ¥ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
          - è©³ç´°ãƒ‘ãƒ¼ãƒ„ãƒ¢ãƒ‡ãƒ«
          - å‚ç…§ç”»åƒç´ æ
          - ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¨­å®š
          
          ## âš¡ æœ€é©åŒ–ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
          - ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥æœ€é©åŒ–
          - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™è¨­å®š
          - å“è³ªãƒ»åŠ¹ç‡ãƒãƒ©ãƒ³ã‚¹
          - é…ä¿¡ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œ
          
          ## ğŸš€ é…ä¿¡ãƒ»çµ±åˆ
          - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ã‚¬ã‚¤ãƒ‰
          - ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ çµ±åˆæ‰‹é †
          - ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°è¨­å®šé©ç”¨
          - å“è³ªæ¤œè¨¼ãƒ—ãƒ­ã‚»ã‚¹
          
          ## ğŸ”§ æŠ€è¡“çš„æ³¨æ„äº‹é …
          - åº§æ¨™ç³»ãƒ»å˜ä½ã®çµ±ä¸€
          - ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ»ãƒãƒ†ãƒªã‚¢ãƒ«ç®¡ç†
          - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
          - ç¶™ç¶šçš„æœ€é©åŒ–
          EOF
          
          # ZIPãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ
          cd .final-output && zip -r ../3d-model-package.zip . && cd ..
          
          echo "ğŸ“¦ Final 3D project packaging completed"
          echo "Package includes:"
          echo "- 3D concept and technical specifications"
          echo "- $GENERATED_3D_COUNT generated 3D models"
          echo "- $GENERATED_REF_COUNT reference images"
          echo "- Quality optimization analysis (score: $CURRENT_3D_QUALITY/10)"
          echo "- $DELIVERY_FORMAT_COUNT delivery format specifications"
          echo "- Rendering and deployment configurations"
          echo "Package location: 3d-model-package.zip"
          
    success_links:
      package_download: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/artifacts"
      optimization_analysis: "${{ github.server_url }}/${{ github.repository }}/blob/main/.final-output/optimization/optimization-analysis.json"
      3d_concept: "${{ github.server_url }}/${{ github.repository }}/blob/main/.final-output/concept/3d-concept.json"
      project_guide: "${{ github.server_url }}/${{ github.repository }}/blob/main/.final-output/3D_PROJECT_GUIDE.md"

    validation:
      criteria:
        - "3Dã‚³ãƒ³ã‚»ãƒ—ãƒˆãŒè¨­è¨ˆã•ã‚Œã¦ã„ã‚‹"
        - "å‚ç…§ç”»åƒãŒæº–å‚™ã•ã‚Œã¦ã„ã‚‹"
        - "3Dãƒ¢ãƒ‡ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹"
        - "æœ€é©åŒ–åˆ†æãŒå®Œäº†ã—ã¦ã„ã‚‹"
        - "é…ä¿¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹"
      validation_script: |
        if [ ! -f ".final-output/3d-project-master.json" ]; then
          echo "âŒ VALIDATION FAILED: 3D project package missing"
          exit 1
        fi
        
        if [ "$THREED_GENERATION_STATUS" = "success" ]; then
          echo "âœ… Validation passed: 3D model generation completed successfully"
        elif [ "$THREED_GENERATION_STATUS" = "service_unavailable" ]; then
          echo "âš ï¸ WARNING: 3D generation service unavailable - specifications created for external use"
        else
          echo "âŒ VALIDATION FAILED: 3D model generation failed"
          exit 1
        fi