# Rule references (domain rule files to load additionally)
rule_references:
  - path: "meta/domain-templates/live-streaming/rules/task-breakdown.yaml"
    purpose: "Task decomposition into atomic steps"

# Checklist references (domain-specific MUST/SHOULD)
checklist_references: []
# ãƒ©ã‚¤ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã®åˆ¶ç´„æ¡ä»¶ã¨è¨ˆç®—å¼

# ğŸš¨ é‡è¦: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°è¨ˆç®—ã¯å¿…é ˆã§ã™
# ãƒ©ã‚¤ãƒ–æ„Ÿã®ã‚ã‚‹é…ä¿¡ä½“é¨“ã‚’è¨­è¨ˆã™ã‚‹é‡è¦è¦ç´ 
streaming_segment_constraints:
  # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°è¨ˆç®— - é…ä¿¡ã®æ§‹æˆç®¡ç†
  segment_calculation:
    importance: "CRITICAL - è¦–è´è€…ã®æ³¨æ„ç¶­æŒã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ä¿ƒé€²ã«ä¸å¯æ¬ "
    formula: |
      # ãƒ©ã‚¤ãƒ–é¢¨å‹•ç”»ã®å ´åˆï¼ˆäº‹å‰åéŒ²ï¼‰
      content_segments = ceil(duration_seconds / 120)  # 2åˆ†ã”ã¨ã«ãƒˆãƒ”ãƒƒã‚¯å¤‰æ›´
      
      # ãƒã‚¤ãƒ©ã‚¤ãƒˆå‹•ç”»ã®å ´åˆ
      highlight_scenes = ceil(duration_seconds / 10)  # 10ç§’ã”ã¨ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
      
      # ãƒãƒ¼ãƒãƒ£ãƒ«é…ä¿¡ã®å ´åˆ
      scene_variations = base_scenes + interaction_points
      
      where:
        - duration_seconds: é…ä¿¡ã®é•·ã•
        - base_scenes: åŸºæœ¬ã‚·ãƒ¼ãƒ³æ•°ï¼ˆèƒŒæ™¯ã€ã‚¢ãƒ³ã‚°ãƒ«ï¼‰
        - interaction_points: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆæ•°
    
    segment_types:
      opening: "ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ï¼ˆ30-60ç§’ï¼‰"
      main_segments: "ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆå„2-3åˆ†ï¼‰"
      interaction: "è¦–è´è€…ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå„1åˆ†ï¼‰"
      transition: "ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ï¼ˆå„10-15ç§’ï¼‰"
      closing: "ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆ30-60ç§’ï¼‰"
    
    examples:
      - "10åˆ†é…ä¿¡ â†’ 5ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆOP1ã€ãƒ¡ã‚¤ãƒ³3ã€ED1ï¼‰"
      - "30åˆ†é…ä¿¡ â†’ 15ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆãƒˆãƒ”ãƒƒã‚¯åˆ‡ã‚Šæ›¿ãˆå«ã‚€ï¼‰"
      - "60åˆ†é…ä¿¡ â†’ 30ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆä¼‘æ†©ãƒ»Q&Aå«ã‚€ï¼‰"
  
  # ãƒ©ã‚¤ãƒ–æ„Ÿæ¼”å‡ºã®è¦ç´ 
  live_feeling_elements:
    camera_angles: "æœ€ä½3ã‚¢ãƒ³ã‚°ãƒ«ï¼ˆãƒ¡ã‚¤ãƒ³ã€ã‚µãƒ–ã€ä¿¯ç°ï¼‰"
    scene_switching: "30ç§’-2åˆ†ã”ã¨ã«ã‚¢ãƒ³ã‚°ãƒ«å¤‰æ›´"
    overlay_updates: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æƒ…å ±ã®æ›´æ–°"

streaming_technical_constraints:
  # é…ä¿¡é…å»¶ç®¡ç†
  latency_profiles:
    ultra_low_latency:
      target: "< 3ç§’"
      protocol: ["WebRTC", "SRT", "CMAF-LL"]
      buffer_size: "500ms"
      segment_duration: "200ms"
      use_cases: ["ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ", "ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³", "ã‚¹ãƒãƒ¼ãƒ„ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°"]
      
    low_latency:
      target: "3-10ç§’"
      protocol: ["LL-HLS", "LL-DASH"]
      buffer_size: "2ç§’"
      segment_duration: "2ç§’"
      use_cases: ["ä¸€èˆ¬çš„ãªãƒ©ã‚¤ãƒ–é…ä¿¡", "Q&Aã‚»ãƒƒã‚·ãƒ§ãƒ³"]
      
    standard_latency:
      target: "10-30ç§’"
      protocol: ["HLS", "DASH"]
      buffer_size: "10ç§’"
      segment_duration: "6ç§’"
      use_cases: ["å¤§è¦æ¨¡é…ä¿¡", "å®‰å®šæ€§é‡è¦–"]
    
    latency_calculation:
      formula: |
        total_latency = encoding_delay + network_delay + cdn_delay + player_buffer
        
        encoding_delay = frame_buffer + encode_time
        network_delay = upload_time + propagation
        cdn_delay = edge_cache + segment_duration
        player_buffer = buffer_size + decode_time
  
  # ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆæœ€é©åŒ–
  bitrate_ladder:
    abr_profiles:
      4k_premium:
        resolutions:
          - { res: "3840x2160", bitrate: "25000-35000", fps: 60 }
          - { res: "2560x1440", bitrate: "10000-15000", fps: 60 }
          - { res: "1920x1080", bitrate: "6000-9000", fps: 60 }
          - { res: "1280x720", bitrate: "3000-4500", fps: 60 }
          - { res: "854x480", bitrate: "1500-2000", fps: 30 }
          - { res: "640x360", bitrate: "800-1200", fps: 30 }
      
      1080p_standard:
        resolutions:
          - { res: "1920x1080", bitrate: "4500-6000", fps: 30 }
          - { res: "1280x720", bitrate: "2500-3500", fps: 30 }
          - { res: "854x480", bitrate: "1200-1800", fps: 30 }
          - { res: "640x360", bitrate: "600-900", fps: 30 }
          - { res: "426x240", bitrate: "300-500", fps: 30 }
      
      mobile_optimized:
        resolutions:
          - { res: "1280x720", bitrate: "2000-3000", fps: 30 }
          - { res: "854x480", bitrate: "1000-1500", fps: 30 }
          - { res: "640x360", bitrate: "500-800", fps: 30 }
          - { res: "426x240", bitrate: "250-400", fps: 30 }
    
    bitrate_calculation:
      formula: |
        bitrate = width * height * fps * motion_factor * compression_efficiency
        
        motion_factors:
          static_content: 0.05  # ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
          low_motion: 0.10     # ãƒˆãƒ¼ã‚¯ã‚·ãƒ§ãƒ¼
          medium_motion: 0.15  # ä¸€èˆ¬çš„ãªå‹•ç”»
          high_motion: 0.25    # ã‚¹ãƒãƒ¼ãƒ„ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        
        compression_efficiency:
          h264: 1.0
          h265: 0.5
          av1: 0.3
  
  # éŸ³å£°å“è³ªç®¡ç†
  audio_quality:
    profiles:
      music_grade:
        codec: "AAC-LC"
        bitrate: "320kbps"
        sample_rate: "48kHz"
        channels: "stereo"
        
      broadcast_grade:
        codec: "AAC-LC"
        bitrate: "192kbps"
        sample_rate: "48kHz"
        channels: "stereo"
        
      voice_optimized:
        codec: "Opus"
        bitrate: "128kbps"
        sample_rate: "48kHz"
        channels: "mono/stereo"
    
    synchronization:
      max_av_sync_drift: "40ms"
      correction_threshold: "20ms"
      lip_sync_tolerance: "Â±80ms"

platform_integration:
  # ãƒãƒ«ãƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é…ä¿¡
  simultaneous_streaming:
    platforms:
      youtube_live:
        rtmp_url: "rtmp://a.rtmp.youtube.com/live2/"
        max_bitrate: "51000kbps"
        max_resolution: "4K60fps"
        features: ["è¶…ä½é…å»¶", "DVR", "è‡ªå‹•å­—å¹•"]
        
      twitch:
        rtmp_url: "rtmp://live.twitch.tv/live/"
        max_bitrate: "6000kbps"
        max_resolution: "1080p60fps"
        features: ["ä½é…å»¶", "Raids", "Clips"]
        
      facebook_live:
        rtmp_url: "rtmps://live-api-s.facebook.com:443/rtmp/"
        max_bitrate: "4000kbps"
        max_resolution: "1080p30fps"
        features: ["ãƒ©ã‚¤ãƒ–ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°", "Stars"]
    
    bandwidth_calculation:
      formula: |
        total_upload = sum(platform_bitrates) * 1.2  # 20%ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰
        
        recommended_upload = total_upload * 2  # 2å€ã®ä½™è£•ã‚’æ¨å¥¨
        
        # ä¾‹: YouTube(9Mbps) + Twitch(6Mbps) + Facebook(4Mbps)
        # = 19Mbps * 1.2 * 2 = 45.6Mbpsæ¨å¥¨
  
  # CDNæœ€é©åŒ–
  cdn_configuration:
    edge_server_selection:
      geo_routing: "æœ€å¯„ã‚Šã®POP"
      load_balancing: "ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ + ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯"
      failover: "è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆï¼ˆ< 3ç§’ï¼‰"
    
    cache_strategy:
      segment_cache_time: "60ç§’"
      manifest_cache_time: "2ç§’"
      
    scaling_strategy:
      viewers_per_edge: 10000
      auto_scale_threshold: "80%ä½¿ç”¨ç‡"
      scale_out_time: "< 60ç§’"

interaction_features:
  # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
  chat_system:
    message_rate_limits:
      viewer: "1ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸/ç§’"
      subscriber: "3ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸/ç§’"
      moderator: "ç„¡åˆ¶é™"
    
    moderation:
      auto_mod_levels: ["ä½", "ä¸­", "é«˜", "ã‚«ã‚¹ã‚¿ãƒ "]
      banned_words: "ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚¹ãƒˆ + AIæ¤œå‡º"
      slow_mode: "5ç§’ - 120ç§’"
    
    scaling:
      formula: |
        chat_servers = ceil(concurrent_viewers / 50000)
        moderators_needed = ceil(messages_per_minute / 1000)
  
  # æŠ•ã’éŠ­ãƒ»åç›ŠåŒ–
  monetization:
    super_chat:
      min_amount: 100
      max_amount: 50000
      currency: "JPY"
      platform_fee: "30%"
      
    subscription_tiers:
      tier1: { price: 500, perks: ["ãƒãƒƒã‚¸", "ã‚¨ãƒ¢ãƒ¼ãƒˆ"] }
      tier2: { price: 1000, perks: ["tier1 + è¿½åŠ ã‚¨ãƒ¢ãƒ¼ãƒˆ"] }
      tier3: { price: 2500, perks: ["tier2 + å°‚ç”¨ãƒãƒ£ãƒ³ãƒãƒ«"] }
    
    revenue_calculation:
      formula: |
        gross_revenue = super_chats + subscriptions + ads
        platform_fees = gross_revenue * 0.3
        payment_fees = gross_revenue * 0.029 + 30  # Stripeæ¨™æº–
        net_revenue = gross_revenue - platform_fees - payment_fees

reliability_monitoring:
  # é…ä¿¡å“è³ªç›£è¦–
  quality_metrics:
    video_metrics:
      - "ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‰ãƒ­ãƒƒãƒ—ç‡ < 0.1%"
      - "ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆå®‰å®šæ€§ > 95%"
      - "ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ é–“éš”: 2ç§’"
      
    audio_metrics:
      - "éŸ³å£°ãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ã‚¦ãƒˆ < 0.01%"
      - "éŸ³é‡ãƒ¬ãƒ™ãƒ«: -23 LUFS Â± 2"
      - "ãƒ”ãƒ¼ã‚¯: -3 dBFSä»¥ä¸‹"
    
    network_metrics:
      - "ãƒ‘ã‚±ãƒƒãƒˆãƒ­ã‚¹ < 0.1%"
      - "ã‚¸ãƒƒã‚¿ãƒ¼ < 30ms"
      - "RTT < 150ms"
  
  # å†—é•·æ€§è¨­è¨ˆ
  redundancy_setup:
    encoder_redundancy:
      primary: "ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼"
      backup: "ãƒ›ãƒƒãƒˆã‚¹ã‚¿ãƒ³ãƒã‚¤"
      switchover_time: "< 3ç§’"
      
    network_redundancy:
      primary_isp: "å°‚ç”¨å›ç·š 100Mbps"
      backup_isp: "åˆ¥ã‚­ãƒ£ãƒªã‚¢ 100Mbps"
      cellular_backup: "5G/4G ãƒ¢ãƒã‚¤ãƒ«"
      
    stream_redundancy:
      main_stream: "ãƒ—ãƒ©ã‚¤ãƒãƒªRTMP"
      backup_stream: "ã‚»ã‚«ãƒ³ãƒ€ãƒªRTMP"
      sync_mechanism: "ã‚¿ã‚¤ãƒ ã‚³ãƒ¼ãƒ‰åŒæœŸ"
  
  # ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
  alert_thresholds:
    critical:
      - "é…ä¿¡åœæ­¢"
      - "ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‰ãƒ­ãƒƒãƒ— > 5%"
      - "ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ < 50%"
      - "éŸ³å£°ãªã— > 3ç§’"
      
    warning:
      - "ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‰ãƒ­ãƒƒãƒ— > 1%"
      - "ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆå¤‰å‹• > 20%"
      - "CPUä½¿ç”¨ç‡ > 80%"
      - "è¦–è´è€…é›¢è„±ç‡ > 10%/åˆ†"

advanced_features:
  # ãƒãƒ«ãƒã‚«ãƒ¡ãƒ©é…ä¿¡
  multi_camera:
    switching_modes:
      manual: "ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼æ“ä½œ"
      auto: "AIé¡”èªè­˜ + éŸ³å£°æ¤œå‡º"
      preset: "äº‹å‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ "
      
    camera_sync:
      genlock: "å¿…é ˆï¼ˆæ”¾é€å“è³ªï¼‰"
      timecode: "SMPTE 12M"
      frame_accuracy: "Â±1ãƒ•ãƒ¬ãƒ¼ãƒ "
    
    switching_effects:
      cut: "0ãƒ•ãƒ¬ãƒ¼ãƒ "
      dissolve: "15-30ãƒ•ãƒ¬ãƒ¼ãƒ "
      wipe: "30-60ãƒ•ãƒ¬ãƒ¼ãƒ "
      pip: "ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ"
  
  # éŒ²ç”»ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
  recording:
    quality_settings:
      master: "ã‚ªãƒªã‚¸ãƒŠãƒ«å“è³ª + 10%"
      archive: "æœ€é«˜é…ä¿¡å“è³ª"
      backup: "1080p30 æ¨™æº–"
      
    storage_calculation:
      formula: |
        storage_gb = (bitrate_mbps / 8) * duration_seconds / 1000
        
        # 4æ™‚é–“é…ä¿¡ã®ä¾‹:
        # 9Mbps: (9/8) * 14400 / 1000 = 16.2GB
        # + éŸ³å£°: 0.2GB
        # + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: 0.1GB
        # åˆè¨ˆ: ç´„17GB
    
    post_processing:
      auto_chapters: "ã‚·ãƒ¼ãƒ³æ¤œå‡º + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿"
      highlight_clips: "è¦–è´è€…åå¿œ + AIåˆ†æ"
      transcription: "è‡ªå‹•æ–‡å­—èµ·ã“ã—"
  
  # é…ä¿¡è‡ªå‹•åŒ–
  automation:
    scheduled_streams:
      pre_roll: "ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ + BGM"
      main_content: "è‡ªå‹•é–‹å§‹"
      post_roll: "çµ‚äº†ç”»é¢ + æ¬¡å›äºˆå‘Š"
      
    scene_automation:
      triggers: ["æ™‚é–“", "å¯„ä»˜", "ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°", "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰"]
      actions: ["ã‚·ãƒ¼ãƒ³åˆ‡æ›¿", "åŠ¹æœéŸ³", "ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³"]
      
    emergency_protocols:
      technical_difficulties:
        - "å¾…æ©Ÿç”»é¢è‡ªå‹•åˆ‡æ›¿"
        - "BGMè‡ªå‹•å†ç”Ÿ"
        - "ãƒãƒ£ãƒƒãƒˆé€šçŸ¥"
        - "éŒ²ç”»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¶™ç¶š"