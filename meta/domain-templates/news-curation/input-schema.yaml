# ニュース要約・キュレーションワークフローの入力パラメータスキーマ

inputs:
  # 必須パラメータ
  required:
    curation_name:
      type: string
      description: "キュレーション名"
      example: "テクノロジー業界デイリーダイジェスト"
      validation: "max_length: 100"
    
    curation_type:
      type: string
      description: "キュレーションタイプ"
      enum: ["breaking_news", "daily_digest", "weekly_review", "topic_analysis", "live_blog", "newsletter"]
      default: "daily_digest"
      impacts:
        - "更新頻度"
        - "要約深度"
        - "ソース選択"
        - "配信形式"
    
    target_topics:
      type: array
      description: "対象トピック/キーワード"
      items:
        type: string
      example: ["AI", "機械学習", "ChatGPT", "生成AI"]
      min_items: 1
      max_items: 10
    
    target_audience:
      type: string
      description: "ターゲット読者層"
      example: "テクノロジー企業の経営層・意思決定者"
      validation: "min_length: 10"
  
  # 推奨パラメータ（プロ向け）
  recommended:
    source_configuration:
      type: object
      description: "ソース設定"
      properties:
        primary_sources:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                example: "Reuters"
              
              url:
                type: string
                format: "uri"
              
              tier:
                type: integer
                range: [1, 4]
                description: "信頼性ティア"
              
              language:
                type: string
                enum: ["ja", "en", "zh", "ko", "es", "fr", "de"]
          max_items: 20
        
        source_diversity:
          type: object
          properties:
            min_sources_per_story:
              type: integer
              default: 3
              range: [2, 10]
            
            geographic_diversity:
              type: boolean
              default: true
            
            political_balance:
              type: boolean
              default: true
            
            source_types:
              type: array
              items:
                type: string
                enum: ["news_agency", "newspaper", "broadcast", "online_media", "blog", "social_media", "official"]
              default: ["news_agency", "newspaper", "online_media"]
    
    processing_rules:
      type: object
      description: "処理ルール"
      properties:
        summarization_level:
          type: string
          enum: ["headline_only", "brief", "standard", "detailed", "comprehensive"]
          default: "standard"
          mapping:
            headline_only: "見出しのみ"
            brief: "3-5文"
            standard: "原文の15-20%"
            detailed: "原文の25-30%"
            comprehensive: "複数視点含む"
        
        fact_checking_level:
          type: string
          enum: ["basic", "standard", "rigorous"]
          default: "standard"
        
        bias_detection:
          type: boolean
          default: true
          description: "偏向検出の有効化"
        
        duplicate_threshold:
          type: number
          range: [0.5, 0.95]
          default: 0.85
          description: "重複判定の類似度閾値"
    
    delivery_settings:
      type: object
      description: "配信設定"
      properties:
        update_frequency:
          type: object
          properties:
            interval:
              type: string
              enum: ["realtime", "5min", "15min", "30min", "hourly", "daily", "weekly"]
              default: "hourly"
            
            schedule:
              type: array
              items:
                type: string
                pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
              example: ["08:00", "12:00", "18:00"]
            
            timezone:
              type: string
              default: "Asia/Tokyo"
        
        distribution_channels:
          type: array
          items:
            type: string
            enum: ["email", "slack", "teams", "webhook", "rss", "api", "twitter", "telegram"]
          default: ["email", "rss"]
        
        personalization:
          type: object
          properties:
            enabled:
              type: boolean
              default: false
            
            personalization_factors:
              type: array
              items:
                type: string
                enum: ["reading_history", "interaction_data", "declared_interests", "time_patterns"]
    
    content_enrichment:
      type: object
      description: "コンテンツ強化"
      properties:
        add_context:
          type: boolean
          default: true
          description: "背景情報の追加"
        
        include_analysis:
          type: boolean
          default: false
          description: "専門家分析の追加"
        
        sentiment_analysis:
          type: boolean
          default: true
          description: "センチメント分析"
        
        trend_detection:
          type: boolean
          default: true
          description: "トレンド検出"
        
        related_stories:
          type: object
          properties:
            enabled:
              type: boolean
              default: true
            
            max_count:
              type: integer
              default: 3
              range: [1, 10]
  
  # オプションパラメータ（上級者向け）
  optional:
    advanced_filtering:
      type: object
      description: "高度なフィルタリング"
      properties:
        keyword_filters:
          type: object
          properties:
            include_keywords:
              type: array
              items:
                type: string
              description: "必須キーワード"
            
            exclude_keywords:
              type: array
              items:
                type: string
              description: "除外キーワード"
            
            boost_keywords:
              type: array
              items:
                type: object
                properties:
                  keyword:
                    type: string
                  weight:
                    type: number
                    range: [1.0, 3.0]
        
        geographic_filters:
          type: object
          properties:
            include_regions:
              type: array
              items:
                type: string
              example: ["JP", "US", "EU", "APAC"]
            
            exclude_regions:
              type: array
              items:
                type: string
            
            local_priority:
              type: boolean
              default: false
        
        temporal_filters:
          type: object
          properties:
            max_age_hours:
              type: integer
              default: 24
              range: [1, 168]
            
            min_age_minutes:
              type: integer
              default: 0
              description: "速報除外用"
    
    output_formatting:
      type: object
      description: "出力フォーマット設定"
      properties:
        format_type:
          type: string
          enum: ["html", "markdown", "json", "xml", "pdf", "plaintext"]
          default: "html"
        
        template_style:
          type: string
          enum: ["minimal", "standard", "detailed", "executive", "technical"]
          default: "standard"
        
        include_sections:
          type: array
          items:
            type: string
            enum: ["executive_summary", "top_stories", "by_category", "trending", "analysis", "market_data", "upcoming_events"]
          default: ["executive_summary", "top_stories", "by_category"]
        
        branding:
          type: object
          properties:
            logo_url:
              type: string
              format: "uri"
            
            color_scheme:
              type: object
              properties:
                primary:
                  type: string
                  pattern: "^#[0-9A-Fa-f]{6}$"
                secondary:
                  type: string
                  pattern: "^#[0-9A-Fa-f]{6}$"
            
            footer_text:
              type: string
    
    analytics_integration:
      type: object
      description: "分析統合"
      properties:
        track_engagement:
          type: boolean
          default: true
        
        sentiment_tracking:
          type: object
          properties:
            enabled:
              type: boolean
              default: true
            
            alert_threshold:
              type: number
              description: "ネガティブセンチメント警告閾値"
              default: -0.7
              range: [-1.0, 0]
        
        trend_analysis:
          type: object
          properties:
            enabled:
              type: boolean
              default: true
            
            lookback_days:
              type: integer
              default: 7
              range: [1, 30]
            
            prediction_horizon:
              type: integer
              default: 1
              description: "予測日数"

# 自動計算されるパラメータ
computed_parameters:
  estimated_articles_per_update:
    formula: |
      base_count = topic_count * sources_count * 0.5
      
      type_multipliers:
        breaking_news: 0.3
        daily_digest: 1.0
        weekly_review: 5.0
      
      final_count = base_count * type_multiplier * time_window_hours / 24
  
  processing_time_estimate:
    formula: |
      per_article_time = 2 # seconds
      fact_checking_overhead = fact_check_level_factor * 1.5
      translation_time = languages_count * 0.5
      
      total_seconds = articles_count * (per_article_time + fact_checking_overhead + translation_time)
  
  storage_requirements:
    formula: |
      per_article_size = 5 # KB average
      metadata_size = 2 # KB
      media_size = include_images ? 50 : 0 # KB
      
      daily_storage = articles_per_day * (per_article_size + metadata_size + media_size)
      monthly_storage_gb = daily_storage * 30 / 1024 / 1024
  
  quality_score_factors:
    formula: |
      source_reliability = avg(source_tiers) / 4
      fact_check_score = verified_facts / total_facts
      bias_score = 1 - avg_bias_detected
      freshness_score = exp(-age_hours / 24)
      
      total_quality = (source_reliability * 0.4 + fact_check_score * 0.3 + 
                      bias_score * 0.2 + freshness_score * 0.1)

# バリデーションルール
validation_rules:
  - name: "source_diversity_check"
    rule: |
      if unique_sources < 3:
        warning: "ソースの多様性が不足しています"
  
  - name: "update_frequency_feasibility"
    rule: |
      if update_interval < processing_time:
        error: "更新頻度が処理時間より短いです"
  
  - name: "language_capability_check"
    rule: |
      if target_languages not in supported_languages:
        error: "サポートされていない言語が含まれています"
  
  - name: "bias_balance_check"
    rule: |
      if political_balance and source_bias_variance > 0.3:
        warning: "ソースの政治的バランスに偏りがあります"