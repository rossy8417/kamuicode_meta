name: "Multi-Format Generator Custom Node"
description: "åŒä¸€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¤‡æ•°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆç”»åƒã€å‹•ç”»ã€éŸ³å£°ï¼‰ã§åŒæ™‚ç”Ÿæˆã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰ä¾‹"

# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å®Ÿè£…ä¾‹ã§ã™ã€‚å®Ÿéš›ã®ä½¿ç”¨æ™‚ã¯é©åˆ‡ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«çµ±åˆã—ã¦ãã ã•ã„ã€‚

jobs:
  multi-format-generator:
    runs-on: ubuntu-latest
    needs: [content-planning]  # å‰æ: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¼ç”»ãŒå®Œäº†
    outputs:
      image_paths: ${{ steps.collect-outputs.outputs.images }}
      video_paths: ${{ steps.collect-outputs.outputs.videos }}
      audio_paths: ${{ steps.collect-outputs.outputs.audios }}
      summary: ${{ steps.collect-outputs.outputs.summary }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Setup Environment
        run: |
          mkdir -p projects/current-session/multi-format/
          mkdir -p projects/current-session/multi-format/{images,videos,audios}
          echo "CONTENT_CONCEPT=${{ needs.content-planning.outputs.concept }}" >> $GITHUB_ENV
          echo "PROJECT_DIR=projects/current-session/multi-format" >> $GITHUB_ENV
        
      # ä¸¦åˆ—ç”Ÿæˆãƒ•ã‚§ãƒ¼ã‚º: 3ã¤ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’åŒæ™‚ç”Ÿæˆ
      - name: Generate Images (Format 1)
        id: image-gen
        run: |
          # è¤‡æ•°ã®ç”»åƒç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨
          echo "ğŸ¨ Generating images for concept: $CONTENT_CONCEPT"
          
          # MCP ã‚µãƒ¼ãƒ“ã‚¹å‘¼ã³å‡ºã—ï¼ˆä¾‹: t2i-google-imagen3ï¼‰
          # å®Ÿéš›ã®å®Ÿè£…ã§ã¯é©åˆ‡ãªMCPã‚³ãƒ¼ãƒ«ã«ç½®ãæ›ãˆ
          cat > "$PROJECT_DIR/image_request.json" << EOF
          {
            "prompt": "$CONTENT_CONCEPT with professional quality, 4K resolution",
            "style": "photorealistic",
            "aspect_ratio": "16:9"
          }
          EOF
          
          # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‡ºåŠ›ï¼ˆå®Ÿéš›ã¯MCPã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã®çµæœï¼‰
          echo "image_url=https://example.com/generated_image.jpg" >> $GITHUB_OUTPUT
          echo "âœ… Image generation completed"
          
      - name: Generate Videos (Format 2)
        id: video-gen
        run: |
          echo "ğŸ¬ Generating videos for concept: $CONTENT_CONCEPT"
          
          # å‹•ç”»ç”Ÿæˆè¨­å®š
          cat > "$PROJECT_DIR/video_request.json" << EOF
          {
            "type": "text-to-video",
            "prompt": "$CONTENT_CONCEPT with cinematic quality, 30 seconds",
            "resolution": "1920x1080",
            "fps": 30
          }
          EOF
          
          # è¤‡æ•°ã®å‹•ç”»ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹ã§ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
          # å®Ÿéš›ã®å®Ÿè£…ã§ã¯ t2v-veo3, t2v-wan ãªã©ã®MCPã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨
          echo "video_url=https://example.com/generated_video.mp4" >> $GITHUB_OUTPUT
          echo "âœ… Video generation completed"
          
      - name: Generate Audio (Format 3)
        id: audio-gen
        run: |
          echo "ğŸµ Generating audio for concept: $CONTENT_CONCEPT"
          
          # éŸ³å£°ç”Ÿæˆè¨­å®š
          cat > "$PROJECT_DIR/audio_request.json" << EOF
          {
            "type": "text-to-music",
            "prompt": "Background music for $CONTENT_CONCEPT, cinematic and professional",
            "duration": 30,
            "genre": "cinematic"
          }
          EOF
          
          # BGMç”Ÿæˆã¨ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆã®çµ„ã¿åˆã‚ã›
          echo "audio_url=https://example.com/generated_audio.mp3" >> $GITHUB_OUTPUT
          echo "âœ… Audio generation completed"
          
      # å“è³ªãƒã‚§ãƒƒã‚¯ãƒ•ã‚§ãƒ¼ã‚º
      - name: Quality Assessment
        run: |
          echo "ğŸ” Quality assessment for generated content"
          
          # å„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å“è³ªãƒã‚§ãƒƒã‚¯
          QUALITY_SCORE=0
          
          # ç”»åƒå“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆå®Ÿéš›ã¯image-analysisãƒ¦ãƒ‹ãƒƒãƒˆä½¿ç”¨ï¼‰
          if [ "${{ steps.image-gen.outputs.image_url }}" != "" ]; then
            echo "âœ… Image quality: PASS"
            QUALITY_SCORE=$((QUALITY_SCORE + 33))
          fi
          
          # å‹•ç”»å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆå®Ÿéš›ã¯video-analysisãƒ¦ãƒ‹ãƒƒãƒˆä½¿ç”¨ï¼‰
          if [ "${{ steps.video-gen.outputs.video_url }}" != "" ]; then
            echo "âœ… Video quality: PASS"
            QUALITY_SCORE=$((QUALITY_SCORE + 33))
          fi
          
          # éŸ³å£°å“è³ªãƒã‚§ãƒƒã‚¯
          if [ "${{ steps.audio-gen.outputs.audio_url }}" != "" ]; then
            echo "âœ… Audio quality: PASS"
            QUALITY_SCORE=$((QUALITY_SCORE + 34))
          fi
          
          echo "Overall quality score: $QUALITY_SCORE/100"
          echo "QUALITY_SCORE=$QUALITY_SCORE" >> $GITHUB_ENV
          
      # æœ€é©åŒ–ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå“è³ªãŒä½ã„å ´åˆï¼‰
      - name: Content Optimization
        if: env.QUALITY_SCORE < 80
        run: |
          echo "ğŸ”§ Content optimization required (Score: $QUALITY_SCORE)"
          
          # å“è³ªæ”¹å–„å‡¦ç†
          if [ "$QUALITY_SCORE" -lt 80 ]; then
            echo "Applying quality enhancement filters..."
            # å®Ÿéš›ã®å®Ÿè£…ã§ã¯ upscale-topaz ãªã©ã®å“è³ªå‘ä¸Šãƒ¦ãƒ‹ãƒƒãƒˆä½¿ç”¨
          fi
          
      # çµ±åˆå‡¦ç†ãƒ•ã‚§ãƒ¼ã‚º
      - name: Format Integration
        run: |
          echo "ğŸ”— Integrating multiple formats"
          
          # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–“ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
          # è‰²èª¿ã€ãƒ†ãƒ¼ãƒã€æ™‚é–“è»¸ã®çµ±ä¸€æ€§ç¢ºä¿
          
          # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
          cat > "$PROJECT_DIR/integration_metadata.json" << EOF
          {
            "concept": "$CONTENT_CONCEPT",
            "formats_generated": ["image", "video", "audio"],
            "quality_score": $QUALITY_SCORE,
            "integration_timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "cross_format_consistency": true
          }
          EOF
          
      # å‡ºåŠ›åé›†ãƒ•ã‚§ãƒ¼ã‚º
      - name: Collect Outputs
        id: collect-outputs
        run: |
          # ã™ã¹ã¦ã®ç”Ÿæˆçµæœã‚’åé›†
          IMAGES='["${{ steps.image-gen.outputs.image_url }}"]'
          VIDEOS='["${{ steps.video-gen.outputs.video_url }}"]'
          AUDIOS='["${{ steps.audio-gen.outputs.audio_url }}"]'
          
          echo "images=$IMAGES" >> $GITHUB_OUTPUT
          echo "videos=$VIDEOS" >> $GITHUB_OUTPUT
          echo "audios=$AUDIOS" >> $GITHUB_OUTPUT
          echo "summary=Multi-format content generated successfully with quality score $QUALITY_SCORE" >> $GITHUB_OUTPUT
          
          # æœ€çµ‚ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
          cat > "$PROJECT_DIR/final_output.json" << EOF
          {
            "multi_format_generation": {
              "images": $IMAGES,
              "videos": $VIDEOS,
              "audios": $AUDIOS,
              "quality_metrics": {
                "overall_score": $QUALITY_SCORE,
                "consistency_check": "passed"
              }
            }
          }
          EOF
          
          echo "âœ… Multi-format generation completed"
          
      # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      - name: Error Recovery
        if: failure()
        run: |
          echo "âŒ Multi-format generation failed"
          
          # éƒ¨åˆ†çš„ãªæˆæœç‰©ã®ä¿å­˜
          PARTIAL_RESULTS=""
          
          if [ "${{ steps.image-gen.outputs.image_url }}" != "" ]; then
            PARTIAL_RESULTS="$PARTIAL_RESULTS images:success"
          fi
          
          if [ "${{ steps.video-gen.outputs.video_url }}" != "" ]; then
            PARTIAL_RESULTS="$PARTIAL_RESULTS videos:success"
          fi
          
          if [ "${{ steps.audio-gen.outputs.audio_url }}" != "" ]; then
            PARTIAL_RESULTS="$PARTIAL_RESULTS audios:success"
          fi
          
          echo "Partial results: $PARTIAL_RESULTS"
          
          # ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
          cat > "$PROJECT_DIR/error_report.json" << EOF
          {
            "error_timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "partial_results": "$PARTIAL_RESULTS",
            "recovery_suggestions": [
              "Check MCP service availability",
              "Verify content concept clarity",
              "Review resource limitations"
            ]
          }
          EOF

# ä½¿ç”¨ä¾‹:
# ã“ã®ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰ã‚’æ—¢å­˜ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«çµ±åˆã™ã‚‹å ´åˆ:
#
# jobs:
#   content-planning:
#     uses: ./.github/workflows/minimal-units/planning/planning-ccsdk.yml
#     
#   multi-format-content:
#     uses: ./docs/examples/custom-nodes/media-processing/multi-format-generator.yml
#     needs: [content-planning]
#     
#   post-processing:
#     needs: [multi-format-content]
#     # å¾Œç¶šå‡¦ç†...